//==========================================================================================================//
// LEVEL: 			M3L3														//
// CAMPAIGN: 		Operation Overlord											//
// TITLE:			"Nebelwerfer Hunt"											//
// GEOMETRY/DESIGN: 	Steve Fukuda (Periers style church from MOHPC prototype by Benson Russell) 		//
// SCRIPTING:		Steve Fukuda, Zied Rieke										//
//==========================================================================================================//


/* //chrissstrahl
Functions I need to take a look at
halftrack_ambush
*/


//****************************************************//
//			INITIALIZATIONS				//
//****************************************************//
//=========================================================================
main:{
//=========================================================================
	level.coop_aaMap = 1						//chrissstrahl - let global scripts know this is a AA level
	waitthread coop_mod/main.scr::main 		//chrissstrahl - start coop mod extensions
	level.coop_devTest = 0						//chrissstrahl - set to 0 once done testing
	
	level.farplane = 4000 //chrissstrahl - fix that issue
	$world farplane level.farplane //chrissstrahl - fix it missing at level start
	$world farplane_color (.62 .62 .61) //criminal - fix fog being transparent

	//===SETUP EXPLODING BUILDINGS
	thread global/exploder.scr::main

	//===CALL THE LOADOUT SCRIPT FOR WEAPONS, ITEMS AND AMMO
	exec global/loadout.scr maps/m3l3.scr

	//===STOP THE PANZERSCHRECK SCRIPTMODEL FROM CUTTING OFF THE PATHFINDING
	$scene0_panzerschreck notsolid
	$scene4_panzerschreck notsolid //[200] chrissstrahl - added for coop //[200] Smithy - removed extra $

//-------------------------------------------------------
	level waittill prespawn
//-------------------------------------------------------
	//thread coop_mod/spawnlocations.scr::m3l3_update3 //chrissstrahl - fixme - test - removeme
	//thread coop_mod/spawnlocations.scr::m3l3_update5 //Smithy - testing - remove
	
	//level.script = maps/m3l3.scr
	exec global/ambient.scr m3l3
	
	//===ENGAGE THE AIRPLANE BOMBING SCRIPTS
	thread global/bomber.scr::main
	thread global/bomber.scr::repeat

	//===BIND PLAYERTARGET DEVICES FOR MG TRACKING

	//chrissstrahl - fixme - I have not decided what to do with this, yet
/*	println("DEV: FIX: $playertarget_center glue $player")
	println("DEV: FIX: $playertarget_center glue $player")
	println("DEV: FIX: $playertarget_center glue $player")
	println("DEV: FIX: $playertarget_center glue $player")
	println("DEV: FIX: $playertarget_center glue $player")*/
	
	if(level.gametype == 0){
		$playertarget_center glue $player
		$playertarget_front1 bind $playertarget_center
		$playertarget_front2 bind $playertarget_center
		$playertarget_right1 bind $playertarget_center
		$playertarget_right2 bind $playertarget_center
		$playertarget_left1 bind $playertarget_center
		$playertarget_left2 bind $playertarget_center
	}

	//===SET FRIENDLY SCRIPT
	thread global/friendly.scr::friendlygen

	//===SET FRIENDLY BARNEY AI NAMES
	level.ramsey = level.friendly1
	level.harrison = level.friendly2
	level.tomlin = level.friendly3

	//===SET AIRBORNE BARNEYS TO NOT FOLLOW AT START

	level.harrison.friendtype = -1
	level.tomlin.friendtype = -1

	//===SET ALIVE CHECK ON HALFTRACK

	level.halftrack_alive = 1

	//===INITIALIZE INVISIBLE BOMBS ON NEBELWERFERS

	thread scene7_initialize_bombsites

	//===SETUP THE COLLISION MASK ON THE DEAD PANZER BY POSITION MATCHING
	$scene1_dead_panzer_mask.origin = $scene1_dead_panzer.origin
	$scene1_dead_panzer_mask.angles = $scene1_dead_panzer.angles

	//===SETUP THE COLLISION MASK ON THE HALFTRACK BY SETCOLLISIONENTITY
	//$halftrack setcollisionentity $halftrack_mask

	//===SETUP THE COLLISION MASK ON THE TIGER TANK IN SCENE4
	$scene4_tank setcollisionentity $tigertank_mask
	
	//===DEACTIVATE ANY PREVIOUSLY PLAYING MUSIC
	//[200] chrissstrahl - tmstartloop stops old song automatically //exec coop_mod/replace.scr::tmstop	//chrissstrahl - coop mod compatible

	//===START THE MUSIC LOOP (JACK)
	exec coop_mod/replace.scr::tmstartloop "sound/music/mus_06a_mystery.mp3"	//chrissstrahl - coop mod compatible

	//===INITIALIZE TRIGGER_ONCE USAGE MONITORING FOR SCENE 1 AIRBORNE DEPLOYMENT
	level.scene1_waveterminate_trigger_used = 0

	//===TURN OFF THE HALFTRACK GUNNER'S AI
	$halftrack_gunner holster
	$halftrack_gunner exec global/disable_ai.scr

	//===Check to see if the Scene3 AI Setup thread is already called
	level.scene3_ai_setup_done = 0

	//===Deactivate the tank barrel collision 
	$scene4_tank_barrel_collision notsolid

	//===Adjust machine gun properties in SCENE 7
	$scene7_mg1 maxyawoffset 45
	$scene7_mg1 pitchcaps (0 5 0)

	$scene7_mg4 maxyawoffset 45
	$scene7_mg4 pitchcaps (0 5 0)

	$scene7_mg5 maxyawoffset 45
	$scene7_mg5 pitchcaps (0 5 0)

	//===Initialize values used in tracking nebelwerfer objective status
	level.scene7_bombcount = 4
	level.locationchecktext = ("Locate and destroy the Nebelwerfers.    [" + level.scene7_bombcount + " remaining]")

	//***	Find out what skill the player is using for difficulty checking 
	level.skill = getcvar (skill)

	//===Find out what system configuration is being used and use to adjust fog for different systems
	level.sysconfig = getcvar (g_ddayfodderguys)
	println "FODDER GUY COUNT IS" level.sysconfig
	if (level.sysconfig == "1" || level.sysconfig == "2" || level.sysconfig == "0"){
		println "COUNT WORKING!"
	}

	//-------------------------------------------------------
	level waittill spawn
	//waitexec coop_mod/replace.scr::waitForPlayer //chrissstrahl - coop alternative
	//-------------------------------------------------------
	
	//===Create extra health at these locations
	thread health_placement

	//===Set up the in level NPCs accuracy based on difficulty setting
	if (level.skill == "0"){
		$scene1_soldier1.accuracy = 1
		$scene1_soldier1.noticescale = 800

		$scene1_soldier2.accuracy = 2
		$scene1_soldier2.noticescale = 500

		$scene1_soldier3.accuracy = 2
		$scene1_soldier3.noticescale = 600

		$scene3_sniper1.accuracy = 10
		$scene3_sniper1.noticescale = 300

		$scene3_entryguard1.accuracy = 10
		$scene3_entryguard1.noticescale = 700

		$scene4_sniper4.accuracy = 10
		$scene4_sniper4.noticescale = 800

		$scene4_sniper2.accuracy = 10
		$scene4_sniper2.noticescale = 800

		$scene4_supersniper1.accuracy = 15
		$scene4_supersniper1.noticescale = 500

		$scene4_supersniper2.accuracy = 15
		$scene4_supersniper2.noticescale = 500
	}
	else if (level.skill == "1"){
		$scene1_soldier1.accuracy = 1
		$scene1_soldier1.noticescale = 200

		$scene1_soldier2.accuracy = 2
		$scene1_soldier2.noticescale = 200

		$scene1_soldier3.accuracy = 2
		$scene1_soldier3.noticescale = 200

		$scene3_sniper1.accuracy = 10
		$scene3_sniper1.noticescale = 100

		$scene3_entryguard1.accuracy = 10
		$scene3_entryguard1.noticescale = 100

		$scene4_sniper4.accuracy = 10
		$scene4_sniper4.noticescale = 200

		$scene4_sniper2.accuracy = 10
		$scene4_sniper2.noticescale = 200

		$scene4_supersniper1.accuracy = 15
		$scene4_supersniper1.noticescale = 300

		$scene4_supersniper2.accuracy = 15
		$scene4_supersniper2.noticescale = 300
	}
	else if (level.skill == "2"){
		$scene1_soldier1.accuracy = 30
		$scene1_soldier1.noticescale = 50

		$scene1_soldier2.accuracy = 50
		$scene1_soldier2.noticescale = 50

		$scene1_soldier3.accuracy = 50
		$scene1_soldier3.noticescale = 60

		$scene3_sniper1.accuracy = 50
		$scene3_sniper1.noticescale = 30

		$scene3_entryguard1.accuracy = 50
		$scene3_entryguard1.noticescale = 70

		$scene4_sniper4.accuracy = 50
		$scene4_sniper4.noticescale = 80

		$scene4_sniper2.accuracy = 50
		$scene4_sniper2.noticescale = 80

		$scene4_supersniper1.accuracy = 100
		$scene4_supersniper1.noticescale = 50

		$scene4_supersniper2.accuracy = 100
		$scene4_supersniper2.noticescale = 50
	}


	//===The destroyed flak88 at the start of the level is burning
	$scene0_destroyed_flak88 exec global/loopsound.scr fire_med

	//===SET SPECIAL ITEMS
	thread global/items.scr::add_item "explosives"
	thread global/items.scr::add_item "binoculars"
	thread global/items.scr::add_item "radio"

//-------------------------------------------------------

//===REFERENCE LIST LEVEL SPECIFIC DIALOG

//"Use your panzerschreck!" 									Captain 3	dfr_directive_142
//"TAKE OUT THAT HALFTRACK!"									Captain 3	dfr_target_023j_3						

//"Hold your fire. 101st Airborne coming out!" 						Sergeant 1 	dfr_M3L3_352c
//"Sergeant Harrison, Pathfinders, 101st." 						Sergeant 1	dfr_M3L3_356c
//"Good to meet you Sergeant Harrison, I'm Ramsey, 2nd Rangers."  		Captain 3	dfr_M3L3_357j
//"You fellows seen any unusual looking German rocket launchers around here?" Captain 3 	dfr_M3L3_353j
//"Yes Captain we have. Just down the road a bit in fact." 				Sergeant 1 	dfr_M3L3_354c
//"So what did these weapons look like?" 							Captain 3	dfr_M3L3_360j
//"Well sir we didn't exactly see them real close up. But we heard them from
//a long ways off. I've never heard anything like it." 				Sergeant 1	dfr_M3L3_361c
//"Powell, you take point. Let's get out of here."					Captain 3	dfr_m3l3_321j_1	

//"Right flank!"											Captain 3	dfr_directive_193h_11	
//"We gotta press on their positions!"							Captain 3	dfr_before_004j_2	
//"Move up there!"										Captain 3	dfr_directive_195j_2			
//"Tiger Tank to the south! Take cover!!"							Captain 3	dfr_M3L3_add01	
//"Powell, try to get its attention!"							Captain 3	dfr_M3L3_add02	
//"We need to trick that tank into clearing our path!"				Captain 3	dfr_M3L3_add03	

//"Nice work!"											Captain 3	dfr_impressed_17j_1	

//======================================================================================================

//****************************************************//
//			   MAIN PROGRAM				//
//****************************************************//

	println "STEVEFU: MARKER 1"

//===SET THE BACKGROUND AMBIENT SOUNDTRACK

//	soundtrack music/m3l3.mus

//------------------------------------------------------
//JBW - I commented out the thread scene0 line since the code drops down there anyway and letting the objective stuff run //chrissstrahl - I fixed that
//first clears up the double-talk stutter at the start of the level.
//thread scene0		//starting trench, this is the first call
//thread scene1		//halftrack ambush activated from a trigger_once in the bsp
//thread scene2		//airborne conversation activated from scene1_conclusion_detect
//thread scene3		//town entrance battle called from a trigger_once in the bsp
//thread scene4		//town central called from a trigger_once in the bsp
//thread scene5		//town south side
//thread scene6		//church battle called from a trigger_once in the bsp
//thread scene7		//nebelwerfer battle called from a trigger_once in the bsp

	//===INITIALIZE OBJECTIVES
	waitthread global/objectives.scr::add_objectives 1 2 level.locationchecktext $scene7_nebelwerfer1.origin
	thread global/objectives.scr::current_objectives 1
	thread scene0

	//[200] Smithy - OK, make this work properly in coop
	thread coop_replaceBazookaPickup
}end

//****************************************************//
//			     THREADS				//
//****************************************************//

//[200] Smithy
//new func to make zooka pickup work like any other weapon by
//replacing the weapon and ammo with actual weapons and ammo
//then removing the original script models
//=========================================================================
coop_replaceBazookaPickup:{
//=========================================================================
	//make the panzerschreck
	if(level.gametype != 0){
		local.panzerschreck = spawn ($scene0_panzerschreck.model)
		local.panzerschreck angles $scene0_panzerschreck.angles
		local.panzerschreck scale $scene0_panzerschreck.scale
		local.panzerschreck origin $scene0_panzerschreck.origin
		local.panzerschreck.flags["coop_itemRespawnTime"] = 5 	//give it its own respawn time, so it appears for other players faster

		local.panzerschreck = spawn ($scene4_panzerschreck.model)
		local.panzerschreck angles $scene4_panzerschreck.angles
		local.panzerschreck scale $scene4_panzerschreck.scale
		local.panzerschreck origin $scene4_panzerschreck.origin
		local.panzerschreck.flags["coop_itemRespawnTime"] = 10

		//do the shells
		for (local.i = 1; local.i <= 7; local.i++){
			local.oldShell = $("scene0_shell" + local.i)
			local.newShell = spawn local.oldShell.model
			local.newShell angles local.oldShell.angles
			local.newShell scale local.oldShell.scale
			local.newShell origin local.oldShell.origin
			//local.newShell.flags["coop_itemRespawnTime"] = 5
		}

		//dont need these anymore
		$scene0_panzerschreck remove
		$scene4_panzerschreck remove
		$scene0_shell1 remove
		$scene0_shell2 remove
		$scene0_shell3 remove
		$scene0_shell4 remove
		$scene0_shell5 remove
		$scene0_shell6 remove
		$scene0_shell7 remove
	}

	wait 4

	iprintlnbold_noloc("Hint: the bazooka will respawn after a few seconds.")	
}end

//==="STARTING TRENCH" ***//
//=========================================================================
scene0:{
//=========================================================================
	thread CaptainRamsey
	thread airborneguys
}end

//======================================================================================================

//==="HALFTRACK AMBUSH" ***//

//***Called from the bsp just before the halftrack clearing by player/monster passing through a trigger_once

scene1:
	thread halftrack_ambush
	thread scene1_ai_wave1
	thread scene1_captain_takecover
end

//======================================================================================================

//==="AIRBORNE CONVERSATION" ***//
scene2:
//This thread is never actually called.
end

//======================================================================================================

//TOWN ENTRANCE AND MAIN STREET
//=========================================================================
scene3:{
//=========================================================================
	thread coop_mod/spawnlocations.scr::m3l3_update2	//chrissstrahl - spawn townentrance, near destroyed car along the wall

	thread scene3_machineguns
	thread scene3_spawner1_initialize
	thread scene3_spawner2_initialize
	thread scene3_spawner3_initialize
	thread scene3_spawner4_initialize
	thread scene3_spawner5_initialize
	thread scene3_ai_setup

	thread quick_farplane_near
}end

//======================================================================================================

//==="TOWN CENTRAL" ***//

scene4:
	thread quick_farplane_near_extra
//	centerprint "SCENE 4: The Tiger Tank (dev text)"
	//===*Autosave*
	if(level.gametype == 0){ //chrissstrahl - do only in sp
		println "AUTOSAVING NOW FOR THE TIGER TANK"
		exec global/autosave.scr 2	//"Tiger tank"
	}
	thread scene4_manualgun1
	thread scene4_spawner1_initialize
	thread scene4_spawner2_initialize
	thread scene4_spawner3_initialize
	thread scene4_spawner4_initialize
	thread scene4_mgfodder
	thread scene4_teammate_cover
end

//==="TOWN SOUTH SIDE" ***//
scene5:
end

//==="CHURCH BATTLE" ***//
scene6:
//	centerprint "SCENE 6: The Church Battle (dev text)"
	thread quick_farplane_far

	//===*Autosave*
	if(level.gametype==0){ //chrissstrahl - do only in sp
		exec global/autosave.scr 3	//"Church and cemetery"
	}else{
		thread coop_mod/spawnlocations.scr::m3l3_update4	//chrissstrahl - spawn before church, along the wall
	}

	thread scene6_friendly_dumbdown

	thread scene6_spawner1_initialize
	thread scene6_spawner2_initialize

	thread scene6_mgspawner1_initialize
	thread scene6_mgspawner2_initialize
	thread scene6_mgspawner3_initialize
end

//======================================================================================================

//==="NEBELWERFER BATTLE" ***//

scene7:
	thread coop_mod/spawnlocations.scr::m3l3_update5 //chrissstrahl - spawn near nebelwerfers

//	centerprint "SCENE 7: The Nebelwerfer Battle (dev text)"

	//===*Autosave*
	if(level.gametype == 0){ //chrissstrahl - do only in sp
		exec global/autosave.scr 4	//"Nebelwerfer field"
	}

//	$world farplane 7500
	thread scene7_nebelwerfer_initialize
	thread scene7_nebelwerfer1_control
	thread scene7_nebelwerfer2_control
	thread scene7_nebelwerfer3_control
	thread scene7_nebelwerfer4_control

	thread scene7_minefields
	thread scene7_initialize_bombsites
	thread scene7_bombtracker

	thread scene7_mgspawner1_initialize
	thread scene7_mgspawner2_initialize
	thread scene7_mgspawner3_initialize
	thread scene7_mgspawner4_initialize
	thread scene7_mgspawner5_initialize

	thread scene7_spawner1_initialize
	thread scene7_spawner2_initialize
	thread scene7_spawner3_initialize
end

//==============================================================================================================================================//
//																								//
//										SCENE 0 SUPPORT THREADS											//
//																								//
//==============================================================================================================================================//

CaptainRamsey:
	//===Setup for Captain Ramsey

	level.ramsey.accuracy		= 20		//marksmanship
	level.ramsey.mindist		= 128		//range to stop closing in
	level.ramsey.maxdist		= 4000	//range to close to on enemy for longest range shot
	level.ramsey nodamage				//invulnerability
	level.ramsey.leash		= 640
	//level.ramsey tether $player //chrissstrahl
	//level.ramsey.destination = $player //chrissstrahl
	level.ramsey exec coop_mod/main.scr::tether		//chrissstrahl - make coop compatible
	level.ramsey exec coop_mod/main.scr::destination	//chrissstrahl - make coop compatible
	level.ramsey.sight		= 4000
	level.ramsey.noticescale	= 1
	level.ramsey.waittime		= 0.1		//respond as fast as possible to player movement

	//===Ramsey follows the player

	level.ramsey thread global/friendly.scr::friendlythink
	level.ramsey.friendtype = 1 //toggle this to -1 to shut down following
	level.ramsey.distance = 192

	//===Ramsey speaks to player
	wait 1.5
	level.ramsey say dfr_before_043c_3
	wait 1
	level.ramsey say dfr_follow_02h_1
end

//============================================================//

scene0_panzerschreck_trigger:
	//===Vanish the panzerschreck and rocket scriptmodels when the player gets close

	//===Add a panzerschreck and some rockets to the player's inventory and play the pickup sounds
	if(level.gametype == 0){//chrissstrahl - do only in sp - we place PANZERSCHRECK near halftrack in coop - see main:
		$scene0_panzerschreck remove
		$scene0_shell1 remove
		$scene0_shell2 remove
		$scene0_shell3 remove
		$scene0_shell4 remove
		$scene0_shell5 remove
		$scene0_shell6 remove
		$scene0_shell7 remove
	
		$player playsound panzerschreck_snd_pickup
		//$player playsound panzerschreck_snd_pickup_ammo //chrissstrahl
		$player item weapons/panzerschreck.tik
		//$player ammo heavy 6 //chrissstrahl
		iprintln "You have the Panzerschreck."
		
		//chrissstrahl - this will only happen in coop
		//exec coop_mod/replace.scr::ammo heavy 6 panzerschreck_snd_pickup_ammo //[200] Smithy - not needed now... also, this should be outside this if statement anyway (with an 'end' in here)...
	}	
end

//==============================================================================================================================================//
//																								//
//										SCENE 1 SUPPORT THREADS											//
//																								//
//==============================================================================================================================================//

//HALFTRACK AMBUSH
//=========================================================================
halftrack_ambush:{
//=========================================================================
		thread coop_mod/spawnlocations.scr::m3l3_update1	//chrissstrahl - spawn near halftrack, inside cover area
		//===Called from thread scene1
		//===Set up the halftrack's physical properties and its death sequence (check with Z for removal, immunity, and health)
		$halftrack thread global/vehicles_thinkers.scr::enemy_half-trak_think
		$halftrack.health = 300

		//===Set up the gunner's shield
		//chrissstrahl - fixme - removed shield to see if gunner then works
		//chrissstrahl - test failed, it will still not work right, gun attachment issue
		$halftrack attachmodel "vehicles/sdkfz_shield.tik" "shield" 1.5 "halftrack_gunnershield"
		$halftrack_gunnershield.angles = (0 270 0)

		//[200] Smithy - WORK, DAMN YOU!
		$halftrack.mg42 remove
		$halftrack.mg42 = spawn "models/vehicles/sdkfz_mg42.tik"
		$halftrack.mg42 notsolid
		thread bruteForceMGOrigin $halftrack.mg42 $halftrack_gunnershield
		local.player = exec coop_mod/replace.scr::player_closestTo $halftrack_gunner //[200] Smithy - get a target right away (just to make gun point in right direction)
		
		local.player = NULL
		$halftrack.mg42 setAimTarget local.player
		$halftrack_gunner lookat local.player
		$halftrack_gunner turnto local.player

		//===Set up the gunner
		//===Start the halftrack moving
		$halftrack thread halftrack_drive

		//===Start the halftrack firing at the player if the player is in the danger zone
		
		//[200] Smithy - no need for this here, it can be sorted out in the mg_targeting thread
		//chrissstrahl - make sure this is coop compatible
		//local.closestVictim = $world
		//while !($halftrack_gunner cansee local.closestVictim 0 3050){
		//	local.closestVictim = exec coop_mod/replace.scr::player_closestTo $halftrack_gunner
		//	$halftrack_gunner lookAt local.closestVictim
		//	wait 0.25
		//}

		thread halftrack_hint		
		$halftrack.mg42 thread halftrack_mg_targeting
		thread halftrack_final_collision
}end

//[200] Smithy - NEW FUNC - fuck this shit, I'll brute force it instead
//=========================================================================
bruteForceMGOrigin local.mg local.pos:{
//=========================================================================
	while (local.pos){
		local.mg.origin = (local.pos.origin + (0 0 25))
		waitframe
	}
	if (local.mg){
		local.mg remove
	}
	if ($masterhead){ //be resourceful and remove two extra entities we created
		$masterhead.croid remove
		$masterhead remove
	}
}end

//============================================================//

halftrack_hint:
	//chrissstrahl - handle this right
	if (int(level.skill) < 2){
		iprintlnbold "HINT: Switch to your Panzerschreck (rocket launcher) to destroy the halftrack."		
	}
end

//============================================================//

halftrack_final_collision:
	$halftrack waittill death
	level.halftrack_alive = 0 	//the halftrack is dead and the binoculars make a proper sound for this

	local.vec = $halftrack.collisionent.angles
	local.vec[0] = 0
	local.vec[2] = 0
	$halftrack_final_collisionmask.angles = local.vec
	$halftrack_final_collisionmask.origin = $halftrack.collisionent.origin
	$halftrack_final_collisionmask disconnect_paths
end

//$halftrack_final_collisionmask

//============================================================//

halftrack_drive:
	//===Drive the halftrack
	self drive $(self.targetname + "_path") 800 520 40 128 	//ideal speed, acceleration/deceleration, close to nodes, lookahead 200 80 40 128
	self modifydrive 80 50 256						//bump down the speed a bit	60 50 256 (original)
	self waittill drive
	self disconnect_paths
	level.halftrack_driving_done = 1
end

//=========================================================================
halftrack_mg_targeting:{
//=========================================================================
//===Make the mg42 target the script_origins bound to the player to simulate near-misses for some amount of time, then go for the player

	if !(isAlive $halftrack){ end }

	//local.closestVictim = exec coop_mod/replace.scr::player_closestTo $halftrack_gunner
	//$halftrack_gunner lookAt local.closestVictim

	//local.player = NULL
	//while !($halftrack_gunner cansee $player 0 3050)	//chrissstrahl
	//[200] chrissstrahl - make sure we grab player right away
	local.player = $halftrack_gunner exec coop_mod/replace.scr::canseeGetClosest 200 3750 //[200]Smithy - tweaked //0 3050 //chrissstrahl - coop mod replacment
	while (local.player == NULL){		
		wait 1 //[200] chrissstrahl - changed to 1 from 2 secs - this function needs to be reworked anyway
		local.player = $halftrack_gunner exec coop_mod/replace.scr::canseeGetClosest 200 3750 //[200]Smithy - tweaked //0 3050 //chrissstrahl - coop mod replacment
		//println "+++++ I CANT SEE YOU ++++++" //[200] chrissstrahl - stop console spam
		if !(isAlive $halftrack)
			end
	}
	$halftrack_gunner lookat local.player 	//[200] Smithy - make gunner look dynamically	
	$halftrack_gunner turnto local.player
	thread setupPlayerHeadPos local.player 	//[200] Smithy - set up the head!

	self startfiring	
	self maxyawoffset 55	
	
	if( level.gametype == 0){ //chrissstrahl - sp only	
		self bulletdamage 200
		self bulletspread 1 1 

		self setaimtarget $playertarget_front1
		println "Aiming for misspoint1"
			
		wait 1.25 	//original 1.5	
		if !(isAlive $halftrack)
			end
					
		self setaimtarget $playertarget_front2
		println "Aiming for misspoint2"
			
		wait 0.75 	//original 1.5
		if !(isAlive $halftrack){ end }
	}
	
	//println "Aiming for PLAYER!!!!!" 	//[200] chrissstrahl - stop console spam
	self setaimtarget group.head 		//[200] Smithy - aim at head instead

	//===*DIFFICULTY* SELECTOR
	local.bulletdamage = 50
	local.bulletspread = 40
	
	if(level.gametype == 0){ //chrissstrahl - do only in sp
		if (level.skill == "1"){
			local.bulletdamage = 30
			local.bulletspread = 80
		}
		else if (level.skill == "0"){
			local.bulletdamage = 25
			local.bulletspread = 90
		}
	}
	
	for (local.i = 1; local.i < 16; local.i ++){
		//[200] Smithy - we don't need a loop. this gets caught and continues firing indefinitely. it now reflects SP
		//[200] chrissstrahl - fix gunner grabbing NULL player
		//local.player = $halftrack_gunner exec coop_mod/replace.scr::canseeGetClosest 0 3050
		//while(local.player == NULL){
			//waitframe
			//local.player = $halftrack_gunner exec coop_mod/replace.scr::canseeGetClosest 0 3050
		//}
		//end chrissstrahl
		if (!isAlive local.player){ 															//[200] Smithy - check for NULL or dead players
			wait 1.5																			//[200] Smithy - breathing space, also looks more realistic	
			//[205] chrissstrahl - fix NULL
			if(self){ self stopfiring }
			
			local.player = $halftrack_gunner exec coop_mod/replace.scr::canseeGetClosest 200 3750 //[200]Smithy - tweaked //0 3050
			if (local.player != NULL){		
				thread setupPlayerHeadPos local.player 											//[200] Smithy - set up the head!
				//[205] chrissstrahl - fix NULL
				if(self){
					self setaimtarget group.head													//[200] Smithy - target next player	
					self startfiring
				}
			}else{
				break 																			//[200] Smithy - OK, still NULL, lets cycle out and wait at top of func for next valid player
			}
			$halftrack_gunner lookat local.player 												//[200] Smithy - make gunner look dynamically
			$halftrack_gunner turnto local.player
		}	
		if !(isAlive $halftrack){ end }
		
		if (vector_within local.player $halftrack 1400){ //[200] Smithy - tweaked (original: 2300) so we can get closer and pick up zooka
			//println "SUPER POWERFUL MODE" //[200] chrissstrahl - stop console spam
			self bulletdamage 5000
			self bulletspread 10 10
		}else{			
			self bulletdamage local.bulletdamage
			self bulletspread local.bulletspread local.bulletspread
		}
		wait 0.25
	}
	self stopfiring

	//===Give the player some breathing time here
	//===*DIFFICULTY* SELECTOR
	//chrissstrahl - adjust for coop
	//local.waitTime = 2
	local.waitTime = 1.5 	//[200] Smithy - adjusted a bit more
	
	if(level.gametype == 0){ //chrissstrahl - do only in sp
		if (level.skill == "0"){
			local.waitTime = 2.5
		}else if (level.skill == "2"){
			local.waitTime =  1.5
		}
	}else if($player && $player.size < 3 ){ //chrissstrahl - 1 or 2 players, wait some extra time
		//local.waitTime = 1
		local.waitTime += 1 //[200] Smithy - I assume you wanted to add instead
	}
	wait local.waitTime
	//===Resume scanning	
	goto halftrack_mg_targeting
}end

//[200] Smithy - new func - aim a bit higher from the player's centroid.
//this is needed because BT's targeting system is a little silly.
//it constantly aims at the player's centroid (centre mass),
//even when they are hiding behind a wall or ditch.
//so it just shoots at the ground (or wall) like a moron.
//Pair that with the fact that we can now move to the crater to grab a zooka...
//...and we had a recipe for stupid. This is better.
//=========================================================================
setupPlayerHeadPos local.player:{
//=========================================================================
	if (!group.head){ 										//only spawn one head for all players
		group.head 			= spawn script_object
		group.head.croid	= spawn script_object
		group.head targetname "masterhead"
	}
	if (group.head.player == local.player){					//don't bother doing a setup if player is the same
		end
	}
	group.head.croid unglue 								//reset any previous binds
	group.head unbind
	group.head.player = local.player
	group.head.croid duckableglue group.head.player			//this centroid position is needed for the head to bind		  
	group.head origin (group.head.croid.origin + (0 0 75))  //make the head near...the head, duh :P
	group.head bind group.head.croid                  		//make the head follow the player
}end

	
//SCENE 1 CAPTAIN BEHAVIOR & AIRSTRIKE
//=========================================================================
trigger_bomber:{
//=========================================================================
	//===Called by a trigger_clickitem
	local.player = parm.other

	if !(isAlive $halftrack){
	//	$player playsound airstrike_invalid_target
		local.player playsound snd_binoculars
		// halftrack is already dead
		end
	}

	if (level.scene1_enroute == 2){
	//	$player playsound airstrike_invalid_target
		local.player playsound snd_binoculars
		end   //already done
	}
	
	if (level.scene1_enroute == 1){
		local.player playsound airstrike_already_enroute	//"Target already acquired. Over."
		end
	}

	level.scene1_enroute = 1

	local.player playsound airstrike_valid_target	//"Roger. Target acquired." 
	
	while (level.halftrack_driving_done != 1){
		wait 1
	}

	wait 10	//plane takes some time to arrive on target

	thread global/bomber.scr::bomb 1
	wait 1
	$bomberplane1 playsound m3l3_airstrike_first_plane
	
	wait 4
	thread global/bomber.scr::bomb 2
	wait 1
	$bomberplane2 playsound m3l3_airstrike_second_plane
}end

//=========================================================================
bomb_explodes:{
//=========================================================================
	//===Called by global/bomber.scr when the bomb explodes
	//[200] chrissstrahl - VICTORY!!! One less anoying console error
	if($halftrack.health > 1){
		$halftrack.health = 1
	}
	radiusdamage ( ($halftrack.origin) + (0 0 16) ) 200 200

	println "z:       running the bomb explosion thread"
//	if !(isAlive $halftrack)
//	{
//		println "z:       halftrack already dead. ending bomb explosion thread."
//		end
//	}
	level.scene1_enroute = 2
	wait 2

	//===Pilot is out of ammo and flies away to safety

	//"Echo Charlie out of ammo. Returning to base. You're on your own down there. Good luck. Over and out."
	exec coop_mod/replace.scr::playsound dfr_m3l3_add10	//chrissstrahl - compatible to coop
}end


//===Captain Ramsey runs to a good cover spot, anchors to it, then gives the player the hint to use the panzerschreck every so often
//=========================================================================
scene1_captain_takecover:{
//=========================================================================
	level.ramsey.friendtype = -1								//Stop Captain from following player
	level.ramsey exec global/disable_ai.scr 					//Shut down Captain's AI
	level.ramsey exec global/runto.scr $scene1_captain_halftrack_node	//Make Captain run to a good cover location behind the tank wreck
	level.ramsey waittill movedone								//Pause thread till he's there
	level.ramsey tether $scene1_captain_halftrack_node			//Keep him tied to that spot
	level.ramsey.leash = 64										//Keep him from moving away from that location
	level.ramsey exec global/enable_ai.scr						//Let him fire at the enemies

	if (isAlive $halftrack){
		level.ramsey say dfr_target_023j_3						//"TAKE OUT THAT HALFTRACK!"
		level.ramsey waittill saydone
	}

	wait 1

	//===While player is not within range of Captain, check to see if halftrack is alive. If it is, stop. If not, give a hint. Infinite loop.

	while (isAlive $halftrack){
		//[202] chrissstrahl - if there is no player pause this
		while!($player){
			wait 2
		}
		if (exec coop_mod/replace.scr::withinDistanceOf level.ramsey 128){
			//Make him stare at the player
			level.ramsey exec coop_mod/replace.scr::lookat	//chrissstrahl - coop compatible
			level.ramsey say dfr_directive_142j_1 			//"Use your panzerschreck!"
			level.ramsey waittill saydone
			level.ramsey lookAt NULL						//Stop staring at the player
			wait 15
		}
		wait 1
	}
	thread scene1_captain_leavecover	//Make Captain resume normal behavior
}end

//fiendlyFollow
scene1_captain_leavecover:
	//Restore to factory defaults for the Captain
	level.ramsey.fixedleash = 0
	level.ramsey.leash = 640
	//level.ramsey tether $player //chrissstrahl
	level.ramsey exec coop_mod/main.scr::tether //chrissstrahl - make coop compatible
	level.ramsey.friendtype = 1
	level.ramsey lookAt NULL
end

//================================================================//
//											//
//			 SCENE 1 AIRBORNE TROOPS				//
//											//
//================================================================//

airborneguys:
	//===Keep the Airborne troops from joining in until they're discovered by the player
	level.harrison exec global/disable_ai.scr
	level.tomlin exec global/disable_ai.scr
	level.harrison nodamage
	level.tomlin nodamage
	level.harrison.accuracy = 95
	level.tomlin.accuracy = 100
end

//================================================================//
//											//
//				AI ATTACK WAVE1					//
//											//
//================================================================//

scene1_ai_wave1:

	local.scene1_teamlimit = 0		//initializes variable for maximum number available for the first attack wave, set in the following while loop
	level.scene1_currentalive = 0		//initializes variable for number of enemies currently alive in this scene
	local.scene1_currentalivemax = 2	//initializes variable for maximum number allowed at any given time in this scene
	local.loopwaittime = 1			//initializes variable for time between respawn checks
	level.scene1_waveterminate = 0	//initializes variable for terminating respawn loop if player gets too close to the spawn points
	local.scene1_populationmax = 6	//initializes constant for total number to spawn altogether
	local.scene1_ai_path = 1

	while (local.scene1_teamlimit < local.scene1_populationmax && level.scene1_waveterminate == 0) //populationmax enemies spawn, stop loop if halftrack dies or player crosses proximity trigger
	{
		if ((level.scene1_currentalive + local.scene1_currentalivemax) <= local.scene1_currentalivemax && level.scene1_waveterminate == 0)
		{
			local.scene1_teamlimit ++								//track the scene's enemy population
			local.scene1_ai_name = "scene1_ai_wave1_" + local.scene1_teamlimit	//assign a name to the spawned enemy

			if (local.scene1_ai_path == 1)
			{
				local.org = $scene1_ai_wave1_spawner1.origin				//spawn location as an info_waypoint
				local.scene1_ai_path = 2							//set path choice to oscillate between one and two
			}
			else
			if (local.scene1_ai_path == 2)
			{
				local.org = $scene1_ai_wave1_spawner2.origin
				local.scene1_ai_path = 1
			}

		//===Spawn enemy soldier and assign a targetname

			spawn models/human/german_waffenss_shutze "targetname" (local.scene1_ai_name) "type_attack" "cover"

			$(local.scene1_ai_name).mindist = 128
			$(local.scene1_ai_name).maxdist = 900
			$(local.scene1_ai_name).leash = 10000
			$(local.scene1_ai_name).fixedleash = 0
			$(local.scene1_ai_name).sight = 4000
			$(local.scene1_ai_name).noticescale = 40
		
		//===*DIFFICULTY* SELECTOR

			if (level.skill == "0")
			{
				$(local.scene1_ai_name).accuracy = 5
			}
			else
			if (level.skill == "1")
			{
				$(local.scene1_ai_name).accuracy = 60
			}
			else
			if (level.skill == "2")
			{
				$(local.scene1_ai_name).accuracy = 95
			}

			$(local.scene1_ai_name) dontdropweapons

			$(local.scene1_ai_name).origin = local.org

			level.scene1_currentalive ++								//increment the max allowed alive at any given time
			local.scene1_ai_name thread scene1_detect_death 				//call a waittill death thread

			thread scene1_ai_navigate local.scene1_ai_name local.scene1_ai_path	//call navigation thread for AI to run a path (see next thread)

//			centerprint ("\n\n\n\n\n\n\n\n\Current alive (2):" + level.scene1_currentalive + "\nTeam Limit(6):" + local.scene1_teamlimit + "\n Halftrack" + level.halftrack_is_alive)

		}

		wait local.loopwaittime										//every local.loopwaittime seconds, resume the while loop
	}
end

//============================================================//

scene1_detect_death:
	self waittill death
	level.scene1_currentalive --	//decrement the population count
end

//============================================================//

scene1_ai_navigate local.scene1_ai_name local.scene1_ai_path:
	$(local.scene1_ai_name) forceactivate
	$(local.scene1_ai_name) exec global/runto.scr $("scene1_pathnode" + local.scene1_ai_path)
	$(local.scene1_ai_name) waittill movedone
end

//============================================================//

scene1_waveterminate_trigger:

	//===This is the definitive scene concluding trigger. Either scene2 will commence immediately, or after a brief fight, scene2 will commence.

	//===Halftrack cannot be beaten without a panzerschreck hit. I am assuming the halftrack is dead if player can reach this trigger alive.

	//===Player has gotten too close to the Airborne guys, set 'stop spawning' condition on the enemy spawner, prepare to reveal Airborne guys

		level.scene1_waveterminate = 1

	//***	There are two triggers in the level. Once one of them is triggered, the other should be defunct.
	//===If there are no previously spawned enemy soldiers alive AND the halftrack is dead, use this extra line
	//===If previously spawned soldiers are still on the loose AND the halftrack is dead, let the Airborne guys join in and help finish them off

	if (level.scene1_waveterminate_trigger_used != 1){
		level.scene1_waveterminate_trigger_used = 1

		if ((level.scene1_currentalive == 0) && !(isAlive $halftrack)){
			level.harrison say dfr_M3L3_352c	//"Hold your fire! 101st Airborne coming out!"

			//===Now make them do the cutscene conversation in a controlled location
			thread scene2_npc_blocking
		}else{
			thread scene1_airborne_cleanup_enemy
		}
	}
end

//============================================================//

scene1_airborne_cleanup_enemy:
	//===Direct the Airborne guys to initial nodes with their AI enabled

	level.harrison exec global/enable_ai.scr
	level.tomlin exec global/enable_ai.scr

	level.harrison exec global/runto.scr $scene1_harrison_attacknode
	level.tomlin exec global/runto.scr $scene1_tomlin_attacknode

	//===Idle the script while the fight is going on

	while (level.scene1_currentalive != 0){
		wait 1
	}

	//===Now all spawned guys are dead, so do the cutscene conversation
	thread scene2_npc_blocking
end

//==============================================================================================================================================//
//																								//
//										SCENE 2 SUPPORT THREADS											//
//																								//
//==============================================================================================================================================//

scene2_npc_blocking:
	//NPCs no longer follow the player for this cutscene
		level.ramsey.friendtype = -1
		level.harrison.friendtype = -1
		level.tomlin.friendtype = -1

	//===Make the three NPCs move to a common meeting place. Tomlin is the odd man out and goes towards the farthest person.
		level.ramsey runto level.harrison
		level.harrison runto level.ramsey

		while !(vector_within level.ramsey level.harrison 256){
			waitframe
		}

	//===Send Tomlin to join up.
		thread scene2_tomlin_blocking

	//===Stand still once within range of each other
		level.ramsey exec global/stand.scr
		level.harrison exec global/stand.scr

	//===Start the conversation
		thread scene2_dialogue
end

//============================================================//

scene2_tomlin_blocking:
	wait 3

	level.tomlin runto level.ramsey
	while !(vector_within level.tomlin level.ramsey 512){
		waitframe
	}
	level.tomlin exec global/stand.scr
end

//============================================================//

scene2_dialogue:

	//===*Autosave*

		exec global/autosave.scr 1	//"Paratroopers"

	//===The NPCs will not be pushed around by the player

		level.ramsey.avoidplayer = 0
		level.harrison.avoidplayer = 0

	//===Make Ramsey and Harrison idle more appropriately to the conversation

		level.harrison say dfr_m3l3_idle
		level.ramsey say dfr_m3l3_idle

	//===Make NPCs look where you want them to look, not just at the player

		level.harrison.look = 0
		level.ramsey.look = 0
		level.tomlin.look = 0

	//===Make the actors watch each other

		level.ramsey lookAt level.harrison
		level.harrison lookAt level.ramsey
		level.tomlin lookAt level.ramsey

		wait 1

	//===Run the dialogue

		level.harrison turnto level.ramsey
		level.harrison lookAt level.ramsey
		level.harrison say dfr_M3L3_356c	//"Sergeant Harrison, Pathfinders, 101st."
		level.harrison waittill saydone
		level.harrison say dfr_m3l3_idle
		wait 1

		level.ramsey turnto level.harrison
		level.ramsey say dfr_M3L3_357j	//"Good to meet you Sergeant Harrison, I'm Ramsey, 2nd Rangers."
		level.ramsey waittill saydone
		level.ramsey say dfr_m3l3_idle
		wait 1

		level.ramsey turnto level.harrison
		level.ramsey lookAt level.harrison
		level.ramsey say dfr_M3L3_353j 	//"You fellows seen any unusual looking German rocket launchers around here?"
		level.ramsey waittill saydone
		level.ramsey say dfr_m3l3_idle
		wait 0.25

		level.harrison turnto level.ramsey
		level.harrison lookAt level.ramsey
		level.harrison say dfr_M3L3_354c	//"Yes Captain we have. Just down the road a bit in fact."
		level.harrison waittill saydone
		level.harrison say dfr_m3l3_idle
		wait 0.25

		level.ramsey turnto level.harrison
		level.ramsey lookAt level.harrison
		level.ramsey say dfr_M3L3_360j	//"So what did these weapons look like?"
		level.ramsey waittill saydone
		level.ramsey say dfr_m3l3_idle
		wait 0.25

		level.harrison turnto level.ramsey
		level.harrison lookAt level.ramsey
		level.harrison say dfr_M3L3_361c	//"Well sir, we didn't exactly see them real close. But we heard them from a long ways off..."
		level.harrison waittill saydone
		level.harrison say dfr_m3l3_idle
		wait 0.5

	//***	Captain Ramsey will prompt the player to lead the way and the guys will stop staring at each other weirdly

		level.ramsey exec coop_mod/replace.scr::lookat //chrissstrahl - coop compatible
		level.ramsey exec coop_mod/replace.scr::turnto //chrissstrahl - coop compatible
		level.ramsey say dfr_m3l3_321j_1	//"Powell, you take point. Gentlemen, move out!"
		level.ramsey waittill saydone
		level.ramsey say dfr_m3l3_idle

		level.ramsey.avoidplayer = 1
		level.harrison.avoidplayer = 1

		level.ramsey lookat NULL
		level.harrison lookat NULL
		level.tomlin lookat NULL

//		if (level.skill == "0")
//		{
//			//===*Autosave*
//
//			exec global/autosave.scr 9	//"Bocage clearing"
//		}
//		else
//		if (level.skill == "1")
//		{
//			//===*Autosave*
//
//			exec global/autosave.scr 9	//"Bocage clearing"
//		}

	//===Call the ai_setup routine for Scene 3. This will be called again when the player runs through the actual Scene3 trigger, redundant.
	if (level.scene3_ai_setup_done == 1){
		end
	}

	thread scene3_ai_setup
end

//==============================================================================================================================================//
//																								//
//										SCENE 3 SUPPORT THREADS											//
//																								//
//==============================================================================================================================================//

scene3_ai_setup:
		if (level.scene3_ai_setup_done == 1){ end }

		level.scene3_ai_setup_done = 1
		
	//===Start monitoring for Ramsey, Harrison or Tomlin's death. 
		
		level.ramsey thread ramsey_death
		level.harrison thread harrison_death
		level.tomlin thread tomlin_death

	//===In case the player runs into the Scene 3 trigger during the conversation, make the NPCs follow him into action.
	//===Reset the friendly NPC turnto targets to nothing, reset lookAt back to player

		level.ramsey turnto NULL
		level.harrison turnto NULL
		level.tomlin turnto NULL

	if (level.harrison.friendtype != 1 || level.tomlin.friendtype != 1 || level.ramsey.friendtype != 1){
		level.harrison.friendtype = 1
		level.harrison thread global/friendly.scr::friendlythink
		//level.harrison.destination = $player //chrissstrahl
		level.harrison exec coop_mod/main.scr::destination	//chrissstrahl - make coop compatible
		level.harrison.distance = 200

		level.tomlin.friendtype = 1
		level.tomlin thread global/friendly.scr::friendlythink
		//level.tomlin.destination = $player //chrissstrahl
		level.tomlin exec coop_mod/main.scr::destination	//chrissstrahl - make coop compatible
		level.tomlin.distance = 200

		level.ramsey.friendtype = 1
		level.ramsey thread global/friendly.scr::friendlythink
		//level.ramsey.destination = $player //chrissstrahl
		level.ramsey exec coop_mod/main.scr::destination	//chrissstrahl - make coop compatible
		level.ramsey.distance = 192
	}

	//===Give the NPCs tons of health. This should be intended to last until after the tank sequence. They recharge at that point.
	//===It should be low enough that they'll die if the player relies too much on them.
		level.ramsey.health = 2200	//2000, 1400
		level.harrison.health = 2200	//2000, 1400
		level.tomlin.health = 2200	//2000, 1400
		
		if(level.gametype == 0){
			if (level.skill == "1"){
				level.ramsey.health = 1850	//2000, 1400
				level.harrison.health = 1850	//2000, 1400
				level.tomlin.health = 1850	//2000, 1400
			}else if (level.skill == "2"){
				level.ramsey.health = 1700	//2000, 1400
				level.harrison.health = 1700	//2000, 1400
				level.tomlin.health = 1700	//2000, 1400	
			}
		}

	//===Toggle invulnerability here for testing if needed

		level.ramsey takedamage				//vulnerability
		level.harrison takedamage 			//vulnerability
		level.tomlin takedamage				//vulnerability

//		level.ramsey nodamage				//invulnerability
//		level.harrison nodamage				//invulnerability
//		level.tomlin nodamage				//invulnerability

	level.ramsey exec global/enable_ai.scr
	level.ramsey.accuracy		= 35			//chrissstrahl - moved here for coop
	if(level.gametype == 0 && int(level.skill) < 2){ //chrissstrahl - handle for sp
		level.ramsey.accuracy	= 20	//marksmanship, 20
	}

	level.ramsey.mindist		= 256	//range to stop closing in
	level.ramsey.maxdist		= 4000	//range to close to on enemy for longest range shot
	level.ramsey.leash			= 800	//original 800, then 500
	//level.ramsey tether $player //chrissstrahl
	level.ramsey  exec coop_mod/main.scr::tether	//chrissstrahl - make coop compatible
	level.ramsey.sight			= 4000
	level.ramsey.noticescale	= 1
	level.ramsey.waittime		= 0.1
	level.ramsey.distance		= 256
	level.ramsey.interval		= 256

	//chrissstrahl - this way it is better organized
	level.harrison thread setupExpandable
	level.tomlin thread setupExpandable
end

//chrissstrahl - PUT THIS ALL IN ONE THREAD
//=========================================================================
setupExpandable:{
//=========================================================================
	self exec global/enable_ai.scr
	
	self.accuracy		= 26 //chrissstrahl - moved here for coop
	if(level.gametype == 0 && int(level.skill) < 2){ //chrissstrahl - handle for sp	
		self.accuracy = 16		//marksmanship, 16
	}
	self.mindist		= 256		//range to stop closing in
	self.maxdist		= 4000	//range to close to on enemy for longest range shot
	self.leash		= 1200	//original 800, then 600
	//self tether $player //chrissstrahl
	self exec coop_mod/main.scr::tether	//chrissstrahl - make coop compatible
	self.sight		= 4000
	self.noticescale	= 1
	self.waittime		= 0.1
	self.distance		= 256
	self.interval		= 256
}end

//============================================================//

ramsey_death:
	self waittill death
	local.speaker = spawn script_model
	local.speaker notsolid
	local.speaker.origin = self.origin
	local.speaker playsound dfr_panic_35c_13	//"Medic!"
	iprintlnbold "Captain Ramsey has been killed in action."
end

//============================================================//

harrison_death:
	self waittill death
	local.speaker = spawn script_model
	local.speaker notsolid
	local.speaker.origin = self.origin
	local.speaker playsound dfr_panic_35c_13	//"Medic!"
	iprintlnbold "Sergeant Harrison has been killed in action."
end

//============================================================//

tomlin_death:
	self waittill death
	local.speaker = spawn script_model
	local.speaker notsolid
	local.speaker.origin = self.origin
	local.speaker playsound dfr_panic_35c_13 //"Medic!"
	iprintlnbold "Private Tomlin has been killed in action."
end

//============================================================//

scene3_machineguns:
	//===Power up the machineguns along the main street
	if (level.sysconfig == "0"){	
		$scene3_mg1 thread global/mg42_active.scr::mg42 2200
		$scene3_mg2 thread global/mg42_active.scr::mg42 2000
		$scene3_mg3 thread global/mg42_active.scr::mg42 1960
		$scene3_mg4 thread global/mg42_active.scr::mg42 1750
		$scene3_mg5 thread global/mg42_active.scr::mg42 2000
	}else if (level.sysconfig == "1"){
		$scene3_mg1 thread global/mg42_active.scr::mg42 3220	//2220
		$scene3_mg2 thread global/mg42_active.scr::mg42 3000	//2000
		$scene3_mg3 thread global/mg42_active.scr::mg42 3050	//2050
		$scene3_mg4 thread global/mg42_active.scr::mg42 3000	//2000
		$scene3_mg5 thread global/mg42_active.scr::mg42 3000	//2000
	}else if (level.sysconfig == "2"){
		$scene3_mg1 thread global/mg42_active.scr::mg42 6000
		$scene3_mg2 thread global/mg42_active.scr::mg42 6000
		$scene3_mg3 thread global/mg42_active.scr::mg42 6000
		$scene3_mg4 thread global/mg42_active.scr::mg42 6000
		$scene3_mg5 thread global/mg42_active.scr::mg42 6000
	}
	$scene3_mg1 thread scene3_mg_targeting $scene3_mg1_gunner
	$scene3_mg2 thread scene3_mg_targeting $scene3_mg2_gunner
	$scene3_mg3 thread scene3_mg_targeting $scene3_mg3_gunner
	$scene3_mg4 thread scene3_mg_targeting $scene3_mg4_gunner
	$scene3_mg5 thread scene3_mg_targeting $scene3_mg5_gunner
end

//============================================================//

scene3_mg_targeting local.mgoperator:
	local.bulletDamage = 60
	local.waitTime = 3
	if( level.gametype == 0){ //chrissstrahl - sp only
		if (level.skill == "0"){
			local.bulletDamage = 10
			local.waitTime = 0.5	
		}else if (level.skill == "1"){
			local.bulletDamage = 30
			local.waitTime = 3
		}
	}

	while (isAlive local.mgoperator){
		self startfiring
	
		local.player = local.mgoperator exec coop_mod/replace.scr::canseeGetClosest //chrissstrahl - get closest seen player
		
		if (local.player != NULL){
			self maxyawoffset 45
			
			if( level.gametype == 0){ //chrissstrahl - sp only
				self setaimtarget $playertarget_left1
				wait 1
			
				if !(isAlive local.mgoperator){
					self bulletdamage 500	
					end
				}

				self setaimtarget $playertarget_left2
				wait .5

				if !(isAlive local.mgoperator){
					self bulletdamage 500	
					end
				}
			}

			self setaimtarget local.player
			self bulletdamage local.bulletDamage
			wait local.waitTime

			if !(isAlive local.mgoperator){
				self bulletdamage 500	
				end
			}
		}
		if (isAlive level.tomlin){
			if (local.mgoperator cansee level.tomlin){
				self maxyawoffset 45
				self setaimtarget level.tomlin
				wait 1
	
				if !(isAlive local.mgoperator){
					self bulletdamage 500	
					end
				}
			}
		}

		if (isAlive level.harrison){
			if (local.mgoperator cansee level.harrison){
				self maxyawoffset 45
				self setaimtarget level.harrison
				wait 1

				if !(isAlive local.mgoperator){
					self bulletdamage 500	
					end
				}
			}
		}

		if (isAlive level.ramsey){
			if (local.mgoperator cansee level.ramsey){
				self maxyawoffset 45
				self setaimtarget level.ramsey
				wait 0.5

				if !(isAlive local.mgoperator){
					self bulletdamage 500	
					end
				}
			}
		}
		
		self stopfiring
		wait 1

		if !(isAlive local.mgoperator){
			self bulletdamage 500	
			end
		}
	}
end

//============================================================//

scene3_spawner1_initialize:
	level.scene3_spawn1_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene3_spawn1_teamlimitmax = 12	//initializes constant for total number allowed to spawn (original = 30)
	level.scene3_spawn1_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene3_spawn1_currentalivemax = 3	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene3_spawn1_loopwaittime = 1	//initializes constant for time between respawns
	level.scene3_spawn1_deactivator = 0		//initializes variable for shutting down this loop's ability to spawn when the player is past this area
	level.scene3_spawn1_hintdone = 0		//initializes whether or not the 'right flank' phrase has been uttered or not
	level.scene3_spawn1_hintdone2 = 0		//initializes whether or not the 'press on their positions' phrase has been uttered or not
	thread scene3_spawndetector1_control
end

//============================================================//

scene3_spawn1_hint:
	//===Have an NPC issue a hint to the player that the right flank could be attacked.
	if !(level.scene3_spawn1_hintdone == 1){
		level.scene3_spawn1_hintdone = 1	//execute this thread only once as it originates in the scene3_spawndetector1_control while loop
		wait 9

		if !(isAlive level.harrison){ end }

		level.harrison exec global/disable_ai.scr	//shut off ai briefly
		level.harrison nodamage				//invulnerability so he doesn't get interrupted with pain animations if under fire
		level.harrison exec global/crouch.scr	//crouching looks smart
		level.harrison turnto $scene3_mg2		//look towards the so-called right flank of this situation
		//level.harrison say dfr_directive_193h_11	//"Right flank!" //[200] Smithy
		level.harrison thread coop_mod/replace.scr::say_wait "dfr_directive_193h_11" //[200] Smithy - coop compatibility
		level.harrison waittill saydone
		wait 2

		if !(isAlive level.harrison){ end }

		level.harrison turnto NULL			//reset this to nothing
		level.harrison takedamage			//back to vulnerable mode again
		level.harrison exec global/enable_ai.scr	//back to normal intelligence again
	}
end

//============================================================//

scene3_spawn1_hint2:
	//===Have an NPC issue a hint to the player that the right flank could be attacked.
	if !(level.scene3_spawn1_hintdone2 == 1){
		level.scene3_spawn1_hintdone2 = 1	//execute this thread only once as it originates in the scene3_spawndetector1_control while loop
		wait 30

		if !(isAlive level.ramsey){ end }

		level.ramsey exec global/disable_ai.scr	//shut off ai briefly
		//level.ramsey say dfr_before_004j_2	//"We gotta press on their positions!" //[200] Smithy 
		level.ramsey thread coop_mod/replace.scr::say_wait "dfr_before_004j_2" //[200] Smithy - coop compatible
		level.ramsey waittill saydone

		if !(isAlive level.ramsey){ end }
		wait 2
		level.ramsey exec global/enable_ai.scr	//back to normal intelligence again
	}
end

//============================================================//

scene3_spawndetector1_control:
	if (level.scene3_spawn1_deactivator == 1){ end }
	local.loopwaittime = 0.8 //original 0.2

	while (exec coop_mod/replace.scr::istouching $scene3_spawndetector1){ //chrissstrahl - make coop compatible		
		//===3 at a time, use +3, use +2 or +1 for a tougher challenge (add higher numbers to tune respawns to easier levels)
		//===Crazy overwhelming fire and maneuver enemy attack, use nothing

//		if ((level.scene3_spawn1_currentalive + 3) <= level.scene3_spawn1_currentalivemax && level.scene3_spawn1_deactivator == 0 && level.scene3_spawn1_teamvalue < level.scene3_spawn1_teamlimitmax)
//		if ((level.scene3_spawn1_currentalive) <= level.scene3_spawn1_currentalivemax && level.scene3_spawn1_deactivator == 0 && level.scene3_spawn1_teamvalue < level.scene3_spawn1_teamlimitmax)
		if ((level.scene3_spawn1_currentalive + level.scene3_spawn1_currentalivemax) <= level.scene3_spawn1_currentalivemax && level.scene3_spawn1_deactivator == 0 && level.scene3_spawn1_teamvalue < level.scene3_spawn1_teamlimitmax){
			thread scene3_spawn1_hint	//give the player a hint as to where the enemy will really approach to do serious damage
			thread scene3_spawn1_hint2	//give the player a hint that he has to push forward and attack

//			centerprint(level.scene3_spawn1_currentalive + "<" + level.scene3_spawn1_currentalivemax + "\n" + level.scene3_spawn1_deactivator + "=" + level.scene3_spawn1_deactivator+ "\n" + level.scene3_spawn1_teamvalue + "<" + level.scene3_spawn1_teamlimitmax )

			local.scene3_spawn1_ai_name1 = "scene3_spawn1_ai1_" + level.scene3_spawn1_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene3_spawndetector1_spawner1.origin						//spawn location as a script_origin

			local.scene3_spawn1_ai_name2 = "scene3_spawn1_ai2_" + level.scene3_spawn1_teamvalue
			local.org2 = $scene3_spawndetector1_spawner2.origin

			local.scene3_spawn1_ai_name3 = "scene3_spawn1_ai3_" + level.scene3_spawn1_teamvalue
			local.org3 = $scene3_spawndetector1_spawner3.origin

		//===Spawn 3 enemy soldiers in a wave
			spawn models/human/german_waffenss_nco "targetname" (local.scene3_spawn1_ai_name1) "type_attack" "cover"
			$(local.scene3_spawn1_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene3_spawn1_currentalive ++							//increment the max allowed alive at any given time
			level.scene3_spawn1_teamvalue ++							//track the scene's enemy population
			$(local.scene3_spawn1_ai_name1) thread scene3_spawn1_detect_death 	//call a waittill death thread
			$(local.scene3_spawn1_ai_name1) thread scene3_spawn1_ai_navigate1 	//call navigation thread
			$(local.scene3_spawn1_ai_name1).mindist = 128
			$(local.scene3_spawn1_ai_name1).maxdist = 1800
			$(local.scene3_spawn1_ai_name1).leash = 10000
			$(local.scene3_spawn1_ai_name1).fixedleash = 0
			$(local.scene3_spawn1_ai_name1).sight = 4000
			$(local.scene3_spawn1_ai_name1).noticescale = 1
			$(local.scene3_spawn1_ai_name1).hearing = 4000
			$(local.scene3_spawn1_ai_name1).interval = 256
			$(local.scene3_spawn1_ai_name1) gun "MP40"
			$(local.scene3_spawn1_ai_name1) dontdropweapons
			$(local.scene3_spawn1_ai_name1) exec maps/m3l3/coopified.scr::ai_accuracy 20 35 60 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_waffenss_shutze "targetname" (local.scene3_spawn1_ai_name2) "type_attack" "cover"
			$(local.scene3_spawn1_ai_name2).origin = local.org2				//place the guy in the correct spot
			level.scene3_spawn1_currentalive ++							//increment the max allowed alive at any given time
			level.scene3_spawn1_teamvalue ++
			$(local.scene3_spawn1_ai_name2) thread scene3_spawn1_detect_death 	//call a waittill death thread
			$(local.scene3_spawn1_ai_name2) thread scene3_spawn1_ai_navigate2 	//call navigation thread
			$(local.scene3_spawn1_ai_name2) gun "mp40"
			$(local.scene3_spawn1_ai_name2).mindist = 128
			$(local.scene3_spawn1_ai_name2).maxdist = 1800
			$(local.scene3_spawn1_ai_name2).leash = 10000
			$(local.scene3_spawn1_ai_name2).fixedleash = 0
			$(local.scene3_spawn1_ai_name2).sight = 4000
			$(local.scene3_spawn1_ai_name2).noticescale = 1
			$(local.scene3_spawn1_ai_name2).hearing = 4000
			$(local.scene3_spawn1_ai_name2).interval = 256
			$(local.scene3_spawn1_ai_name2).ammo_grenade = 2
			$(local.scene3_spawn1_ai_name2) dontdropweapons
			$(local.scene3_spawn1_ai_name2) exec maps/m3l3/coopified.scr::ai_accuracy 20 35 60 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_waffenss_shutze "targetname" (local.scene3_spawn1_ai_name3) "type_attack" "cover"
			$(local.scene3_spawn1_ai_name3).origin = local.org3				//place the guy in the correct spot
			level.scene3_spawn1_currentalive ++							//increment the max allowed alive at any given time
			level.scene3_spawn1_teamvalue ++
			$(local.scene3_spawn1_ai_name3) thread scene3_spawn1_detect_death 	//call a waittill death thread
			$(local.scene3_spawn1_ai_name3) thread scene3_spawn1_ai_navigate3  	//call navigation thread
			$(local.scene3_spawn1_ai_name3).mindist = 128
			$(local.scene3_spawn1_ai_name3).maxdist = 1800
			$(local.scene3_spawn1_ai_name3).leash = 10000
			$(local.scene3_spawn1_ai_name3).fixedleash = 0
			$(local.scene3_spawn1_ai_name3).sight = 4000
			$(local.scene3_spawn1_ai_name3).noticescale = 1
			$(local.scene3_spawn1_ai_name3).hearing = 4000
			$(local.scene3_spawn1_ai_name3).interval = 256
			$(local.scene3_spawn1_ai_name3).ammo_grenade = 2
			$(local.scene3_spawn1_ai_name3) exec maps/m3l3/coopified.scr::ai_accuracy 20 35 60 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
//			centerprint(level.scene3_spawn1_currentalive + "<" + level.scene3_spawn1_currentalivemax + "\n" + level.scene3_spawn1_deactivator + "=" + level.scene3_spawn1_deactivator+ "\n" + level.scene3_spawn1_teamvalue + "<" + level.scene3_spawn1_teamlimitmax )
		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}

	wait local.loopwaittime				//prevent infinite loop warning
	goto scene3_spawndetector1_control
end

scene3_spawn1_detect_death:
	self waittill death
	self.targetname = ""
	level.scene3_spawn1_currentalive --	//decrement the population count
end

scene3_spawn1_ai_navigate1:
	self exec global/runto.scr $scene3_spawn1_rallypoint1
end

scene3_spawn1_ai_navigate2:
	self exec global/runto.scr $scene3_spawn1_rallypoint2
end

scene3_spawn1_ai_navigate3:
	self exec global/runto.scr $scene3_spawn1_rallypoint3
end

scene3_spawn1_terminate:
	level.scene3_spawn1_deactivator = 1
end

//===============================================================================================================================//

scene3_spawner2_initialize:
	level.scene3_spawn2_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene3_spawn2_teamlimitmax = 15	//initializes constant for total number allowed to spawn (original = 30)
	level.scene3_spawn2_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene3_spawn2_currentalivemax = 3	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene3_spawn2_loopwaittime = 1	//initializes constant for time between respawns
	level.scene3_spawn2_deactivator = 0		//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene3_spawndetector2_control
end

//============================================================//

scene3_spawndetector2_control:
	if (level.scene3_spawn2_deactivator == 1){ end }

	local.loopwaittime = 0.5	//original 0.2 then 2

	//while ($player isTouching $scene3_spawndetector2 || $player isTouching $scene3_spawndetector2a) //chrissstrahl
	while (exec coop_mod/replace.scr::istouching $scene3_spawndetector2 || exec coop_mod/replace.scr::istouching $scene3_spawndetector2a){ //chrissstrahl - make coop compatibe
		//===3 at a time, use +3
		//===Crazy fire and maneuver enemy attack, use nothing

		if ((level.scene3_spawn2_currentalive + level.scene3_spawn2_currentalivemax) <= level.scene3_spawn2_currentalivemax && level.scene3_spawn2_deactivator == 0 && level.scene3_spawn2_teamvalue < level.scene3_spawn2_teamlimitmax)
//		if ((level.scene3_spawn2_currentalive) <= level.scene3_spawn2_currentalivemax && level.scene3_spawn2_deactivator == 0 && level.scene3_spawn2_teamvalue < level.scene3_spawn2_teamlimitmax)
//		if ((level.scene3_spawn2_currentalive + 1) <= level.scene3_spawn2_currentalivemax && level.scene3_spawn2_deactivator == 0 && level.scene3_spawn2_teamvalue < level.scene3_spawn2_teamlimitmax)

		{
//			centerprint(level.scene3_spawn2_currentalive + "<" + level.scene3_spawn2_currentalivemax + "\n" + level.scene3_spawn2_deactivator + "=" + level.scene3_spawn2_deactivator+ "\n" + level.scene3_spawn2_teamvalue + "<" + level.scene3_spawn2_teamlimitmax )

			local.scene3_spawn2_ai_name1 = "scene3_spawn2_ai1_" + level.scene3_spawn2_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene3_spawndetector2_spawner1.origin						//spawn location as a script_origin

			local.scene3_spawn2_ai_name2 = "scene3_spawn2_ai2_" + level.scene3_spawn2_teamvalue
			local.org2 = $scene3_spawndetector2_spawner2.origin

			local.scene3_spawn2_ai_name3 = "scene3_spawn2_ai3_" + level.scene3_spawn2_teamvalue
			local.org3 = $scene3_spawndetector2_spawner3.origin

		//===Spawn 3 enemy soldiers in a wave

			spawn models/human/german_waffenss_nco "targetname" (local.scene3_spawn2_ai_name1) "type_attack" "cover"
			$(local.scene3_spawn2_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene3_spawn2_currentalive ++							//increment the max allowed alive at any given time
			level.scene3_spawn2_teamvalue ++							//track the scene's enemy population
			$(local.scene3_spawn2_ai_name1) thread scene3_spawn2_detect_death 	//call a waittill death thread
			$(local.scene3_spawn2_ai_name1) thread scene3_spawn2_ai_navigate1 	//call navigation thread
			$(local.scene3_spawn2_ai_name1).mindist = 128
			$(local.scene3_spawn2_ai_name1).maxdist = 4000
			$(local.scene3_spawn2_ai_name1).leash = 10000
			$(local.scene3_spawn2_ai_name1).fixedleash = 0
			$(local.scene3_spawn2_ai_name1).sight = 4000
			$(local.scene3_spawn2_ai_name1).noticescale = 50
			$(local.scene3_spawn2_ai_name1).hearing = 4000
			$(local.scene3_spawn2_ai_name1).interval = 256
			$(local.scene3_spawn2_ai_name1) gun "MP40"
			$(local.scene3_spawn2_ai_name1) dontdropweapons
			$(local.scene3_spawn2_ai_name1) exec maps/m3l3/coopified.scr::ai_accuracy 30 45 65 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_waffenss_shutze "targetname" (local.scene3_spawn2_ai_name2) "type_attack" "cover"
			$(local.scene3_spawn2_ai_name2).origin = local.org2				//place the guy in the correct spot
			level.scene3_spawn2_currentalive ++							//increment the max allowed alive at any given time
			level.scene3_spawn2_teamvalue ++
			$(local.scene3_spawn2_ai_name2) thread scene3_spawn2_detect_death 	//call a waittill death thread
			$(local.scene3_spawn2_ai_name2) thread scene3_spawn2_ai_navigate2 	//call navigation thread
			$(local.scene3_spawn2_ai_name2).mindist = 128
			$(local.scene3_spawn2_ai_name2).maxdist = 4000
			$(local.scene3_spawn2_ai_name2).leash = 10000
			$(local.scene3_spawn2_ai_name2).fixedleash = 0
			$(local.scene3_spawn2_ai_name2).sight = 4000
			$(local.scene3_spawn2_ai_name2).noticescale = 20
			$(local.scene3_spawn2_ai_name2).hearing = 4000
			$(local.scene3_spawn2_ai_name2).interval = 256
			$(local.scene3_spawn2_ai_name2).ammo_grenade = 2
			$(local.scene3_spawn2_ai_name2) exec maps/m3l3/coopified.scr::ai_accuracy 30 45 65 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_waffenss_shutze "targetname" (local.scene3_spawn2_ai_name3) "type_attack" "cover"
			$(local.scene3_spawn2_ai_name3).origin = local.org3				//place the guy in the correct spot
			level.scene3_spawn2_currentalive ++							//increment the max allowed alive at any given time
			level.scene3_spawn2_teamvalue ++
			$(local.scene3_spawn2_ai_name3) thread scene3_spawn2_detect_death 	//call a waittill death thread
			$(local.scene3_spawn2_ai_name3) thread scene3_spawn2_ai_navigate3  	//call navigation thread
			$(local.scene3_spawn2_ai_name3).mindist = 128
			$(local.scene3_spawn2_ai_name3).maxdist = 4000
			$(local.scene3_spawn2_ai_name3).leash = 10000
			$(local.scene3_spawn2_ai_name3).fixedleash = 0
			$(local.scene3_spawn2_ai_name3).sight = 4000
			$(local.scene3_spawn2_ai_name3).noticescale = 20
			$(local.scene3_spawn2_ai_name3).hearing = 4000
			$(local.scene3_spawn2_ai_name3).interval = 256
			$(local.scene3_spawn2_ai_name3).ammo_grenade = 2
			$(local.scene3_spawn2_ai_name3) dontdropweapons
			$(local.scene3_spawn2_ai_name3) exec maps/m3l3/coopified.scr::ai_accuracy 30 45 65 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
//			centerprint(level.scene3_spawn2_currentalive + "<" + level.scene3_spawn2_currentalivemax + "\n" + level.scene3_spawn2_deactivator + "=" + level.scene3_spawn2_deactivator+ "\n" + level.scene3_spawn2_teamvalue + "<" + level.scene3_spawn2_teamlimitmax )
		}

		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene3_spawndetector2_control
end

scene3_spawn2_detect_death:
	self waittill death
	self.targetname = ""
	level.scene3_spawn2_currentalive --	//decrement the population count
end

scene3_spawn2_ai_navigate1:
	self exec global/runto.scr $scene3_spawn2_rallypoint1
end

scene3_spawn2_ai_navigate2:
	self exec global/runto.scr $scene3_spawn2_rallypoint2
end

scene3_spawn2_ai_navigate3:
	self exec global/runto.scr $scene3_spawn2_rallypoint3
end

scene3_spawn2_terminate:
println "THIS IS SCENE 3 SPAWNER 2 DEAD DEAD DEAD"
level.scene3_spawn2_deactivator = 1
end

//===============================================================================================================================//

scene3_spawner3_initialize:
	level.scene3_spawn3_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene3_spawn3_teamlimitmax = 15	//initializes constant for total number allowed to spawn (original = 30)
	level.scene3_spawn3_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene3_spawn3_currentalivemax = 3	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene3_spawn3_loopwaittime = 1	//initializes constant for time between respawns
	level.scene3_spawn3_deactivator = 0		//initializes variable for shutting down this loop's ability to spawn when the player is past this area
	
	thread scene3_spawndetector3_control
end

//============================================================//

scene3_spawndetector3_control:

	if (level.scene3_spawn3_deactivator == 1){ end }
	local.loopwaittime = 0.5	//original 0.2

	//while ($player istouching $scene3_spawndetector3 || $player istouching $scene3_spawndetector3a){ //chrissstrahl
	while (exec coop_mod/replace.scr::istouching $scene3_spawndetector3 || exec coop_mod/replace.scr::istouching $scene3_spawndetector3a){ //chrissstrahl - make coop compatible
		//===3 at a time, use +3
		//===Crazy fire and maneuver enemy attack, use nothing

//		if ((level.scene3_spawn3_currentalive + 3) <= level.scene3_spawn3_currentalivemax && level.scene3_spawn3_deactivator == 0 && level.scene3_spawn3_teamvalue < level.scene3_spawn3_teamlimitmax)
//		if ((level.scene3_spawn3_currentalive) <= level.scene3_spawn3_currentalivemax && level.scene3_spawn3_deactivator == 0 && level.scene3_spawn3_teamvalue < level.scene3_spawn3_teamlimitmax)
		if ((level.scene3_spawn3_currentalive + level.scene3_spawn3_currentalivemax) <= level.scene3_spawn3_currentalivemax && level.scene3_spawn3_deactivator == 0 && level.scene3_spawn3_teamvalue < level.scene3_spawn3_teamlimitmax)

		{
//			centerprint(level.scene3_spawn3_currentalive + "<" + level.scene3_spawn3_currentalivemax + "\n" + level.scene3_spawn3_deactivator + "=" + level.scene3_spawn3_deactivator+ "\n" + level.scene3_spawn3_teamvalue + "<" + level.scene3_spawn3_teamlimitmax )

			local.scene3_spawn3_ai_name1 = "scene3_spawn3_ai1_" + level.scene3_spawn3_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene3_spawndetector3_spawner1.origin						//spawn location as a script_origin

			local.scene3_spawn3_ai_name2 = "scene3_spawn3_ai2_" + level.scene3_spawn3_teamvalue
			local.org2 = $scene3_spawndetector3_spawner2.origin

			local.scene3_spawn3_ai_name3 = "scene3_spawn3_ai3_" + level.scene3_spawn3_teamvalue
			local.org3 = $scene3_spawndetector3_spawner3.origin

		//===Spawn 3 enemy soldiers in a wave
			spawn models/human/german_waffenss_shutze "targetname" (local.scene3_spawn3_ai_name1) "type_attack" "cover"
			$(local.scene3_spawn3_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene3_spawn3_currentalive ++							//increment the max allowed alive at any given time
			level.scene3_spawn3_teamvalue ++							//track the scene's enemy population
			$(local.scene3_spawn3_ai_name1) thread scene3_spawn3_detect_death 	//call a waittill death thread
			$(local.scene3_spawn3_ai_name1) thread scene3_spawn3_ai_navigate1 	//call navigation thread
			$(local.scene3_spawn3_ai_name1).mindist = 128
			$(local.scene3_spawn3_ai_name1).maxdist = 4000
			$(local.scene3_spawn3_ai_name1).leash = 10000
			$(local.scene3_spawn3_ai_name1).fixedleash = 0
			$(local.scene3_spawn3_ai_name1).sight = 3476		//original 4000, farplane adjusted value
			$(local.scene3_spawn3_ai_name1).noticescale = 50
			$(local.scene3_spawn3_ai_name1).hearing = 4000
			$(local.scene3_spawn3_ai_name1).interval = 256
			$(local.scene3_spawn3_ai_name1).ammo_grenade = 2
			$(local.scene3_spawn3_ai_name1) exec maps/m3l3/coopified.scr::ai_accuracy 30 45 65 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_waffenss_shutze "targetname" (local.scene3_spawn3_ai_name2) "type_attack" "cover"
			$(local.scene3_spawn3_ai_name2).origin = local.org2				//place the guy in the correct spot
			level.scene3_spawn3_currentalive ++							//increment the max allowed alive at any given time
			level.scene3_spawn3_teamvalue ++
			$(local.scene3_spawn3_ai_name2) thread scene3_spawn3_detect_death 	//call a waittill death thread
			$(local.scene3_spawn3_ai_name2) thread scene3_spawn3_ai_navigate2 	//call navigation thread
			$(local.scene3_spawn3_ai_name2) gun "mp40"
			$(local.scene3_spawn3_ai_name2).mindist = 128
			$(local.scene3_spawn3_ai_name2).maxdist = 4000
			$(local.scene3_spawn3_ai_name2).leash = 10000
			$(local.scene3_spawn3_ai_name2).fixedleash = 0
			$(local.scene3_spawn3_ai_name2).sight = 4000
			$(local.scene3_spawn3_ai_name2).noticescale = 1
			$(local.scene3_spawn3_ai_name2).hearing = 3476		//original 4000, farplane adjusted value
			$(local.scene3_spawn3_ai_name2).interval = 256
			$(local.scene3_spawn3_ai_name2).ammo_grenade = 2
			$(local.scene3_spawn3_ai_name2) dontdropweapons				
			$(local.scene3_spawn3_ai_name2) exec maps/m3l3/coopified.scr::ai_accuracy 30 40 60 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill			

			spawn models/human/german_waffenss_shutze "targetname" (local.scene3_spawn3_ai_name3) "type_attack" "cover"
			$(local.scene3_spawn3_ai_name3).origin = local.org3				//place the guy in the correct spot
			level.scene3_spawn3_currentalive ++							//increment the max allowed alive at any given time
			level.scene3_spawn3_teamvalue ++
			$(local.scene3_spawn3_ai_name3) thread scene3_spawn3_detect_death 	//call a waittill death thread
			$(local.scene3_spawn3_ai_name3) thread scene3_spawn3_ai_navigate3  	//call navigation thread
			$(local.scene3_spawn3_ai_name3).mindist = 128
			$(local.scene3_spawn3_ai_name3).maxdist = 4000
			$(local.scene3_spawn3_ai_name3).leash = 10000
			$(local.scene3_spawn3_ai_name3).fixedleash = 0
			$(local.scene3_spawn3_ai_name3).sight = 3476		//original 4000, farplane adjusted value
			$(local.scene3_spawn3_ai_name3).noticescale = 1
			$(local.scene3_spawn3_ai_name3).hearing = 4000
			$(local.scene3_spawn3_ai_name3).interval = 256
			$(local.scene3_spawn3_ai_name3).ammo_grenade = 2
			$(local.scene3_spawn3_ai_name3) dontdropweapons
			$(local.scene3_spawn3_ai_name3) exec maps/m3l3/coopified.scr::ai_accuracy 30 45 65 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

//			centerprint(level.scene3_spawn3_currentalive + "<" + level.scene3_spawn3_currentalivemax + "\n" + level.scene3_spawn3_deactivator + "=" + level.scene3_spawn3_deactivator+ "\n" + level.scene3_spawn3_teamvalue + "<" + level.scene3_spawn3_teamlimitmax )
		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene3_spawndetector3_control
end

//============================================================//

scene3_spawn3_detect_death:
	self waittill death
	self.targetname = ""
	level.scene3_spawn3_currentalive --	//decrement the population count
end

//============================================================//

scene3_spawn3_ai_navigate1:
	self exec global/runto.scr $scene3_spawn3_rallypoint1
end

//============================================================//

scene3_spawn3_ai_navigate2:
	self exec global/runto.scr $scene3_spawn3_rallypoint2
end

//============================================================//

scene3_spawn3_ai_navigate3:
	self exec global/runto.scr $scene3_spawn3_rallypoint3
end

//============================================================//

scene3_spawn3_terminate:
	println "THIS IS SPAWNER 3 DEAD DEAD DEAD"
	level.scene3_spawn3_deactivator = 1
end

//===============================================================================================================================//

scene3_spawner4_initialize:
	level.scene3_spawn4_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene3_spawn4_teamlimitmax = 6	//initializes constant for total number allowed to spawn (original value is 30)
	level.scene3_spawn4_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene3_spawn4_currentalivemax = 2	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene3_spawn4_loopwaittime = 1	//initializes constant for time between respawns
	level.scene3_spawn4_deactivator = 0		//initializes variable for shutting down this loop's ability to spawn when the player is past this area
	level.scene3_spawn4_hintdone = 0		//initializes variable for giving the player a verbal hint to get to a good high sniper position

	thread scene3_spawndetector4_control
end

//============================================================//

scene3_spawner4_captain_point:

	if (level.scene3_spawn4_hintdone == 0){
		level.scene3_spawn4_hintdone = 1

		if !(isAlive level.ramsey){ end }

		level.ramsey exec global/disable_ai.scr
		level.ramsey exec global/crouch.scr
		level.ramsey lookAt $scene3_captain_point_target
		level.ramsey turnto $scene3_captain_point_target
		level.ramsey pointat $scene3_captain_point_target
		//level.ramsey say dfr_directive_195j_2			//"Move up there!" //[200] Smithy
		level.ramsey thread coop_mod/replace.scr::say_wait "dfr_directive_195j_2" //[200] Smithy - coop compatible
		level.ramsey waittill saydone
		wait 2

		if !(isAlive level.ramsey){ end }

		level.ramsey pointat NULL
		level.ramsey turnto NULL
		level.ramsey lookAt NULL
		level.ramsey exec global/enable_ai.scr
	}
end

//============================================================//

scene3_spawndetector4_control:

	if (level.scene3_spawn4_deactivator == 1){	end }

	local.loopwaittime = 0.2

	//while ($player isTouching $scene3_spawndetector4 || $player isTouching $scene3_spawndetector4a || $player isTouching $scene3_spawndetector4b)//chrissstrahl
	while (	exec coop_mod/replace.scr::istouching $scene3_spawndetector4 || 
			exec coop_mod/replace.scr::istouching $scene3_spawndetector4a ||
			exec coop_mod/replace.scr::istouching $scene3_spawndetector4b){ //chrissstrahl - make coop compatible
		//===3 at a time, use +3
		//===Crazy fire and maneuver enemy attack, use nothing

//		if ((level.scene3_spawn4_currentalive + level.scene3_spawn4_currentalivemax) <= level.scene3_spawn4_currentalivemax && level.scene3_spawn4_deactivator == 0 && level.scene3_spawn4_teamvalue < level.scene3_spawn4_teamlimitmax)
//		if ((level.scene3_spawn4_currentalive) <= level.scene3_spawn4_currentalivemax && level.scene3_spawn4_deactivator == 0 && level.scene3_spawn4_teamvalue < level.scene3_spawn4_teamlimitmax)
		if ((level.scene3_spawn4_currentalive + 1) <= level.scene3_spawn4_currentalivemax && level.scene3_spawn4_deactivator == 0 && level.scene3_spawn4_teamvalue < level.scene3_spawn4_teamlimitmax)

		{
			thread scene3_spawner4_captain_point

//			centerprint(level.scene3_spawn4_currentalive + "<" + level.scene3_spawn4_currentalivemax + "\n" + level.scene3_spawn4_deactivator + "=" + level.scene3_spawn4_deactivator+ "\n" + level.scene3_spawn4_teamvalue + "<" + level.scene3_spawn4_teamlimitmax )

			local.scene3_spawn4_ai_name1 = "scene3_spawn4_ai1_" + level.scene3_spawn4_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene3_spawndetector4_spawner1.origin						//spawn location as a script_origin

			local.scene3_spawn4_ai_name2 = "scene3_spawn4_ai2_" + level.scene3_spawn4_teamvalue
			local.org2 = $scene3_spawndetector4_spawner2.origin

			local.scene3_spawn4_ai_name3 = "scene3_spawn4_ai3_" + level.scene3_spawn4_teamvalue
			local.org3 = $scene3_spawndetector4_spawner3.origin

		//===Spawn 3 enemy soldiers in a wave
			spawn models/human/german_waffenss_nco "targetname" (local.scene3_spawn4_ai_name1) "type_attack" "cover"
			$(local.scene3_spawn4_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene3_spawn4_currentalive ++							//increment the max allowed alive at any given time
			level.scene3_spawn4_teamvalue ++							//track the scene's enemy population
			$(local.scene3_spawn4_ai_name1) thread scene3_spawn4_detect_death 	//call a waittill death thread
			$(local.scene3_spawn4_ai_name1) thread scene3_spawn4_ai_navigate1 	//call navigation thread
			$(local.scene3_spawn4_ai_name1).mindist = 128
			$(local.scene3_spawn4_ai_name1).maxdist = 4000
			$(local.scene3_spawn4_ai_name1).leash = 10000
			$(local.scene3_spawn4_ai_name1).fixedleash = 0
			$(local.scene3_spawn4_ai_name1).sight = 4000
			$(local.scene3_spawn4_ai_name1).noticescale = 50
			$(local.scene3_spawn4_ai_name1).hearing = 4000
			$(local.scene3_spawn4_ai_name1).interval = 256
			$(local.scene3_spawn4_ai_name1) gun "MP40"
			$(local.scene3_spawn4_ai_name1) dontdropweapons
			$(local.scene3_spawn4_ai_name1) exec maps/m3l3/coopified.scr::ai_accuracy 30 45 60 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_waffenss_shutze "targetname" (local.scene3_spawn4_ai_name2) "type_attack" "cover"
			$(local.scene3_spawn4_ai_name2).origin = local.org2				//place the guy in the correct spot
			level.scene3_spawn4_currentalive ++							//increment the max allowed alive at any given time
			level.scene3_spawn4_teamvalue ++
			$(local.scene3_spawn4_ai_name2) thread scene3_spawn4_detect_death 	//call a waittill death thread
			$(local.scene3_spawn4_ai_name2) thread scene3_spawn4_ai_navigate2 	//call navigation thread
			$(local.scene3_spawn4_ai_name2).mindist = 128
			$(local.scene3_spawn4_ai_name2).maxdist = 4000
			$(local.scene3_spawn4_ai_name2).leash = 10000
			$(local.scene3_spawn4_ai_name2).fixedleash = 0
			$(local.scene3_spawn4_ai_name2).sight = 2000
			$(local.scene3_spawn4_ai_name2).noticescale = 1
			$(local.scene3_spawn4_ai_name2).hearing = 4000
			$(local.scene3_spawn4_ai_name2).interval = 256
			$(local.scene3_spawn4_ai_name2)  exec maps/m3l3/coopified.scr::ai_accuracy 30 40 65 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_waffenss_shutze "targetname" (local.scene3_spawn4_ai_name3) "type_attack" "cover"
			$(local.scene3_spawn4_ai_name3).origin = local.org3				//place the guy in the correct spot
			level.scene3_spawn4_currentalive ++							//increment the max allowed alive at any given time
			level.scene3_spawn4_teamvalue ++
			$(local.scene3_spawn4_ai_name3) thread scene3_spawn4_detect_death 	//call a waittill death thread
			$(local.scene3_spawn4_ai_name3) thread scene3_spawn4_ai_navigate3  	//call navigation thread
			$(local.scene3_spawn4_ai_name3) exec maps/m3l3/coopified.scr::ai_accuracy 30 40 65 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
			$(local.scene3_spawn4_ai_name3).mindist = 128
			$(local.scene3_spawn4_ai_name3).maxdist = 4000
			$(local.scene3_spawn4_ai_name3).leash = 10000
			$(local.scene3_spawn4_ai_name3).fixedleash = 0
			$(local.scene3_spawn4_ai_name3).sight = 4000
			$(local.scene3_spawn4_ai_name3).noticescale = 1
			$(local.scene3_spawn4_ai_name3).hearing = 4000
			$(local.scene3_spawn4_ai_name3).interval = 256
			$(local.scene3_spawn4_ai_name3) dontdropweapons		
		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene3_spawndetector4_control
end

scene3_spawn4_detect_death:
	self waittill death
	self.targetname = ""
	level.scene3_spawn4_currentalive --	//decrement the population count
end

scene3_spawn4_ai_navigate1:
	self exec global/runto.scr $scene3_spawn4_rallypoint1
end

scene3_spawn4_ai_navigate2:
	self exec global/runto.scr $scene3_spawn4_rallypoint2
end

scene3_spawn4_ai_navigate3:
	self exec global/runto.scr $scene3_spawn4_rallypoint3
end

scene3_spawn4_terminate:
	println "THIS IS SPAWNER 4 DEAD DEAD DEAD"
	level.scene3_spawn4_deactivator = 1
end

scene3_spawner5_initialize:
	level.scene3_spawn5_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene3_spawn5_teamlimitmax = 6	//initializes constant for total number allowed to spawn (original = 30)
	level.scene3_spawn5_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene3_spawn5_currentalivemax = 2	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene3_spawn5_loopwaittime = 1	//initializes constant for time between respawns
	level.scene3_spawn5_deactivator = 0		//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene3_spawndetector5_control
end

//============================================================//

scene3_spawndetector5_control:

	if (level.scene3_spawn5_deactivator == 1){ end }

	local.loopwaittime = 0.5	//original 0.2

	//while ($player isTouching $scene3_spawndetector5)//chrissstrahl
	while (exec coop_mod/replace.scr::istouching $scene3_spawndetector5){ //chrissstrahl - make coop compatible
		//===3 at a time, use +3
		//===Crazy fire and maneuver enemy attack, use nothing

//		if ((level.scene3_spawn5_currentalive + 3) <= level.scene3_spawn5_currentalivemax && level.scene3_spawn5_deactivator == 0 && level.scene3_spawn5_teamvalue < level.scene3_spawn5_teamlimitmax)
//		if ((level.scene3_spawn5_currentalive) <= level.scene3_spawn5_currentalivemax && level.scene3_spawn5_deactivator == 0 && level.scene3_spawn5_teamvalue < level.scene3_spawn5_teamlimitmax)
		if ((level.scene3_spawn5_currentalive + level.scene3_spawn5_currentalivemax) <= level.scene3_spawn5_currentalivemax && level.scene3_spawn5_deactivator == 0 && level.scene3_spawn5_teamvalue < level.scene3_spawn5_teamlimitmax)

		{
//			centerprint(level.scene3_spawn5_currentalive + "<" + level.scene3_spawn5_currentalivemax + "\n" + level.scene3_spawn5_deactivator + "=" + level.scene3_spawn5_deactivator+ "\n" + level.scene3_spawn5_teamvalue + "<" + level.scene3_spawn5_teamlimitmax )

			local.scene3_spawn5_ai_name1 = "scene3_spawn5_ai1_" + level.scene3_spawn5_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene3_spawndetector5_spawner1.origin						//spawn location as a script_origin

			local.scene3_spawn5_ai_name2 = "scene3_spawn5_ai2_" + level.scene3_spawn5_teamvalue
			local.org2 = $scene3_spawndetector5_spawner2.origin

		//===Spawn 2 enemy soldiers in a wave

			spawn models/human/german_waffenss_shutze "targetname" (local.scene3_spawn5_ai_name1) "type_attack" "cover"

			$(local.scene3_spawn5_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene3_spawn5_currentalive ++							//increment the max allowed alive at any given time
			level.scene3_spawn5_teamvalue ++							//track the scene's enemy population
			$(local.scene3_spawn5_ai_name1) thread scene3_spawn5_detect_death 	//call a waittill death thread
			$(local.scene3_spawn5_ai_name1) thread scene3_spawn5_ai_navigate1 	//call navigation thread
			$(local.scene3_spawn5_ai_name1).hearing = 4000
			$(local.scene3_spawn5_ai_name1).interval = 256
			$(local.scene3_spawn5_ai_name1).ammo_grenade = 2
			$(local.scene3_spawn5_ai_name1).mindist = 128
			$(local.scene3_spawn5_ai_name1).maxdist = 4000
			$(local.scene3_spawn5_ai_name1).leash = 10000
			$(local.scene3_spawn5_ai_name1).fixedleash = 0
			$(local.scene3_spawn5_ai_name1).sight = 4000
			$(local.scene3_spawn5_ai_name1).noticescale = 50			
			$(local.scene3_spawn5_ai_name1) exec maps/m3l3/coopified.scr::ai_accuracy 30 45 60 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill


			spawn models/human/german_waffenss_shutze "targetname" (local.scene3_spawn5_ai_name2) "type_attack" "cover"
			$(local.scene3_spawn5_ai_name2).origin = local.org2				//place the guy in the correct spot
			level.scene3_spawn5_currentalive ++							//increment the max allowed alive at any given time
			level.scene3_spawn5_teamvalue ++
			$(local.scene3_spawn5_ai_name2) thread scene3_spawn5_detect_death 	//call a waittill death thread
			$(local.scene3_spawn5_ai_name2) thread scene3_spawn5_ai_navigate2 	//call navigation thread
			$(local.scene3_spawn5_ai_name2) gun "mp40"
			$(local.scene3_spawn5_ai_name2).mindist = 128
			$(local.scene3_spawn5_ai_name2).maxdist = 4000
			$(local.scene3_spawn5_ai_name2).leash = 10000
			$(local.scene3_spawn5_ai_name2).fixedleash = 0
			$(local.scene3_spawn5_ai_name2).sight = 4000
			$(local.scene3_spawn5_ai_name2).noticescale = 1
			$(local.scene3_spawn5_ai_name2) exec maps/m3l3/coopified.scr::ai_accuracy 30 40 60 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
			$(local.scene3_spawn5_ai_name2).hearing = 4000
			$(local.scene3_spawn5_ai_name2).interval = 256
			$(local.scene3_spawn5_ai_name2).ammo_grenade = 2
			$(local.scene3_spawn5_ai_name2) dontdropweapons	
		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene3_spawndetector5_control
end

scene3_spawn5_detect_death:
	self waittill death
	self.targetname = ""
	level.scene3_spawn5_currentalive --	//decrement the population count
end

scene3_spawn5_ai_navigate1:
	self exec global/runto.scr $scene3_spawn5_rallypoint1
end

scene3_spawn5_ai_navigate2:
	self exec global/runto.scr $scene3_spawn5_rallypoint2
end

scene3_spawn5_terminate:
	println "THIS IS SPAWNER 5 DEAD DEAD DEAD"
	level.scene3_spawn5_deactivator = 1
end

scene3_sniperboardspawn:
	local.scene3_boardsniper1 = "scene3_boardsniper1"
	local.scene3_boardsniper2 = "scene3_boardsniper2"

	spawn models/human/german_waffenss_nco "targetname" (local.scene3_boardsniper1) "type_attack" "turret"
	spawn models/human/german_waffenss_shutze "targetname" (local.scene3_boardsniper2) "type_attack" "turret"
	
	//chrissstrahl - make this compact
	waitframe
	for(local.i=1;local.i<=2;local.i++){ //chrissstrahl - setup 1 and 2
		$("scene3_boardsniper"+local.i).noticescale = 5
		$("scene3_boardsniper"+local.i).maxdist = 5000
		$("scene3_boardsniper"+local.i).sight = 5000
		$("scene3_boardsniper"+local.i) gun "MP40"
		$("scene3_boardsniper"+local.i).origin = $("scene3_sniperboardnode"+local.i+"_spawn").origin
		$("scene3_boardsniper"+local.i) exec global/disable_ai.scr
		$("scene3_boardsniper"+local.i) exec global/runto.scr $scene3_sniperboardnode1
		$("scene3_boardsniper"+local.i) waittill movedone
		$("scene3_boardsniper"+local.i) exec global/enable_ai.scr		
	}
end

//==============================================================================================================================================//
//																								//
//										SCENE 4 SUPPORT THREADS											//
//																								//
//==============================================================================================================================================//

scene4_teammate_cover:
	//===Called from thread scene4
	//===All squadmates except Captain Ramsey take up defensive positions to appear as though they are covering the rear
	//===Captain Ramsey will go to scene4_tankcovernode1 after giving the player the hint about the tank

	//scene4_tankcovernode1 (Captain Ramsey's node)
	//scene4_tankcovernode2 (Tomlin's node)
	//scene4_tankcovernode3	(Harrison's node)
	//scene4_captain_hintnode (get Captain to within 70 units of this node)

	//scene4_captain_aimpoint (Captain aims at this to look smart and prepared)
	//scene4_tomlin_aimpoint (Tomlin aims at this to look smart and prepared)
	//scene4_harrison_aimpoint (Harrison aims at this to look smart and prepared)

	if (isAlive level.tomlin){
		level.tomlin.friendtype = -1
		level.tomlin exec global/disable_ai.scr
		level.tomlin runto $scene4_tankcovernode2
		level.tomlin waittill movedone	

		if !(isAlive level.tomlin){ end }
	
		level.tomlin turnto $scene4_tomlin_aimpoint
		level.tomlin exec global/crouch.scr

		level.tomlin tether $scene4_tankcovernode2
		level.tomlin leash 256

		level.tomlin exec global/enable_ai.scr
	}

	if (isAlive level.harrison){
		level.harrison.friendtype = -1
		level.harrison exec global/disable_ai.scr
		level.harrison runto $scene4_tankcovernode3
		level.harrison waittill movedone

		if !(isAlive level.harrison){ end }
	
		level.harrison turnto $scene4_harrison_aimpoint
		level.harrison exec global/crouch.scr

		level.harrison tether $scene4_tankcovernode3
		level.harrison leash 256

		level.harrison exec global/enable_ai.scr
	}
end

//============================================================//

scene4_team_regroup:
	//===Called from a trigger_once in the bsp halfway between the tank and the destructible building
	//===Reset the squadmates and rejoin the player 
//	thread squad_reset	//in the Utilities section at the bottom of this script file
end

//============================================================//

scene4_mgfodder:
	//===Called from thread scene4
	$scene4_mgfodderspawn_trigger waittill trigger	
	thread scene4_mgfodderspawn
end

//bazooka switch trade 
//=========================================================================
scene4_panzerschreck_trigger:{
//=========================================================================
	//===Vanish the panzerschreck and rocket scriptmodels when the player gets close
	if(level.gametype == 0){ //chrissstrahl - we only want this to happen in sp
		$scene4_panzerschreck remove
		//===Add a panzerschreck and some rockets to the player's inventory and play the pickup sounds
		$player playsound panzerschreck_snd_pickup
		$player item weapons/panzerschreck.tik
		$player ammo heavy 1	
		end
	}
}end

//============================================================//

scene4_captain_hint:
	if !(isAlive level.ramsey){ end }
	//===Called from thread scene4_tank_sequence
//===Make Captain Ramsey run to within a certain distance (local.hintnode_range) of a special location and give the player a verbal hint
	local.hintnode_range = 140
	level.ramsey.friendtype = -1
	level.ramsey exec global/disable_ai.scr
	level.ramsey runto $scene4_captain_hintnode
//		level.ramsey waittill movedone
	wait 2

	if !(isAlive level.ramsey){ end }

	level.ramsey turnto $scene4_tank
	level.ramsey lookAt $scene4_tank
	wait 0.8

	if !(isAlive level.ramsey){ end }

	level.ramsey say dfr_M3L3_add01	//"Tiger Tank to the south! Take cover!!"
	level.ramsey waittill saydone

	if !(isAlive level.ramsey){ end }
	wait 1

	if !(isAlive level.ramsey){ end }

	level.ramsey exec coop_mod/replace.scr::lookat //chrissstrahl - look at me when I am talking to you, bitch!

	level.ramsey say dfr_M3L3_add02	//"Powell, try to get its attention!"
	level.ramsey waittill saydone

	if !(isAlive level.ramsey){ end }
	wait 1

	if !(isAlive level.ramsey){ end }

	level.ramsey say dfr_M3L3_add03	//"We need to trick that tank into clearing our path!"
	level.ramsey lookat $scene4_tank
	level.ramsey waittill saydone

	if !(isAlive level.ramsey){ end }

	level.ramsey turnto NULL	
	level.ramsey lookAt NULL
	level.ramsey runto $scene4_tankcovernode1
	level.ramsey waittill movedone

	if !(isAlive level.ramsey){ end }

	level.ramsey turnto $scene4_tomlin_aimpoint
	level.ramsey exec global/crouch.scr

	level.ramsey tether $scene4_tankcovernode1
	level.ramsey leash 256

	level.ramsey exec global/enable_ai.scr
end


scene4_tank_sequence:
	//===Triggered from bsp
	//===Make the captain give the player a hint as to what is going to happen next
		thread scene4_captain_hint

		$scene4_tank waitthread scene4_tank_initialize 		//setup tank properties
		$scene4_tank thread scene4_tank_feedback				//monitor for amount of damage sustained and generate feedback effects

		$scene4_tank waitthread scene4_tank_move $scene4_tank_path	//setup tank movement parameters and make tank move

		$scene4_tank thread scene4_tank_targeting				//targeting systems
		$scene4_tank thread scene4_tank_death					//monitor for death
end


scene4_tank_initialize:
	//===Setup the tank properties
	local.gun = self QueryTurretSlotEntity 0			//local.gun is the tank turret itself
	local.gun2 = self QueryTurretSlotEntity 1			//local.gun2 is the machine gun if it ever worked
	self.health = 1000									//health - damage per player's panzerschreck shell is 200
	self removeondeath 0 								//prevent it from vanishing when destroyed
	self lock											//prevent it from being usable by the player
	local.gun TurnSpeed 7								//set the turret traversing speed original value 4

	self immune bullet
	self immune fast_bullet
	self immune grenade
	self immune bash

	//===Initialize wall exploded sections to track if they've been used already or not
	level.scene4_targetpoint1 = 0
	level.scene4_targetpoint2 = 0
	level.scene4_targetpoint3 = 0
	level.scene4_targetpoint4 = 0
end


scene4_tank_feedback:
	local.originalhealth = self.health
	local.previoushealth = self.health	//initialize	

	while (isAlive $scene4_tank){
		waitframe

		if !(isAlive $scene4_tank)
			end

		if (self.health < local.previoushealth){
			local.tankfraction = (self.health / local.originalhealth) * 100
			local.tankfractioninteger = int local.tankfraction
			iprintlnbold_noloc (loc_convert_string "TIGER TANK: ") local.tankfractioninteger (loc_convert_string " percent")//(loc_convert_string "\%")
			local.previoushealth = self.health
		}		
	}
end


scene4_tank_death:
	self waittill death

	iprintlnbold "Tiger Tank destroyed."
	local.gun = self QueryTurretSlotEntity 0		//local.gun is the tank turret itself
	local.gun2 = self QueryTurretSlotEntity 1		//local.gun2 is the machine gun if it ever worked
	self show
	self playsound explode_tank
	self stop
	local.gun stopfiring

	//===If a main gun and/or mounted machine gun exists on the tank, remove it
		if (local.gun){
			self DetachTurretSlot 0
			local.gun remove
		}

		if (local.gun2){
			self DetachTurretSlot 1
			local.gun2 remove
		}

	//===Activate the explosion visual effect
		local.temp = spawn script_model
		local.temp.origin = self.origin
		local.temp model "fx/fx_tank_explosion.tik"
		local.temp anim start

	//===Shake the player's view hard
		exec global/earthquake.scr .23 4 0 0

	//===Issue some damage in a radius around the destroyed vehicle
		radiusdamage self.origin 200 200

		//Kill the player if there's a chance they might be stuck in the barrel...don't be close when the tank explodes. Constant damage across radius.
		radiusdamage ( ($scene4_tank_radiusdamage_source.origin) + (0 0 16) ) 2000 325 1 

	//===Get Ramsey and company back to the player
		thread squad_reset

	//===Turn on the tank barrel collision 
//		$scene4_tank_barrel_collision solid

	//===Replace the model with the destroyed version and give it a collision mask
		local.brushmodel = self.target.brushmodel
		local.collision = spawn script_object model local.brushmodel
		local.collision.angles = self.angles
		local.collision.origin = self.origin
		local.collision disconnect_paths

		local.damaged = spawn script_model model models/vehicles/tigertank_d.tik
//		local.damaged.targetname = self.targetname	
		local.damaged.origin = self.origin
		local.damaged.angles = self.angles
		self remove

	//===Initialize the 'guys getting out of the tank' animation
		local.anims[0] = tank_exit_1
		local.anims[1] = tank_exit_2
		local.anims[2] = tank_exit_3
		local.anims[3] = tank_exit_4
		local.damaged thread global/vehicles_thinkers.scr::tank_guys_get_out local.anim
		
		//chrissstrahl - if tank was destroyed to fast, blow the wall
		if(	level.scene4_targetpoint1 == 0 &&
			level.scene4_targetpoint2 == 0 &&
			level.scene4_targetpoint3 == 0)
		{
			thread global/exploder.scr::explode 1
			exec global/earthquake.scr .23 4 0 0		
		}
end

//============================================================//

//====================================================//
//									//
//			TANK MOVING CONTROL			//
//									//
//====================================================//

scene4_tank_hint:
	if (int(level.skill) < 2){ //chrissstrahl - do this right
		iprintlnbold "HINT: Switch to your Panzerschreck (rocket launcher) to destroy the tank."
		wait 2
	}
end

//============================================================//

scene4_tank_move local.path:
	level.enemytankspeed = 5.25	//original value 4
	level.lookahead = 64		//original value 64
	println "TANK SPEED SET"
	self waitthread scene4_drive_path local.path level.enemytankspeed
end

//============================================================//

scene4_drive_path local.path local.speed:

	// drive Vector position, speed, acceleration, reach_distance, look_ahead
	println "z:              " local.path
	println "z:              " local.speed

	println "DRIVING"

	self drive local.path local.speed 1 200 level.lookahead	//local.path is start of a chain of **INFO_WAYPOINTS**

	//self modifydrive level.fastspeed 50 level.lookahead

	thread scene4_tank_hint

	self waitTill drive
	self stop

end

//====================================================//
//									//
//			TANK FIRE CONTROL				//
//									//
//====================================================//

scene4_tank_targeting:
	//self is $scene4_tank
	while (isAlive self){
	
		for (local.i = 1;local.i <= 5;local.i++){ //chrissstrahl - coop - make compact
			if (exec coop_mod/replace.scr::istouching $scene4_tankshot1_trigger){ //chrissstrahl - coop
//println "TOUCHING TRIGGER 1 - Targetpoint"
				self waitthread ("scene4_tank_attack"+local.i)

				if !(isAlive self){ end }
			}
		}

		if (exec coop_mod/replace.scr::istouching $scene4_tankshot5a_trigger){ //chrissstrahl - coop
//println "TOUCHING TRIGGER 5a - Player"
			self waitthread scene4_tank_attack5

			if !(isAlive self){ end }
		}

		if (exec coop_mod/replace.scr::istouching $scene4_tankshot5b_trigger){ //chrissstrahl - coop
//println "TOUCHING TRIGGER 5b - Player"
			self waitthread scene4_tank_attack5

			if !(isAlive self){ end }
		}

		for (local.i = 6;local.i <= 9;local.i++){ //chrissstrahl - coop - make compact
			if ( (exec coop_mod/replace.scr::istouching $("scene4_tankshot"+local.i+"_trigger")) ){ //chrissstrahl - coop
//println ("TOUCHING TRIGGER "+local.i+" - Player")
				self waitthread scene4_tank_attack5

				if !(isAlive self){ end }
			}
		}

		//===Tank Line of Sight Triggers (player is too close and out of sight, so tank just traverses the turret)		
		for (local.i = 1;local.i <= 4;local.i++){ //chrissstrahl - coop - make compact
			if (exec coop_mod/replace.scr::istouching $("scene4_tanklos"+local.i+"_trigger")){
				local.gun = self QueryTurretSlotEntity 0
				local.gun setaimtarget $scene4_tanklos1_target
//println ("TOUCHING LOS "+local.i)
			}
		}

		if (exec coop_mod/replace.scr::istouching $scene4_tanklos5_trigger){
			local.gun = self QueryTurretSlotEntity 0
			local.player = exec coop_mod/replace.scr::player_closestTo local.gun //chrissstrahl - coop get cloeset player
			local.gun setaimtarget local.player
//println "TOUCHING LOS 5"
		}
		waitframe
	}
end

//============================================================//

//===CAN BE CALLED AS REQUIRED AS LONG AS TANK IS ALIVE

scene4_tank_attack1:
	//===Fire the gun at a target script_origin if tank is alive
	if (isAlive self){
		local.gun = self QueryTurretSlotEntity 0						//local.gun is the tank turret itself
		local.gun waitthread scene4_tank_shoot_target $scene4_tank_targetpoint1 	//targetpoint1 is the script_origin target
	}
end

//============================================================//

//===CAN BE CALLED AS REQUIRED AS LONG AS TANK IS ALIVE
scene4_tank_attack2:
	//===Fire the gun at a target script_origin if tank is alive
	if (isAlive self){
		local.gun = self QueryTurretSlotEntity 0							//local.gun is the tank turret itself
		local.gun waitthread scene4_tank_shoot_target $scene4_tank_targetpoint2 	//targetpoint1 is the script_origin target
	}

end

//============================================================//

//===CAN BE CALLED AS REQUIRED AS LONG AS TANK IS ALIVE

scene4_tank_attack3:
	//===Fire the gun at a target script_origin if tank is alive
	if (isAlive self){
		local.gun = self QueryTurretSlotEntity 0							//local.gun is the tank turret itself
		local.gun waitthread scene4_tank_shoot_target $scene4_tank_targetpoint3 	//targetpoint1 is the script_origin target
	}
end

//============================================================//

scene4_tank_attack4:
	if (isAlive self){
		local.gun = self QueryTurretSlotEntity 0
		local.gun waitthread scene4_tank_shoot_target $scene4_tank_targetpoint4
	}
end

//============================================================//

scene4_tank_attack5:
	if (isAlive self){
		local.gun = self QueryTurretSlotEntity 0

		//===Slight variation...shoot at player, not at a target location
		local.gun waitthread scene4_tank_shoot_player
	}
end

//============================================================//

scene4_tank_shoot_target local.targetpoint:

	self setaimtarget local.targetpoint
	self waittill ontarget

	if(level.gametype == 0){ //chrissstrahl - sp
		if (level.skill == "0"){
			wait 4
		}else if (level.skill == "1"){
			wait 3
		}else if (level.skill == "2"){
			wait 1.5
		}
	}else{ //chrissstrahl - coop
		wait 0.5
	}

	if !(isAlive $scene4_tank)
		end

	if (local.targetpoint == $scene4_tank_targetpoint1){
		if (level.scene4_targetpoint1 == 0){
			thread global/exploder.scr::explode 1
			//===Shake the player's view hard
			exec global/earthquake.scr .23 4 0 0
		}
		level.scene4_targetpoint1 = 1
	}

	if (local.targetpoint == $scene4_tank_targetpoint2){
		if (level.scene4_targetpoint2 == 0){
			thread global/exploder.scr::explode 2

			//===Shake the player's view hard
			exec global/earthquake.scr .23 4 0 0
		}
		level.scene4_targetpoint2 = 1
	}

	if (local.targetpoint == $scene4_tank_targetpoint3){
		if (level.scene4_targetpoint3 == 0){
			thread global/exploder.scr::explode 3

			//===Shake the player's view hard
			exec global/earthquake.scr .23 4 0 0
		}
		level.scene4_targetpoint3 = 1
	}

	if (local.targetpoint == $scene4_tank_targetpoint4){
		if (level.scene4_targetpoint4 == 0){
			thread global/exploder.scr::explode 4

			//===Shake the player's view hard
			exec global/earthquake.scr .23 4 0 0
		}
		level.scene4_targetpoint4 = 1
	}

	if !(isAlive $scene4_tank)
		end

	self startFiring
	wait 1
	
	if !(isAlive $scene4_tank)
		end

	self stopfiring
end

//=========================================================================
scene4_tank_shoot_player:{
//=========================================================================
	local.player = exec coop_mod/replace.scr::player_closestTo self //chrissstrahl - coop
	self setaimtarget local.player

	//println "TRACKING PLAYER" //[200] chrissstrahl - stop console spam

	self waittill ontarget

	if !(sighttrace (local.player.origin + (0 0 320)) self.origin 1){
		//println "DENIED BY NO LINE OF SIGHT" //[200] chrissstrahl - stop console spam
		end
	}else if (sighttrace (local.player.origin + (0 0 320)) self.origin 1){
		if(level.gametype == 0){ //chrissstrahl - do in sp
			if (level.skill == "0"){
				wait 3
			}else if (level.skill == "1"){
				wait 2.4
			}else if (level.skill == "2"){
				wait 1.8
			}
			wait 1.8
		}
		else{ //chrissstrahl - coop
			wait 0.5
		}
		
		
		local.player = exec coop_mod/replace.scr::player_closestTo self //chrissstrahl - coop

		if !(isAlive $scene4_tank){ end }

		if !(sighttrace (local.player.origin + (0 0 320)) self.origin 1){
			//println "DENIED BY NO LINE OF SIGHT" //[200] chrissstrahl - stop console spam
			end
		}

		self startfiring
		wait 1

		if !(isAlive $scene4_tank){ end }

		self stopFiring
	}
}end

//============================================================//

scene4_manualgun1:
	//end of main street special gunner in building

	//$scene4_manual_gun1
	//$scene4_manual_gun1_gunner
	//$scene4_manual_gun1_trigger1
	//$scene4_manual_gun1_trigger2
	//$scene4_manual_gun1_target
	//$scene4_manual_gun1_path

	$scene4_manual_gun1 thread global/mg42.scr::main $scene4_manual_gun1_target $scene4_manual_gun1_path $scene4_manual_gun1_trigger1 $scene4_manual_gun1_trigger2 $scene4_manual_gun1_gunner
	//===Set some targeting info, wait to allow some use of the target path before engaging targeting system
	wait 5

	$scene4_manual_gun1 thread scene4_manualgun1_targeting $scene4_manual_gun1_gunner
end

//=========================================================================
scene4_manualgun1_targeting local.gunner:{
//=========================================================================
	while (isAlive local.gunner){
		self startfiring
		local.player = exec coop_mod/replace.scr::player_closestTo self
		self setaimtarget local.player

		if(level.gametype == 0){ //chrissstrahl - only do in sp
			if (level.skill == "0"){
				self bulletdamage 15
				wait 0.5
			}else if (level.skill == "1"){
				self bulletdamage 30
				wait 1
			}else if (level.skill == "2"){
				self bulletdamage 45
				wait 2
			}
		}else{ //chrissstrahl - coop/mp
			self bulletdamage 45
			wait 1.5 //chrissstrahl - might be to short
		}

		if(level.gametype == 0){ //chrissstrahl - only do in sp
			if (isAlive level.ramsey){
				self setaimtarget level.ramsey
				wait 0.5
			}

			if (isAlive level.tomlin){
				self setaimtarget level.tomlin
				wait 0.5
			}

			if (isAlive level.harrison){
				self setaimtarget level.harrison
				wait 0.5
			}
		}

		self stopfiring
		wait 2
	}
}end

//============================================================//

//***Call from thread scene4_mgfodder, from a trigger_once

scene4_mgfodderspawn:
	local.scene4_mgfodder1 = "scene4_mgfodder1"
	local.scene4_mgfodder2 = "scene4_mgfodder2"
	local.scene4_mgfodder3 = "scene4_mgfodder3"
	local.scene4_mgfodder4 = "scene4_mgfodder4"

	spawn models/human/german_panzer_shutze "targetname" (local.scene4_mgfodder1) "type_attack" "cover"
	spawn models/human/german_panzer_shutze "targetname" (local.scene4_mgfodder2) "type_attack" "cover"
	spawn models/human/german_panzer_shutze "targetname" (local.scene4_mgfodder3) "type_attack" "cover"
	spawn models/human/german_panzer_shutze "targetname" (local.scene4_mgfodder4) "type_attack" "cover"

	$(local.scene4_mgfodder1).origin = $scene4_mgfoddernode1_spawn.origin
	$(local.scene4_mgfodder2).origin = $scene4_mgfoddernode2_spawn.origin
	$(local.scene4_mgfodder3).origin = $scene4_mgfoddernode3_spawn.origin
	$(local.scene4_mgfodder4).origin = $scene4_mgfoddernode4_spawn.origin

	$(local.scene4_mgfodder1) thread scene4_mgfodder_setup
	$(local.scene4_mgfodder2) thread scene4_mgfodder_setup
	$(local.scene4_mgfodder3) thread scene4_mgfodder_setup
	$(local.scene4_mgfodder4) thread scene4_mgfodder_setup

	$(local.scene4_mgfodder1) thread scene4_mgfodder_navigate $scene4_mgfoddernode1
	$(local.scene4_mgfodder2) thread scene4_mgfodder_navigate $scene4_mgfoddernode2
	$(local.scene4_mgfodder3) thread scene4_mgfodder_navigate $scene4_mgfoddernode3
	$(local.scene4_mgfodder4) thread scene4_mgfodder_navigate $scene4_mgfoddernode4
end

scene4_mgfodder_setup:
	self.noticescale = 100
	self.fov = 150
	self.maxdist = 5000
	self.sight = 5000
	self gun "MP40"
	self.ammo_grenade = 2
	self.interval = 256
end

scene4_mgfodder_navigate local.mgfoddernode:
	self exec global/runto.scr local.mgfoddernode
	self waittill movedone
	self exec global/crouch.scr
end

scene4_mgfodderspawn_deactivate:
	//===Called from a trigger_once in the bsp just past the tank blast holes
	$scene4_mgfodderspawn_trigger remove
end

scene4_spawner1_initialize:
	level.scene4_spawn1_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene4_spawn1_teamlimitmax = 12	//initializes constant for total number allowed to spawn
	level.scene4_spawn1_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene4_spawn1_currentalivemax = 3	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene4_spawn1_loopwaittime = 1	//initializes constant for time between respawns
	level.scene4_spawn1_deactivator = 0		//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene4_spawndetector1_control
end

//=========================================================================
scene4_spawndetector1_control:{
//=========================================================================
	if (level.scene4_spawn1_deactivator == 1){ end }

	local.loopwaittime = 2	//original 0.2

	//while ($player isTouching $scene4_spawndetector1 || $player isTouching $scene4_spawndetector1a || $player isTouching $scene4_spawndetector1b){ //chrissstrahl
	while (	exec coop_mod/replace.scr::istouching $scene4_spawndetector1 ||
			exec coop_mod/replace.scr::istouching $scene4_spawndetector1a ||
			exec coop_mod/replace.scr::istouching $scene4_spawndetector1b ){ //chrissstrahl - coop 
		//===3 at a time, use +3
		//===Crazy fire and maneuver enemy attack, use nothing
//		if ((	level.scene4_spawn1_currentalive) <= level.scene4_spawn1_currentalivemax &&
//				level.scene4_spawn1_deactivator == 0 && level.scene4_spawn1_teamvalue < level.scene4_spawn1_teamlimitmax)
		if (	(level.scene4_spawn1_currentalive + level.scene4_spawn1_currentalivemax) <= level.scene4_spawn1_currentalivemax &&
				level.scene4_spawn1_deactivator == 0 &&
				level.scene4_spawn1_teamvalue < level.scene4_spawn1_teamlimitmax){
		
//			centerprint(level.scene4_spawn1_currentalive + "<" + level.scene4_spawn1_currentalivemax + "\n" + level.scene4_spawn1_deactivator + "=" + level.scene4_spawn1_deactivator+ "\n" + level.scene4_spawn1_teamvalue + "<" + level.scene4_spawn1_teamlimitmax )

			local.scene4_spawn1_ai_name1 = "scene4_spawn1_ai1_" + level.scene4_spawn1_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene4_spawndetector1_spawner1.origin						//spawn location as a script_origin

			local.scene4_spawn1_ai_name2 = "scene4_spawn1_ai2_" + level.scene4_spawn1_teamvalue
			local.org2 = $scene4_spawndetector1_spawner2.origin

			local.scene4_spawn1_ai_name3 = "scene4_spawn1_ai3_" + level.scene4_spawn1_teamvalue
			local.org3 = $scene4_spawndetector1_spawner3.origin

		//===Spawn 3 enemy soldiers in a wave
			spawn models/human/german_panzer_shutze "targetname" (local.scene4_spawn1_ai_name1) "type_attack" "cover"
			$(local.scene4_spawn1_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene4_spawn1_currentalive ++							//increment the max allowed alive at any given time
			level.scene4_spawn1_teamvalue ++							//track the scene's enemy population
			$(local.scene4_spawn1_ai_name1) thread scene4_spawn1_detect_death 	//call a waittill death thread
			$(local.scene4_spawn1_ai_name1) thread scene4_spawn1_ai_navigate1 	//call navigation thread
			$(local.scene4_spawn1_ai_name1).mindist = 128
			$(local.scene4_spawn1_ai_name1).maxdist = 4000
			$(local.scene4_spawn1_ai_name1).leash = 10000
			$(local.scene4_spawn1_ai_name1).fixedleash = 0
			$(local.scene4_spawn1_ai_name1).sight = 2000
			$(local.scene4_spawn1_ai_name1).noticescale = 50
			$(local.scene4_spawn1_ai_name1).hearing = 4000
			$(local.scene4_spawn1_ai_name1).interval = 128
			$(local.scene4_spawn1_ai_name1) exec maps/m3l3/coopified.scr::ai_accuracy 20 50 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_waffenss_nco "targetname" (local.scene4_spawn1_ai_name2) "type_attack" "cover"
			$(local.scene4_spawn1_ai_name2).origin = local.org2					//place the guy in the correct spot
			level.scene4_spawn1_currentalive ++									//increment the max allowed alive at any given time
			level.scene4_spawn1_teamvalue ++
			$(local.scene4_spawn1_ai_name2) thread scene4_spawn1_detect_death 	//call a waittill death thread
			$(local.scene4_spawn1_ai_name2) thread scene4_spawn1_ai_navigate2 	//call navigation thread
			$(local.scene4_spawn1_ai_name2) gun "mp40"
			$(local.scene4_spawn1_ai_name2).mindist = 128
			$(local.scene4_spawn1_ai_name2).maxdist = 4000
			$(local.scene4_spawn1_ai_name2).leash = 10000
			$(local.scene4_spawn1_ai_name2).fixedleash = 0
			$(local.scene4_spawn1_ai_name2).sight = 2000
			$(local.scene4_spawn1_ai_name2).noticescale = 1
			$(local.scene4_spawn1_ai_name2).hearing = 4000
			$(local.scene4_spawn1_ai_name2).interval = 128
			$(local.scene4_spawn1_ai_name2) dontdropweapons
			$(local.scene4_spawn1_ai_name2) exec maps/m3l3/coopified.scr::ai_accuracy 20 40 65 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_panzer_shutze "targetname" (local.scene4_spawn1_ai_name3) "type_attack" "cover"
			$(local.scene4_spawn1_ai_name3).origin = local.org3				//place the guy in the correct spot
			level.scene4_spawn1_currentalive ++							//increment the max allowed alive at any given time
			level.scene4_spawn1_teamvalue ++
			$(local.scene4_spawn1_ai_name3) thread scene4_spawn1_detect_death 	//call a waittill death thread
			$(local.scene4_spawn1_ai_name3) thread scene4_spawn1_ai_navigate3  	//call navigation thread
			$(local.scene4_spawn1_ai_name3).mindist = 128
			$(local.scene4_spawn1_ai_name3).maxdist = 4000
			$(local.scene4_spawn1_ai_name3).leash = 10000
			$(local.scene4_spawn1_ai_name3).fixedleash = 0
			$(local.scene4_spawn1_ai_name3).sight = 2000
			$(local.scene4_spawn1_ai_name3).noticescale = 1
			$(local.scene4_spawn1_ai_name3).hearing = 4000
			$(local.scene4_spawn1_ai_name3).interval = 128
			$(local.scene4_spawn1_ai_name3) dontdropweapons
			$(local.scene4_spawn1_ai_name3) exec maps/m3l3/coopified.scr::ai_accuracy 20 40 65 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
//			centerprint(level.scene4_spawn1_currentalive + "<" + level.scene4_spawn1_currentalivemax + "\n" + level.scene4_spawn1_deactivator + "=" + level.scene4_spawn1_deactivator+ "\n" + level.scene4_spawn1_teamvalue + "<" + level.scene4_spawn1_teamlimitmax )
		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}

	wait local.loopwaittime				//prevent infinite loop warning
	goto scene4_spawndetector1_control
}end

scene4_spawn1_detect_death:
	self waittill death
	level.scene4_spawn1_currentalive --	//decrement the population count
end

scene4_spawn1_ai_navigate1:
	self exec global/runto.scr $scene4_spawn1_rallypoint1
end

scene4_spawn1_ai_navigate2:
	self exec global/runto.scr $scene4_spawn1_rallypoint2
end

scene4_spawn1_ai_navigate3:
	self exec global/runto.scr $scene4_spawn1_rallypoint3
end

scene4_spawn1_terminate:
	level.scene4_spawn1_deactivator = 1
end

scene4_spawner2_initialize:
	level.scene4_spawn2_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene4_spawn2_teamlimitmax = 9	//initializes constant for total number allowed to spawn
	level.scene4_spawn2_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene4_spawn2_loopwaittime = 1	//initializes constant for time between respawns
	level.scene4_spawn2_deactivator = 0		//initializes variable for shutting down this loop's ability to spawn when the player is past this area
	level.scene4_spawn2_currentalivemax = 3	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	if(level.gametype == 0){ //chrissstrahl - make this easy and right, also only for sp
		if (int(level.skill) < 1){
			level.scene4_spawn2_currentalivemax = 2	//initializes constant for maximum number allowed to be alive at any given time from this spawner
		}
	}
	thread scene4_spawndetector2_control
end

//============================================================//

scene4_spawndetector2_control:
	if (level.scene4_spawn2_deactivator == 1){ end }

	local.loopwaittime = 2	//original 0.2
	
	//while (	$player isTouching $scene4_spawndetector2 || $player isTouching $scene4_spawndetector2a) //chrissstrahl
	while (	exec coop_mod/replace.scr::istouching $scene4_spawndetector2 ||
			exec coop_mod/replace.scr::istouching $scene4_spawndetector2a){ //chrissstrahl - coop
		//===3 at a time, use +3
		//===Crazy fire and maneuver enemy attack, use nothing
		if ((level.scene4_spawn2_currentalive + level.scene4_spawn2_currentalivemax) <= level.scene4_spawn2_currentalivemax && level.scene4_spawn2_deactivator == 0 && level.scene4_spawn2_teamvalue < level.scene4_spawn2_teamlimitmax)
//		if ((level.scene4_spawn2_currentalive) <= level.scene4_spawn2_currentalivemax && level.scene4_spawn2_deactivator == 0 && level.scene4_spawn2_teamvalue < level.scene4_spawn2_teamlimitmax)

		{
//			centerprint(level.scene4_spawn2_currentalive + "<" + level.scene4_spawn2_currentalivemax + "\n" + level.scene4_spawn2_deactivator + "=" + level.scene4_spawn2_deactivator+ "\n" + level.scene4_spawn2_teamvalue + "<" + level.scene4_spawn2_teamlimitmax )

			local.scene4_spawn2_ai_name1 = "scene4_spawn2_ai1_" + level.scene4_spawn2_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene4_spawndetector2_spawner1.origin						//spawn location as a script_origin

			local.scene4_spawn2_ai_name2 = "scene4_spawn2_ai2_" + level.scene4_spawn2_teamvalue
			local.org2 = $scene4_spawndetector2_spawner2.origin

			local.scene4_spawn2_ai_name3 = "scene4_spawn2_ai3_" + level.scene4_spawn2_teamvalue
			local.org3 = $scene4_spawndetector2_spawner3.origin

		//===Spawn 3 enemy soldiers in a wave
		
			spawn models/human/german_panzer_shutze "targetname" (local.scene4_spawn2_ai_name1) "type_attack" "cover"
			spawn models/human/german_waffenss_nco "targetname" (local.scene4_spawn2_ai_name2) "type_attack" "cover"
			spawn models/human/german_panzer_shutze "targetname" (local.scene4_spawn2_ai_name3) "type_attack" "cover"
			
			for (local.i = 1;local.i <= 3;local.i++){ //chrissstrahl - coop - make compact
				level.scene4_spawn2_currentalive ++							//increment the max allowed alive at any given time
				level.scene4_spawn2_teamvalue ++							//track the scene's enemy population
				local.tName = $("scene4_spawn2_ai"+local.i+"_" + level.scene4_spawn2_teamvalue)
				//[200] chrissstrahl - fixed reference to NULL entity
				if($(local.tName) != NULL){
					$(local.tName) thread scene4_spawn2_detect_death 	//call a waittill death thread
					$(local.tName).mindist = 128			
					$(local.tName).leash = 10000
					$(local.tName).fixedleash = 0
					$(local.tName).hearing = 4000
					$(local.tName).interval = 128
					$(local.tName).noticescale = 20
					$(local.tName).sight = 2000
				}
				//end chrissstrahl
			}
			
			$(local.scene4_spawn2_ai_name1).origin = local.org1				//place the guy in the correct spot
			$(local.scene4_spawn2_ai_name1) thread scene4_spawn2_ai_navigate1 	//call navigation thread
			$(local.scene4_spawn2_ai_name1).maxdist = 2000
			$(local.scene4_spawn2_ai_name1) exec maps/m3l3/coopified.scr::ai_accuracy 20 45 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
			
			$(local.scene4_spawn2_ai_name2).origin = local.org2				//place the guy in the correct spot
			$(local.scene4_spawn2_ai_name2) thread scene4_spawn2_ai_navigate2 	//call navigation thread
			$(local.scene4_spawn2_ai_name2) gun "mp40"			
			$(local.scene4_spawn2_ai_name2).maxdist = 640
			$(local.scene4_spawn2_ai_name2) dontdropweapons				
			$(local.scene4_spawn2_ai_name2) exec maps/m3l3/coopified.scr::ai_accuracy 20 40 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill			
						
			$(local.scene4_spawn2_ai_name3).origin = local.org3				//place the guy in the correct spot
			$(local.scene4_spawn2_ai_name3) thread scene4_spawn2_ai_navigate3  	//call navigation thread
			$(local.scene4_spawn2_ai_name3).maxdist = 4000
			$(local.scene4_spawn2_ai_name3) exec maps/m3l3/coopified.scr::ai_accuracy 20 40 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
//			centerprint(level.scene4_spawn2_currentalive + "<" + level.scene4_spawn2_currentalivemax + "\n" + level.scene4_spawn2_deactivator + "=" + level.scene4_spawn2_deactivator+ "\n" + level.scene4_spawn2_teamvalue + "<" + level.scene4_spawn2_teamlimitmax )
		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene4_spawndetector2_control
end

scene4_spawn2_detect_death:
	self waittill death
	level.scene4_spawn2_currentalive --	//decrement the population count
end

scene4_spawn2_ai_navigate1:
	self exec global/runto.scr $scene4_spawn2_rallypoint1
end

//============================================================//

scene4_spawn2_ai_navigate2:
	self exec global/runto.scr $scene4_spawn2_rallypoint2
end

//============================================================//

scene4_spawn2_ai_navigate3:
	self exec global/runto.scr $scene4_spawn2_rallypoint3
end

//============================================================//

scene4_spawn2_terminate:
	level.scene4_spawn2_deactivator = 1
end

//============================================================//

scene4_spawner3_initialize:

	level.scene4_spawn3_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene4_spawn3_teamlimitmax = 6	//initializes constant for total number allowed to spawn original 9
	level.scene4_spawn3_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene4_spawn3_currentalivemax = 3	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	if (level.skill == "0"){
			level.scene4_spawn3_currentalivemax = 2	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	}

	level.scene4_spawn3_loopwaittime = 1	//initializes constant for time between respawns
	level.scene4_spawn3_deactivator = 0		//initializes variable for shutting down this loop's ability to spawn when the player is past this area
	
	thread scene4_spawndetector3_control
end

//============================================================//

scene4_spawndetector3_control:

	if (level.scene4_spawn3_deactivator == 1){ end }

	local.loopwaittime = 2	//original 0.2

	//while ($player isTouching $scene4_spawndetector3) //chrissstrahl
	while (exec coop_mod/replace.scr::istouching $scene4_spawndetector3){ //chrissstrahl - coop
		//===3 at a time, use +3
		//===Crazy fire and maneuver enemy attack, use nothing

		if ((level.scene4_spawn3_currentalive + level.scene4_spawn3_currentalivemax) <= level.scene4_spawn3_currentalivemax && level.scene4_spawn3_deactivator == 0 && level.scene4_spawn3_teamvalue < level.scene4_spawn3_teamlimitmax)
//		if ((level.scene4_spawn3_currentalive) <= level.scene4_spawn3_currentalivemax && level.scene4_spawn3_deactivator == 0 && level.scene4_spawn3_teamvalue < level.scene4_spawn3_teamlimitmax)

		{
//			centerprint(level.scene4_spawn3_currentalive + "<" + level.scene4_spawn3_currentalivemax + "\n" + level.scene4_spawn3_deactivator + "=" + level.scene4_spawn3_deactivator+ "\n" + level.scene4_spawn3_teamvalue + "<" + level.scene4_spawn3_teamlimitmax )

			local.scene4_spawn3_ai_name1 = "scene4_spawn3_ai1_" + level.scene4_spawn3_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene4_spawndetector3_spawner1.origin						//spawn location as a script_origin

			local.scene4_spawn3_ai_name2 = "scene4_spawn3_ai2_" + level.scene4_spawn3_teamvalue
			local.org2 = $scene4_spawndetector3_spawner2.origin

			local.scene4_spawn3_ai_name3 = "scene4_spawn3_ai3_" + level.scene4_spawn3_teamvalue
			local.org3 = $scene4_spawndetector3_spawner3.origin

		//===Spawn 3 enemy soldiers in a wave			
			spawn models/human/german_waffenss_shutze "targetname" (local.scene4_spawn3_ai_name1) "type_attack" "cover"
			$(local.scene4_spawn3_ai_name1).origin = local.org1				//place the guy in the correct spot
			$(local.scene4_spawn3_ai_name1) thread scene4_spawn3_ai_navigate1 	//call navigation thread
			$(local.scene4_spawn3_ai_name1) exec maps/m3l3/coopified.scr::ai_accuracy 20 45 65 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
			
			spawn models/human/german_waffenss_nco "targetname" (local.scene4_spawn3_ai_name2) "type_attack" "cover"
			$(local.scene4_spawn3_ai_name2).origin = local.org2				//place the guy in the correct spot
			$(local.scene4_spawn3_ai_name2) thread scene4_spawn3_ai_navigate2 	//call navigation thread
			$(local.scene4_spawn3_ai_name2) gun "mp40"
			$(local.scene4_spawn3_ai_name2) dontdropweapons
			$(local.scene4_spawn3_ai_name2) exec maps/m3l3/coopified.scr::ai_accuracy 20 45 65 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
			
			spawn models/human/german_waffenss_shutze "targetname" (local.scene4_spawn3_ai_name3) "type_attack" "cover"
			$(local.scene4_spawn3_ai_name3).origin = local.org3				//place the guy in the correct spot
			$(local.scene4_spawn3_ai_name3) thread scene4_spawn3_ai_navigate3  	//call navigation thread		
			$(local.scene4_spawn3_ai_name3) exec maps/m3l3/coopified.scr::ai_accuracy 20 45 75 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
			
			for (local.i = 1;local.i <= 3;local.i++){ //chrissstrahl - make compact
				local.ai = $("scene4_spawn3_ai"+local.i+"_" + level.scene4_spawn3_teamvalue)
				level.scene4_spawn3_currentalive ++							//increment the max allowed alive at any given time
				level.scene4_spawn3_teamvalue ++							//track the scene's enemy population
				//[200] chrissstrahl - fix NULL entity reference
				if($(local.ai) != NULL){
					$(local.ai) thread scene4_spawn3_detect_death 	//call a waittill death thread
					$(local.ai).mindist = 128
					$(local.ai).maxdist = 4000
					$(local.ai).leash = 10000
					$(local.ai).interval = 128
					$(local.ai).fixedleash = 0
					$(local.ai).hearing = 4000
					$(local.ai).noticescale = 1
				}
				//end chrissstrahl
			}
//			centerprint(level.scene4_spawn3_currentalive + "<" + level.scene4_spawn3_currentalivemax + "\n" + level.scene4_spawn3_deactivator + "=" + level.scene4_spawn3_deactivator+ "\n" + level.scene4_spawn3_teamvalue + "<" + level.scene4_spawn3_teamlimitmax )
		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}

	wait local.loopwaittime				//prevent infinite loop warning
	goto scene4_spawndetector3_control

end

//============================================================//

scene4_spawn3_detect_death:
	self waittill death
	level.scene4_spawn3_currentalive --	//decrement the population count
end

//============================================================//

scene4_spawn3_ai_navigate1:
	self exec global/runto.scr $scene4_spawn3_rallypoint1
end

//============================================================//

scene4_spawn3_ai_navigate2:
	self exec global/runto.scr $scene4_spawn3_rallypoint2
end

//============================================================//

scene4_spawn3_ai_navigate3:
	self exec global/runto.scr $scene4_spawn3_rallypoint3
end

//============================================================//

scene4_spawn3_terminate:
	level.scene4_spawn3_deactivator = 1
end

//============================================================//

scene4_spawner4_initialize:
	level.scene4_spawn4_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene4_spawn4_teamlimitmax = 6	//initializes constant for total number allowed to spawn
	level.scene4_spawn4_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene4_spawn4_currentalivemax = 2	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene4_spawn4_loopwaittime = 1	//initializes constant for time between respawns
	level.scene4_spawn4_deactivator = 0		//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene4_spawndetector4_control
end

//============================================================//

scene4_spawndetector4_control:
	//iprintlnbold_noloc("scene4_spawndetector4_control")

	if (level.scene4_spawn4_deactivator == 1){ end }
	local.loopwaittime = 2	//original 0.2

	while (exec coop_mod/replace.scr::istouching $scene4_spawndetector4){ //chrissstrahl - coop
		//===3 at a time, use +3
		//===Crazy fire and maneuver enemy attack, use nothing
		//[200] chrissstrahl - restored to origuinal
		if ((level.scene4_spawn4_currentalive + 2) <= level.scene4_spawn4_currentalivemax && level.scene4_spawn4_deactivator == 0 && level.scene4_spawn4_teamvalue < level.scene4_spawn4_teamlimitmax)
		//if ((level.scene4_spawn4_currentalive + level.scene4_spawn4_currentalivemax) <= level.scene4_spawn4_currentalivemax && level.scene4_spawn4_deactivator == 0 && level.scene4_spawn4_teamvalue < level.scene4_spawn4_teamlimitmax)
//original	if ((level.scene4_spawn4_currentalive + 2) <= level.scene4_spawn4_currentalivemax && level.scene4_spawn4_deactivator == 0 && level.scene4_spawn4_teamvalue < level.scene4_spawn4_teamlimitmax)

		{
//			centerprint(level.scene4_spawn4_currentalive + "<" + level.scene4_spawn4_currentalivemax + "\n" + level.scene4_spawn4_deactivator + "=" + level.scene4_spawn4_deactivator+ "\n" + level.scene4_spawn4_teamvalue + "<" + level.scene4_spawn4_teamlimitmax )

			local.scene4_spawn4_ai_name1 = "scene4_spawn4_ai1_" + level.scene4_spawn4_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene4_spawndetector4_spawner1.origin						//spawn location as a script_origin

			local.scene4_spawn4_ai_name2 = "scene4_spawn4_ai2_" + level.scene4_spawn4_teamvalue
			local.org2 = $scene4_spawndetector4_spawner2.origin

			local.scene4_spawn4_ai_name3 = "scene4_spawn4_ai3_" + level.scene4_spawn4_teamvalue
			local.org3 = $scene4_spawndetector4_spawner3.origin

		//===Spawn 3 enemy soldiers in a wave
			spawn models/human/german_panzer_shutze "targetname" (local.scene4_spawn4_ai_name1) "type_attack" "cover"
			
			//$(local.scene4_spawn4_ai_name1).origin = local.org1				//place the guy in the correct spot
			$(local.scene4_spawn4_ai_name1) origin local.org1 //[200] chrissstrahl - made bt compatible
			
			$(local.scene4_spawn4_ai_name1) thread scene4_spawn4_ai_navigate1 	//call navigation thread
			$(local.scene4_spawn4_ai_name1) exec maps/m3l3/coopified.scr::ai_accuracy 20 40 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_waffenss_nco "targetname" (local.scene4_spawn4_ai_name2) "type_attack" "cover"
			
			//$(local.scene4_spawn4_ai_name2).origin = local.org2				//place the guy in the correct spot
			$(local.scene4_spawn4_ai_name2) origin local.org2	 //[200] chrissstrahl - made bt compatible
			
			$(local.scene4_spawn4_ai_name2) thread scene4_spawn4_ai_navigate2 	//call navigation thread
			$(local.scene4_spawn4_ai_name2) gun "mp40"
			$(local.scene4_spawn4_ai_name2) exec maps/m3l3/coopified.scr::ai_accuracy 20 40 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
			$(local.scene4_spawn4_ai_name2) dontdropweapons

			spawn models/human/german_panzer_shutze "targetname" (local.scene4_spawn4_ai_name3) "type_attack" "cover"
			
			//$(local.scene4_spawn4_ai_name3).origin = local.org3				//place the guy in the correct spot
			$(local.scene4_spawn4_ai_name3) origin local.org3	//[200] chrissstrahl - made bt compatible
			
			$(local.scene4_spawn4_ai_name3) thread scene4_spawn4_detect_death 	//call a waittill death thread
			$(local.scene4_spawn4_ai_name3) thread scene4_spawn4_ai_navigate3  	//call navigation thread
			$(local.scene4_spawn4_ai_name3) exec maps/m3l3/coopified.scr::ai_accuracy 20 45 75 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill	
			
			//[200] chrissstrahl - fix wrong var names
			for (local.i = 1;local.i <= 3;local.i++){ //chrissstrahl - make compact
				local.ai = $("scene4_spawn4_ai"+local.i+"_" + level.scene4_spawn4_teamvalue)
				level.scene4_spawn4_currentalive ++							//increment the max allowed alive at any given time
				level.scene4_spawn4_teamvalue ++							//track the scene's enemy population	
				//[200] chrissstrahl - fix NULL entity reference
				if($(local.ai) != NULL){
					$(local.ai) thread scene4_spawn4_detect_death 	//call a waittill death thread
					$(local.ai).mindist = 128
					$(local.ai).maxdist = 4000
					$(local.ai).leash = 10000
					$(local.ai).interval = 128
					$(local.ai).fixedleash = 0
					$(local.ai).hearing = 4000
					$(local.ai).noticescale = 1
				}
				//end chrissstrahl
			}
			
			/*
			local.someEntity = $(local.scene4_spawn4_ai_name1)
			if(local.someEntity.size){
				iprintlnbold_noloc("scene4_spawndetector4_control SIZE ISSUE")
			}
			*/
			
			$(local.scene4_spawn4_ai_name1).noticescale = 50

			//centerprint(level.scene4_spawn4_currentalive + "<" + level.scene4_spawn4_currentalivemax + "\n" + level.scene4_spawn4_deactivator + "=" + level.scene4_spawn4_deactivator+ "\n" + level.scene4_spawn4_teamvalue + "<" + level.scene4_spawn4_teamlimitmax )

		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}

	wait local.loopwaittime				//prevent infinite loop warning
	goto scene4_spawndetector4_control

end

//============================================================//

scene4_spawn4_detect_death:
	self waittill death
	level.scene4_spawn4_currentalive --	//decrement the population count
end

//============================================================//

scene4_spawn4_ai_navigate1:
	self exec global/runto.scr $scene4_spawn4_rallypoint1
end

//============================================================//

scene4_spawn4_ai_navigate2:
	self exec global/runto.scr $scene4_spawn4_rallypoint2
end

//============================================================//

scene4_spawn4_ai_navigate3:
	self exec global/runto.scr $scene4_spawn4_rallypoint3
end

//============================================================//

scene4_spawn4_terminate:
	level.scene4_spawn4_deactivator = 1
end

//==============================================================================================================================================//
//																								//
//										SCENE 5 SUPPORT THREADS											//
//																								//
//==============================================================================================================================================//

//Rolled into Scene 4, effectively

//==============================================================================================================================================//
//																								//
//										SCENE 6 SUPPORT THREADS											//
//																								//
//==============================================================================================================================================//

scene6_friendly_dumbdown:
	if (isAlive level.ramsey){
		level.ramsey.accuracy		= 15		//marksmanship original 20
	}

	if (isAlive level.tomlin){
		level.tomlin.accuracy		= 15		//marksmanship original 20
	}

	if (isAlive level.harrison){
		level.harrison.accuracy		= 15		//marksmanship original 20
	}
end

//============================================================//

scene6_spawner1_initialize:

	level.scene6_spawn1_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene6_spawn1_teamlimitmax = 18	//initializes constant for total number allowed to spawn
	if (level.gatmetype == 0 && level.skill == "0"){ //chrissstrahl - handle sp
		level.scene6_spawn1_teamlimitmax = 9	//initializes constant for total number allowed to spawn
	}
	level.scene6_spawn1_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene6_spawn1_currentalivemax = 3	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene6_spawn1_loopwaittime = 1	//initializes constant for time between respawns
	level.scene6_spawn1_deactivator = 0		//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene6_spawndetector1_control
end

//============================================================//

scene6_spawndetector1_control:

	if (level.scene6_spawn1_deactivator == 1){ end }

	local.loopwaittime = 0.5	//original 0.2

	//while ($player isTouching $scene6_spawndetector1) //chrissstrahl
	while (exec coop_mod/replace.scr::istouching $scene6_spawndetector1){ //chrissstrahl - coop
		//===3 at a time, use +3
		//===Crazy fire and maneuver enemy attack, use nothing

		if ((level.scene6_spawn1_currentalive + level.scene6_spawn1_currentalivemax) <= level.scene6_spawn1_currentalivemax && level.scene6_spawn1_deactivator == 0 && level.scene6_spawn1_teamvalue < level.scene6_spawn1_teamlimitmax)
//		if ((level.scene6_spawn1_currentalive + 1) <= level.scene6_spawn1_currentalivemax && level.scene6_spawn1_deactivator == 0 && level.scene6_spawn1_teamvalue < level.scene6_spawn1_teamlimitmax)

		{
//			centerprint(level.scene6_spawn1_currentalive + "<" + level.scene6_spawn1_currentalivemax + "\n" + level.scene6_spawn1_deactivator + "=" + level.scene6_spawn1_deactivator+ "\n" + level.scene6_spawn1_teamvalue + "<" + level.scene6_spawn1_teamlimitmax )

			local.scene6_spawn1_ai_name1 = "scene6_spawn1_ai1_" + level.scene6_spawn1_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene6_spawndetector1_spawner1.origin						//spawn location as a script_origin

			local.scene6_spawn1_ai_name2 = "scene6_spawn1_ai2_" + level.scene6_spawn1_teamvalue
			local.org2 = $scene6_spawndetector1_spawner2.origin

			local.scene6_spawn1_ai_name3 = "scene6_spawn1_ai3_" + level.scene6_spawn1_teamvalue
			local.org3 = $scene6_spawndetector1_spawner3.origin

		//===Spawn 3 enemy soldiers in a wave

			spawn models/human/german_waffenss_nco "targetname" (local.scene6_spawn1_ai_name1) "type_attack" "cover"
			$(local.scene6_spawn1_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene6_spawn1_currentalive ++							//increment the max allowed alive at any given time
			level.scene6_spawn1_teamvalue ++							//track the scene's enemy population
			$(local.scene6_spawn1_ai_name1) thread scene6_spawn1_detect_death 	//call a waittill death thread
			$(local.scene6_spawn1_ai_name1) thread scene6_spawn1_ai_navigate1 	//call navigation thread
			$(local.scene6_spawn1_ai_name1).mindist = 128
			$(local.scene6_spawn1_ai_name1).maxdist = 1200
			$(local.scene6_spawn1_ai_name1).leash = 100000
			$(local.scene6_spawn1_ai_name1).fixedleash = 1
			$(local.scene6_spawn1_ai_name1).sight = 3000
			$(local.scene6_spawn1_ai_name1).noticescale = 50
			$(local.scene6_spawn1_ai_name1).hearing = 4000
			$(local.scene6_spawn1_ai_name1).interval = 128				
			$(local.scene6_spawn1_ai_name1) exec maps/m3l3/coopified.scr::ai_accuracy 20 45 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_panzer_shutze "targetname" (local.scene6_spawn1_ai_name2) "type_attack" "cover"
			$(local.scene6_spawn1_ai_name2).origin = local.org2				//place the guy in the correct spot
			level.scene6_spawn1_currentalive ++							//increment the max allowed alive at any given time
			level.scene6_spawn1_teamvalue ++
			$(local.scene6_spawn1_ai_name2) thread scene6_spawn1_detect_death 	//call a waittill death thread
			$(local.scene6_spawn1_ai_name2) thread scene6_spawn1_ai_navigate2 	//call navigation thread
			$(local.scene6_spawn1_ai_name2).mindist = 128
			$(local.scene6_spawn1_ai_name2).maxdist = 1200
			$(local.scene6_spawn1_ai_name2).leash = 100000
			$(local.scene6_spawn1_ai_name2).fixedleash = 1
			$(local.scene6_spawn1_ai_name2).sight = 6000
			$(local.scene6_spawn1_ai_name2).noticescale = 1
			$(local.scene6_spawn1_ai_name2).hearing = 4000
			$(local.scene6_spawn1_ai_name2).interval = 128
			$(local.scene6_spawn1_ai_name2) dontdropweapons
			$(local.scene6_spawn1_ai_name2)  exec maps/m3l3/coopified.scr::ai_accuracy 20 45 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_panzer_shutze "targetname" (local.scene6_spawn1_ai_name3) "type_attack" "cover"
			$(local.scene6_spawn1_ai_name3).origin = local.org3				//place the guy in the correct spot
			level.scene6_spawn1_currentalive ++							//increment the max allowed alive at any given time
			level.scene6_spawn1_teamvalue ++
			$(local.scene6_spawn1_ai_name3) thread scene6_spawn1_detect_death 	//call a waittill death thread
			$(local.scene6_spawn1_ai_name3) thread scene6_spawn1_ai_navigate3  	//call navigation thread
			$(local.scene6_spawn1_ai_name3).mindist = 128
			$(local.scene6_spawn1_ai_name3).maxdist = 1200
			$(local.scene6_spawn1_ai_name3).leash = 100000
			$(local.scene6_spawn1_ai_name3).fixedleash = 1
			$(local.scene6_spawn1_ai_name3).sight = 6000
			$(local.scene6_spawn1_ai_name3).noticescale = 1
			$(local.scene6_spawn1_ai_name3).hearing = 4000
			$(local.scene6_spawn1_ai_name3).interval = 128
			$(local.scene6_spawn1_ai_name3) exec maps/m3l3/coopified.scr::ai_accuracy 20 45 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
//			centerprint(level.scene6_spawn1_currentalive + "<" + level.scene6_spawn1_currentalivemax + "\n" + level.scene6_spawn1_deactivator + "=" + level.scene6_spawn1_deactivator+ "\n" + level.scene6_spawn1_teamvalue + "<" + level.scene6_spawn1_teamlimitmax )
		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}

	wait local.loopwaittime				//prevent infinite loop warning
	goto scene6_spawndetector1_control
end

//============================================================//

scene6_spawn1_detect_death:
	self waittill death
	level.scene6_spawn1_currentalive --	//decrement the population count
end

//============================================================//

scene6_spawn1_ai_navigate1:
	self forceactivate
	self exec global/disable_ai.scr
	self exec global/runto.scr $scene6_spawn1_rallypoint1
	wait 8	
	self exec global/enable_ai.scr
end

//============================================================//

scene6_spawn1_ai_navigate2:
	self forceactivate
	self exec global/disable_ai.scr
	self exec global/runto.scr $scene6_spawn1_rallypoint2
	wait 8	
	self exec global/enable_ai.scr
end

//============================================================//

scene6_spawn1_ai_navigate3:
	self forceactivate
	self exec global/disable_ai.scr
	self exec global/runto.scr $scene6_spawn1_rallypoint3
	wait 8	
	self exec global/enable_ai.scr
end

//============================================================//

scene6_spawn1_terminate:

level.scene6_spawn1_deactivator = 1
	if (int(level.sysconfig) < 2){ //chrissstrahl - compact
		thread quick_farplane_near
	}
end

//===============================================================================================================================//

//============================================================//

scene6_spawner2_initialize:
	level.scene6_spawn2_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene6_spawn2_teamlimitmax = 12	//initializes constant for total number allowed to spawn
	level.scene6_spawn2_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene6_spawn2_currentalivemax = 3	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene6_spawn2_loopwaittime = 1	//initializes constant for time between respawns
	level.scene6_spawn2_deactivator = 0		//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene6_spawndetector2_control
end

//============================================================//

scene6_spawndetector2_control:
	if (level.scene6_spawn2_deactivator == 1){ end }
	local.loopwaittime = 0.35	//original 0.2

	while (exec coop_mod/replace.scr::istouching $scene6_spawndetector2){ //chrissstrahl - coop
		//===3 at a time, use +3
		//===Crazy fire and maneuver enemy attack, use nothing

		if ((level.scene6_spawn2_currentalive + level.scene6_spawn2_currentalivemax) <= level.scene6_spawn2_currentalivemax && level.scene6_spawn2_deactivator == 0 && level.scene6_spawn2_teamvalue < level.scene6_spawn2_teamlimitmax)
//		if ((level.scene6_spawn2_currentalive) <= level.scene6_spawn2_currentalivemax && level.scene6_spawn2_deactivator == 0 && level.scene6_spawn2_teamvalue < level.scene6_spawn2_teamlimitmax)

		{
//			centerprint(level.scene6_spawn2_currentalive + "<" + level.scene6_spawn2_currentalivemax + "\n" + level.scene6_spawn2_deactivator + "=" + level.scene6_spawn2_deactivator+ "\n" + level.scene6_spawn2_teamvalue + "<" + level.scene6_spawn2_teamlimitmax )

			local.scene6_spawn2_ai_name1 = "scene6_spawn2_ai1_" + level.scene6_spawn2_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene6_spawndetector2_spawner1.origin						//spawn location as a script_origin

			local.scene6_spawn2_ai_name2 = "scene6_spawn2_ai2_" + level.scene6_spawn2_teamvalue
			local.org2 = $scene6_spawndetector2_spawner2.origin

			local.scene6_spawn2_ai_name3 = "scene6_spawn2_ai3_" + level.scene6_spawn2_teamvalue
			local.org3 = $scene6_spawndetector2_spawner3.origin

		//===Spawn 3 enemy soldiers in a wave

			spawn models/human/german_waffenss_shutze "targetname" (local.scene6_spawn2_ai_name1) "type_attack" "cover"
			$(local.scene6_spawn2_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene6_spawn2_currentalive ++							//increment the max allowed alive at any given time
			level.scene6_spawn2_teamvalue ++							//track the scene's enemy population
			$(local.scene6_spawn2_ai_name1) thread scene6_spawn2_detect_death 	//call a waittill death thread
			$(local.scene6_spawn2_ai_name1) thread scene6_spawn2_ai_navigate1 	//call navigation thread
			$(local.scene6_spawn2_ai_name1).mindist = 128
			$(local.scene6_spawn2_ai_name1).maxdist = 4000
			$(local.scene6_spawn2_ai_name1).leash = 100000
			$(local.scene6_spawn2_ai_name1).fixedleash = 0
			$(local.scene6_spawn2_ai_name1).sight = 2000
			$(local.scene6_spawn2_ai_name1).noticescale = 50
			$(local.scene6_spawn2_ai_name1).hearing = 4000
			$(local.scene6_spawn2_ai_name1).interval = 128
			$(local.scene6_spawn2_ai_name1) dontdropweapons
			$(local.scene6_spawn2_ai_name1) exec maps/m3l3/coopified.scr::ai_accuracy 20 40 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_waffenss_nco "targetname" (local.scene6_spawn2_ai_name2) "type_attack" "cover"
			$(local.scene6_spawn2_ai_name2).origin = local.org2				//place the guy in the correct spot
			level.scene6_spawn2_currentalive ++							//increment the max allowed alive at any given time
			level.scene6_spawn2_teamvalue ++
			$(local.scene6_spawn2_ai_name2) thread scene6_spawn2_detect_death 	//call a waittill death thread
			$(local.scene6_spawn2_ai_name2) thread scene6_spawn2_ai_navigate2 	//call navigation thread
			$(local.scene6_spawn2_ai_name2) gun "mp40"
			$(local.scene6_spawn2_ai_name2).mindist = 128
			$(local.scene6_spawn2_ai_name2).maxdist = 4000
			$(local.scene6_spawn2_ai_name2).leash = 100000
			$(local.scene6_spawn2_ai_name2).fixedleash = 0
			$(local.scene6_spawn2_ai_name2).sight = 2000
			$(local.scene6_spawn2_ai_name2).noticescale = 1
			$(local.scene6_spawn2_ai_name2).hearing = 4000
			$(local.scene6_spawn2_ai_name2).interval = 128
			$(local.scene6_spawn2_ai_name2) dontdropweapons
			$(local.scene6_spawn2_ai_name2) exec maps/m3l3/coopified.scr::ai_accuracy 20 40 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_panzer_shutze "targetname" (local.scene6_spawn2_ai_name3) "type_attack" "cover"
			$(local.scene6_spawn2_ai_name3).origin = local.org3				//place the guy in the correct spot
			level.scene6_spawn2_currentalive ++							//increment the max allowed alive at any given time
			level.scene6_spawn2_teamvalue ++
			$(local.scene6_spawn2_ai_name3) thread scene6_spawn2_detect_death 	//call a waittill death thread
			$(local.scene6_spawn2_ai_name3) thread scene6_spawn2_ai_navigate3  	//call navigation thread
			$(local.scene6_spawn2_ai_name3) gun "mp40"
			$(local.scene6_spawn2_ai_name3).mindist = 128
			$(local.scene6_spawn2_ai_name3).maxdist = 4000
			$(local.scene6_spawn2_ai_name3).leash = 100000
			$(local.scene6_spawn2_ai_name3).fixedleash = 0
			$(local.scene6_spawn2_ai_name3).sight = 2000
			$(local.scene6_spawn2_ai_name3).noticescale = 1
			$(local.scene6_spawn2_ai_name3).hearing = 4000
			$(local.scene6_spawn2_ai_name3).interval = 128
			$(local.scene6_spawn2_ai_name3) dontdropweapons
			$(local.scene6_spawn2_ai_name3) exec maps/m3l3/coopified.scr::ai_accuracy 20 40 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
//			centerprint(level.scene6_spawn2_currentalive + "<" + level.scene6_spawn2_currentalivemax + "\n" + level.scene6_spawn2_deactivator + "=" + level.scene6_spawn2_deactivator+ "\n" + level.scene6_spawn2_teamvalue + "<" + level.scene6_spawn2_teamlimitmax )
		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene6_spawndetector2_control
end

//============================================================//

scene6_spawn2_detect_death:
	self waittill death
	level.scene6_spawn2_currentalive --	//decrement the population count
end

//============================================================//

scene6_spawn2_ai_navigate1:
	self exec global/runto.scr $scene6_spawn2_rallypoint1
end

//============================================================//

scene6_spawn2_ai_navigate2:
	self exec global/runto.scr $scene6_spawn2_rallypoint2
end

//============================================================//

scene6_spawn2_ai_navigate3:
	self exec global/runto.scr $scene6_spawn2_rallypoint3
end

//============================================================//

scene6_spawn2_terminate:
	level.scene6_spawn2_deactivator = 1
end

//===============================================================================================================================//

scene6_mgspawner1_initialize:
	level.scene6_mgspawn1_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene6_mgspawn1_teamlimitmax = 3	//initializes constant for total number allowed to spawn original 3
	level.scene6_mgspawn1_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene6_mgspawn1_currentalivemax = 1	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene6_mgspawn1_loopwaittime = 3	//initializes constant for time between respawns
	level.scene6_mgspawn1_deactivator = 0	//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene6_mgspawndetector1_control
end

//============================================================//

scene6_mgspawndetector1_control:
	if (level.scene6_mgspawn1_deactivator == 1){ end }

	local.loopwaittime = 3	//original 0.2

	while (exec coop_mod/replace.scr::istouching  $scene6_mgspawndetector1){ //chrissstrahl - coop
		if ((level.scene6_mgspawn1_currentalive + 1) <= level.scene6_mgspawn1_currentalivemax && level.scene6_mgspawn1_deactivator == 0 && level.scene6_mgspawn1_teamvalue < level.scene6_mgspawn1_teamlimitmax){
//			centerprint(level.scene6_mgspawn1_currentalive + "<" + level.scene6_mgspawn1_currentalivemax + "\n" + level.scene6_mgspawn1_deactivator + "=" + level.scene6_mgspawn1_deactivator+ "\n" + level.scene6_mgspawn1_teamvalue + "<" + level.scene6_mgspawn1_teamlimitmax )

			local.scene6_mgspawn1_ai_name1 = "scene6_mgspawn1_ai1_" + level.scene6_mgspawn1_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene6_mgspawndetector1_spawner1.origin						//spawn location as a script_origin

		//===Spawn 1 enemy gunner
			spawn models/human/german_panzer_grenadier "targetname" (local.scene6_mgspawn1_ai_name1) "type_attack" "cover"

			$(local.scene6_mgspawn1_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene6_mgspawn1_currentalive ++						//increment the max allowed alive at any given time
			level.scene6_mgspawn1_teamvalue ++							//track the scene's enemy population
			$(local.scene6_mgspawn1_ai_name1) thread scene6_mgspawn1_detect_death 	//call a waittill death thread
			$(local.scene6_mgspawn1_ai_name1) thread scene6_mgspawn1_ai_navigate1 	//call navigation thread
//			$(local.scene6_mgspawn1_ai_name1) thread scene6_mgspawn_gunner_escape $scene6_gunner_escape_trigger $scene6_gunner1_escape_node

//			centerprint(level.scene6_mgspawn1_currentalive + "<" + level.scene6_mgspawn1_currentalivemax + "\n" + level.scene6_mgspawn1_deactivator + "=" + level.scene6_mgspawn1_deactivator+ "\n" + level.scene6_mgspawn1_teamvalue + "<" + level.scene6_mgspawn1_teamlimitmax )

		}

		wait local.loopwaittime	//every local.loopwaittime seconds, resume the while loop
	}

	wait local.loopwaittime				//prevent infinite loop warning
	goto scene6_mgspawndetector1_control

end

//============================================================//

scene6_mgspawn1_detect_death:

	self waittill death
	level.scene6_mgspawn1_currentalive --	//decrement the population count

end

//============================================================//

scene6_mgspawn1_ai_navigate1:
	self exec global/disable_ai.scr
	wait level.scene6_mgspawn1_loopwaittime

	if !(isAlive self){ end }

	self exec global/runto.scr $scene6_mg1_gunner_path
	self waittill movedone
	if !(isAlive self){ end }

	//===Set properties of machinegunner
	self type_idle machinegunner
	self type_attack machinegunner
	self type_disguise machinegunner
	self type_grenade machinegunner
	self gun "mp40"
	//self holster
	self health 100
	self sight 4000
	self turret $scene6_mg1
	self.flags["coopMG42_gunner"] = 1 //chrissstrahl - fix anim/attack.scr issue with ai having no weapon after exit of turret
	self exec global/enable_ai.scr

	//===Activate targeting computer for machine gun - guy doesn't actually do anything
	thread scene6_mgspawn_targeting $scene6_mg1
end

//============================================================//

scene6_mgspawn1_terminate:
	level.scene6_mgspawn1_deactivator = 1
end

//===============================================================================================================================//

//============================================================//

scene6_mgspawner2_initialize:
	level.scene6_mgspawn2_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene6_mgspawn2_teamlimitmax = 3	//initializes constant for total number allowed to spawn original 3
	level.scene6_mgspawn2_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene6_mgspawn2_currentalivemax = 1	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene6_mgspawn2_loopwaittime = 4	//initializes constant for time between respawns
	level.scene6_mgspawn2_deactivator = 0	//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene6_mgspawndetector2_control
end

//============================================================//

scene6_mgspawndetector2_control:
	if (level.scene6_mgspawn2_deactivator == 1){ end }
	
	local.loopwaittime = 3	//original 0.2

	while (exec coop_mod/replace.scr::istouching  $scene6_mgspawndetector2){ //chrissstrahl - coop
		if ((level.scene6_mgspawn2_currentalive + 1) <= level.scene6_mgspawn2_currentalivemax && level.scene6_mgspawn2_deactivator == 0 && level.scene6_mgspawn2_teamvalue < level.scene6_mgspawn2_teamlimitmax){
//			centerprint(level.scene6_mgspawn2_currentalive + "<" + level.scene6_mgspawn2_currentalivemax + "\n" + level.scene6_mgspawn2_deactivator + "=" + level.scene6_mgspawn2_deactivator+ "\n" + level.scene6_mgspawn2_teamvalue + "<" + level.scene6_mgspawn2_teamlimitmax )

			local.scene6_mgspawn2_ai_name1 = "scene6_mgspawn2_ai1_" + level.scene6_mgspawn2_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene6_mgspawndetector2_spawner1.origin						//spawn location as a script_origin

		//===Spawn 1 enemy gunner

			spawn models/human/german_panzer_grenadier "targetname" (local.scene6_mgspawn2_ai_name1) "type_attack" "cover"

			$(local.scene6_mgspawn2_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene6_mgspawn2_currentalive ++							//increment the max allowed alive at any given time
			level.scene6_mgspawn2_teamvalue ++							//track the scene's enemy population
			$(local.scene6_mgspawn2_ai_name1) thread scene6_mgspawn2_detect_death 	//call a waittill death thread
			$(local.scene6_mgspawn2_ai_name1) thread scene6_mgspawn2_ai_navigate1  	//call navigation thread
			$(local.scene6_mgspawn2_ai_name1) thread scene6_mgspawn2_ai_navigate1  	//call navigation thread
//			$(local.scene6_mgspawn2_ai_name1) thread scene6_mgspawn_gunner_escape $scene6_gunner_escape_trigger $scene6_gunner2_escape_node

//			centerprint(level.scene6_mgspawn2_currentalive + "<" + level.scene6_mgspawn2_currentalivemax + "\n" + level.scene6_mgspawn2_deactivator + "=" + level.scene6_mgspawn2_deactivator+ "\n" + level.scene6_mgspawn2_teamvalue + "<" + level.scene6_mgspawn2_teamlimitmax )
		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene6_mgspawndetector2_control
end

//============================================================//

scene6_mgspawn2_detect_death:
	self waittill death
	level.scene6_mgspawn2_currentalive --	//decrement the population count
end

//============================================================//

scene6_mgspawn2_ai_navigate1:
	self exec global/disable_ai.scr
	wait level.scene6_mgspawn2_loopwaittime

	if !(isAlive self){ end }

	self exec global/runto.scr $scene6_mg2_gunner_path
	self waittill movedone
	if !(isAlive self){ end }

	//===Set properties of machinegunner
	self type_idle machinegunner
	self type_attack machinegunner
	self type_disguise machinegunner
	self type_grenade machinegunner
	self gun "mp40"
	//self holster
	self health 100
	self sight 4000
	self turret $scene6_mg2
	self.flags["coopMG42_gunner"] = 1 //chrissstrahl - fix anim/attack.scr issue with ai having no weapon after exit of turret
	self exec global/enable_ai.scr

	//===Activate targeting computer for machine gun - guy doesn't actually do anything
	thread scene6_mgspawn_targeting $scene6_mg2
end

//============================================================//

scene6_mgspawn2_terminate:
	level.scene6_mgspawn2_deactivator = 1
end

//===============================================================================================================================//

scene6_mgspawner3_initialize:
	level.scene6_mgspawn3_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene6_mgspawn3_teamlimitmax = 2	//initializes constant for total number allowed to spawn
	level.scene6_mgspawn3_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene6_mgspawn3_currentalivemax = 1	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene6_mgspawn3_loopwaittime = 4	//initializes constant for time between respawns
	level.scene6_mgspawn3_deactivator = 0	//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene6_mgspawndetector3_control
end

//============================================================//

scene6_mgspawndetector3_control:
	if (level.scene6_mgspawn3_deactivator == 1){ end }

	local.loopwaittime = 4	//original 0.2

	while (exec coop_mod/replace.scr::istouching $scene6_mgspawndetector3){ //chrissstrahl - coop
		if ((level.scene6_mgspawn3_currentalive + 1) <= level.scene6_mgspawn3_currentalivemax && level.scene6_mgspawn3_deactivator == 0 && level.scene6_mgspawn3_teamvalue < level.scene6_mgspawn3_teamlimitmax){
//			centerprint(level.scene6_mgspawn3_currentalive + "<" + level.scene6_mgspawn3_currentalivemax + "\n" + level.scene6_mgspawn3_deactivator + "=" + level.scene6_mgspawn3_deactivator+ "\n" + level.scene6_mgspawn3_teamvalue + "<" + level.scene6_mgspawn3_teamlimitmax )

			local.scene6_mgspawn3_ai_name1 = "scene6_mgspawn3_ai1_" + level.scene6_mgspawn3_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene6_mgspawndetector3_spawner1.origin						//spawn location as a script_origin

		//===Spawn 1 enemy gunner

			spawn models/human/german_panzer_grenadier "targetname" (local.scene6_mgspawn3_ai_name1) "type_attack" "cover"

			$(local.scene6_mgspawn3_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene6_mgspawn3_currentalive ++							//increment the max allowed alive at any given time
			level.scene6_mgspawn3_teamvalue ++							//track the scene's enemy population
			$(local.scene6_mgspawn3_ai_name1) thread scene6_mgspawn3_detect_death 	//call a waittill death thread
			$(local.scene6_mgspawn3_ai_name1) thread scene6_mgspawn3_ai_navigate1 	//call navigation thread
//			$(local.scene6_mgspawn3_ai_name1) thread scene6_mgspawn_gunner_escape $scene6_gunner_escape_trigger $scene6_gunner3_escape_node

//			centerprint(level.scene6_mgspawn3_currentalive + "<" + level.scene6_mgspawn3_currentalivemax + "\n" + level.scene6_mgspawn3_deactivator + "=" + level.scene6_mgspawn3_deactivator+ "\n" + level.scene6_mgspawn3_teamvalue + "<" + level.scene6_mgspawn3_teamlimitmax )

		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene6_mgspawndetector3_control
end

//============================================================//

scene6_mgspawn3_detect_death:
	self waittill death
	level.scene6_mgspawn3_currentalive --	//decrement the population count
end

//============================================================//

scene6_mgspawn3_ai_navigate1 local.scene6_mgspawn3_ai_name1:
	self exec global/disable_ai.scr
	wait level.scene6_mgspawn3_loopwaittime

	if !(isAlive self){ end }

	self exec global/runto.scr $scene6_mg3_gunner_path
	self waittill movedone

	if !(isAlive self){ end }

	//===Set properties of machinegunner
	self type_idle machinegunner
	self type_attack machinegunner
	self type_disguise machinegunner
	self type_grenade machinegunner
	self gun "mp40"
	//self holster
	self health 100
	self sight 4000
	self turret $scene6_mg3
	self.flags["coopMG42_gunner"] = 1 //chrissstrahl - fix anim/attack.scr issue with ai having no weapon after exit of turret
	self exec global/enable_ai.scr

	//===Activate targeting computer for machine gun - guy doesn't actually do anything
	thread scene6_mgspawn_targeting $scene6_mg3
end

//============================================================//

scene6_mgspawn3_terminate:
	level.scene6_mgspawn3_deactivator = 1
end

//============================================================//

scene6_mgspawn_targeting local.machinegun:
	waitframe
	
	local.machinegun burstFireSettings 0.5 1 0.25 0.5
	local.machinegun maxYawOffset 45
	local.machinegun bulletdamage 20

	//while (!(self cansee $player) && (isAlive self)){ //chrissstrahl
	
	local.player = NULL //chrissstrahl - coop
	while (local.player == NULL && (isAlive self)){ //chrissstrahl - coop
		wait 1
		local.player = self exec coop_mod/replace.scr::canseeGetClosest //chrissstrahl - coop
	}

	while (isAlive self){
		if( level.gametype == 0 ){ //chrissstrahl - sp only
			local.machinegun setaimtarget $playertarget_right1
			local.machinegun startfiring
			wait 3
			local.machinegun setaimtarget $playertarget_right2
			wait 2
		}

		local.player = self exec coop_mod/replace.scr::canseeGetClosest 0 local.effrange //chrissstrahl - coop
		while(local.player == NULL && (isAlive self)){ //chrissstrahl - wait until a valid player is there
			wait 0.25
			local.player = self exec coop_mod/replace.scr::canseeGetClosest 0 local.effrange //chrissstrahl - coop
		}
		
		local.machinegun setaimtarget local.player //chrissstrahl - coop
		
		if(level.gametype == 0){ //chrissstrahl - sp
			if (level.skill == "0"){
				local.machinegun bulletdamage 15
				wait 1
			}else if (level.skill == "1"){
				local.machinegun bulletdamage 25
				wait 1
			}else if (level.skill == "2"){
				local.machinegun bulletdamage 55
				wait 2
			}
		}else{ //chrissstrahl - coop
			local.machinegun bulletdamage 55
			wait 2
		}
		local.machinegun stopfiring

		if (isAlive level.ramsey && self cansee level.ramsey){
			local.machinegun setaimtarget level.ramsey
			local.machinegun startfiring
			wait 1
			local.machinegun stopfiring
		}

		if (isAlive level.tomlin && self cansee level.tomlin){
			local.machinegun setaimtarget level.tomlin
			local.machinegun startfiring
			wait 2
			local.machinegun stopfiring
		}

		if (isAlive level.harrison && self cansee level.harrison){
			local.machinegun setaimtarget level.harrison
			local.machinegun startfiring
			wait 2
			local.machinegun stopfiring
		}
		wait 0.5	//gives the player a few free seconds to get to cover in case AI buddies are dead original value 6
	}
end

//============================================================//

scene6_mgspawn_gunner_escape local.escapetrigger local.escapenode:
	local.escapetrigger waittill trigger

	if !(isAlive self){ end }

	if (isAlive self){
		self type_idle idle
		self type_attack cover
		self type_disguise salute
		self type_grenade grenade
		//self holster
		self health 100
		self turret ""
		self exec global/runto.scr local.escapenode
	}
end

//==============================================================================================================================================//
//																								//
//										SCENE 7 SUPPORT THREADS											//
//																								//
//==============================================================================================================================================//

//===============================================================================================================================//

scene7_mgspawner1_initialize:
	level.scene7_mgspawn1_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene7_mgspawn1_teamlimitmax = 2	//initializes constant for total number allowed to spawn
	level.scene7_mgspawn1_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene7_mgspawn1_currentalivemax = 1	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene7_mgspawn1_loopwaittime = 10	//initializes constant for time between respawns
	level.scene7_mgspawn1_deactivator = 0	//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene7_mgspawndetector1_control
end

//============================================================//

scene7_mgspawndetector1_control:

	if (level.scene7_mgspawn1_deactivator == 1){ end }
	
	local.loopwaittime = 0.5	//2	//original 0.2

	while (exec coop_mod/replace.scr::istouching $scene7_mgspawndetector1){ //chrissstrahl - coop
		if ((level.scene7_mgspawn1_currentalive + 1) <= level.scene7_mgspawn1_currentalivemax && level.scene7_mgspawn1_deactivator == 0 && level.scene7_mgspawn1_teamvalue < level.scene7_mgspawn1_teamlimitmax){
//			centerprint(level.scene7_mgspawn1_currentalive + "<" + level.scene7_mgspawn1_currentalivemax + "\n" + level.scene7_mgspawn1_deactivator + "=" + level.scene7_mgspawn1_deactivator+ "\n" + level.scene7_mgspawn1_teamvalue + "<" + level.scene7_mgspawn1_teamlimitmax )

			local.scene7_mgspawn1_ai_name1 = "scene7_mgspawn1_ai1_" + level.scene7_mgspawn1_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene7_mgspawndetector1_spawner1.origin						//spawn location as a script_origin

		//===Spawn 1 enemy gunner

			spawn models/human/german_panzer_grenadier "targetname" (local.scene7_mgspawn1_ai_name1) "type_attack" "cover"

			$(local.scene7_mgspawn1_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene7_mgspawn1_currentalive ++						//increment the max allowed alive at any given time
			level.scene7_mgspawn1_teamvalue ++							//track the scene's enemy population
			$(local.scene7_mgspawn1_ai_name1) thread scene7_mgspawn1_detect_death 	//call a waittill death thread
			$(local.scene7_mgspawn1_ai_name1) thread scene7_mgspawn1_ai_navigate1 	//call navigation thread

//			centerprint(level.scene7_mgspawn1_currentalive + "<" + level.scene7_mgspawn1_currentalivemax + "\n" + level.scene7_mgspawn1_deactivator + "=" + level.scene7_mgspawn1_deactivator+ "\n" + level.scene7_mgspawn1_teamvalue + "<" + level.scene7_mgspawn1_teamlimitmax )

		}
		wait local.loopwaittime	//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene7_mgspawndetector1_control
end

//============================================================//

scene7_mgspawn1_detect_death:
	self waittill death
	level.scene7_mgspawn1_currentalive --	//decrement the population count
end

//============================================================//

scene7_mgspawn1_ai_navigate1:
	self exec global/disable_ai.scr
	wait level.scene7_mgspawn1_loopwaittime

	if !(isAlive self){ end }

	self exec global/runto.scr $scene7_mg1_gunner_path
	self waittill movedone
	if !(isAlive self){ end }

	//===Set properties of machinegunner
	self type_idle machinegunner
	self type_attack machinegunner
	self type_disguise machinegunner
	self type_grenade machinegunner
	//self holster
	self health 100
	self turret $scene7_mg1
	self.flags["coopMG42_gunner"] = 1 //chrissstrahl - fix anim/attack.scr issue with ai having no weapon after exit of turret
	self exec global/enable_ai.scr

	//===Activate targeting computer for machine gun - guy doesn't actually do anything
	thread scene7_mgspawn_targeting $scene7_mg1 3800//4000//3488
end

//============================================================//

scene7_mgspawn1_terminate:
	level.scene7_mgspawn1_deactivator = 1
end

//===============================================================================================================================//

scene7_mgspawner2_initialize:
	level.scene7_mgspawn2_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene7_mgspawn2_teamlimitmax = 3	//initializes constant for total number allowed to spawn
	level.scene7_mgspawn2_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene7_mgspawn2_currentalivemax = 1	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene7_mgspawn2_loopwaittime = 6	//initializes constant for time between respawns
	level.scene7_mgspawn2_deactivator = 0	//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene7_mgspawndetector2_control
end

//============================================================//

scene7_mgspawndetector2_control:
	if (level.scene7_mgspawn2_deactivator == 1){ end }

	local.loopwaittime = 0.5//2	//original 0.2

	while (exec coop_mod/replace.scr::istouching $scene7_mgspawndetector2){ //chrissstrahl - coop
		if ((level.scene7_mgspawn2_currentalive + 1) <= level.scene7_mgspawn2_currentalivemax && level.scene7_mgspawn2_deactivator == 0 && level.scene7_mgspawn2_teamvalue < level.scene7_mgspawn2_teamlimitmax){
//			centerprint(level.scene7_mgspawn2_currentalive + "<" + level.scene7_mgspawn2_currentalivemax + "\n" + level.scene7_mgspawn2_deactivator + "=" + level.scene7_mgspawn2_deactivator+ "\n" + level.scene7_mgspawn2_teamvalue + "<" + level.scene7_mgspawn2_teamlimitmax )

			local.scene7_mgspawn2_ai_name1 = "scene7_mgspawn2_ai1_" + level.scene7_mgspawn2_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene7_mgspawndetector2_spawner1.origin						//spawn location as a script_origin

		//===Spawn 1 enemy gunner

			spawn models/human/german_panzer_grenadier "targetname" (local.scene7_mgspawn2_ai_name1) "type_attack" "cover"
			$(local.scene7_mgspawn2_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene7_mgspawn2_currentalive ++						//increment the max allowed alive at any given time
			level.scene7_mgspawn2_teamvalue ++							//track the scene's enemy population
			$(local.scene7_mgspawn2_ai_name1) thread scene7_mgspawn2_detect_death 	//call a waittill death thread
			$(local.scene7_mgspawn2_ai_name1) thread scene7_mgspawn2_ai_navigate1 	//call navigation thread

//			centerprint(level.scene7_mgspawn2_currentalive + "<" + level.scene7_mgspawn2_currentalivemax + "\n" + level.scene7_mgspawn2_deactivator + "=" + level.scene7_mgspawn2_deactivator+ "\n" + level.scene7_mgspawn2_teamvalue + "<" + level.scene7_mgspawn2_teamlimitmax )

		}
		wait local.loopwaittime	//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene7_mgspawndetector2_control
end

//============================================================//

scene7_mgspawn2_detect_death:
	self waittill death
	level.scene7_mgspawn2_currentalive --	//decrement the population count
end

//============================================================//

scene7_mgspawn2_ai_navigate1:
	self exec global/disable_ai.scr
	wait level.scene7_mgspawn2_loopwaittime

	if !(isAlive self){ end }

	self exec global/runto.scr $scene7_mg2_gunner_path
	self waittill movedone

	if !(isAlive self){ end }
	self turnto $scene7_mg2
	wait 1

	if !(isAlive self){ end }

	//===Set properties of machinegunner
	self type_idle machinegunner
	self type_attack machinegunner
	self type_disguise machinegunner
	self type_grenade machinegunner
	//self holster
	self health 100
	self turret $scene7_mg2
	self.flags["coopMG42_gunner"] = 1 //chrissstrahl - fix anim/attack.scr issue with ai having no weapon after exit of turret
	self exec global/enable_ai.scr

	//===Activate targeting computer for machine gun - guy doesn't actually do anything
	thread scene7_mgspawn_targeting $scene7_mg2 5400//4800
end

//============================================================//

scene7_mgspawn2_terminate:
	level.scene7_mgspawn2_deactivator = 1
end

//===============================================================================================================================//

scene7_mgspawner3_initialize:
	level.scene7_mgspawn3_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene7_mgspawn3_teamlimitmax = 3	//initializes constant for total number allowed to spawn
	level.scene7_mgspawn3_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene7_mgspawn3_currentalivemax = 1	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene7_mgspawn3_loopwaittime = 5	//initializes constant for time between respawns
	level.scene7_mgspawn3_deactivator = 0	//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene7_mgspawndetector3_control
end

//============================================================//

scene7_mgspawndetector3_control:

	if (level.scene7_mgspawn3_deactivator == 1){ end }

	local.loopwaittime = 0.5 //2	//original 0.2

	while (exec coop_mod/replace.scr::istouching $scene7_mgspawndetector3){ //chrissstrahl - coop
		if ((level.scene7_mgspawn3_currentalive + 1) <= level.scene7_mgspawn3_currentalivemax && level.scene7_mgspawn3_deactivator == 0 && level.scene7_mgspawn3_teamvalue < level.scene7_mgspawn3_teamlimitmax){
//			centerprint(level.scene7_mgspawn3_currentalive + "<" + level.scene7_mgspawn3_currentalivemax + "\n" + level.scene7_mgspawn3_deactivator + "=" + level.scene7_mgspawn3_deactivator+ "\n" + level.scene7_mgspawn3_teamvalue + "<" + level.scene7_mgspawn3_teamlimitmax )

			local.scene7_mgspawn3_ai_name1 = "scene7_mgspawn3_ai1_" + level.scene7_mgspawn3_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene7_mgspawndetector3_spawner1.origin						//spawn location as a script_origin

		//===Spawn 1 enemy gunner

			spawn models/human/german_panzer_grenadier "targetname" (local.scene7_mgspawn3_ai_name1) "type_attack" "cover"
			$(local.scene7_mgspawn3_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene7_mgspawn3_currentalive ++						//increment the max allowed alive at any given time
			level.scene7_mgspawn3_teamvalue ++							//track the scene's enemy population
			$(local.scene7_mgspawn3_ai_name1) thread scene7_mgspawn3_detect_death 	//call a waittill death thread
			$(local.scene7_mgspawn3_ai_name1) thread scene7_mgspawn3_ai_navigate1 	//call navigation thread
//			centerprint(level.scene7_mgspawn3_currentalive + "<" + level.scene7_mgspawn3_currentalivemax + "\n" + level.scene7_mgspawn3_deactivator + "=" + level.scene7_mgspawn3_deactivator+ "\n" + level.scene7_mgspawn3_teamvalue + "<" + level.scene7_mgspawn3_teamlimitmax )
		}
		wait local.loopwaittime	//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene7_mgspawndetector3_control
end

//============================================================//

scene7_mgspawn3_detect_death:
	self waittill death
	level.scene7_mgspawn3_currentalive --	//decrement the population count
end

//============================================================//

scene7_mgspawn3_ai_navigate1:
	self exec global/disable_ai.scr
	wait level.scene7_mgspawn3_loopwaittime

	if !(isAlive self){ end }

	self exec global/runto.scr $scene7_mg3_gunner_path
	self waittill movedone
	if !(isAlive self){ end }
	self turnto $scene7_mg3
	wait 1

	//===Set properties of machinegunner
	self type_idle machinegunner
	self type_attack machinegunner
	self type_disguise machinegunner
	self type_grenade machinegunner
	//self holster
	self health 100
	self turret $scene7_mg3
	self.flags["coopMG42_gunner"] = 1 //chrissstrahl - fix anim/attack.scr issue with ai having no weapon after exit of turret
	self exec global/enable_ai.scr

	//===Activate targeting computer for machine gun - guy doesn't actually do anything
	thread scene7_mgspawn_targeting $scene7_mg3 5400//4860
end

//============================================================//

scene7_mgspawn3_terminate:
	level.scene7_mgspawn3_deactivator = 1
end

//===============================================================================================================================//

scene7_mgspawner4_initialize:
	level.scene7_mgspawn4_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene7_mgspawn4_teamlimitmax = 2	//initializes constant for total number allowed to spawn
	level.scene7_mgspawn4_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene7_mgspawn4_currentalivemax = 1	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene7_mgspawn4_loopwaittime = 5	//initializes constant for time between respawns
	level.scene7_mgspawn4_deactivator = 0	//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene7_mgspawndetector4_control
end

//============================================================//

scene7_mgspawndetector4_control:
	if (level.scene7_mgspawn4_deactivator == 1){ end }

	local.loopwaittime = 0.5	//2	//original 0.2

	while (exec coop_mod/replace.scr::istouching $scene7_mgspawndetector4){ //chrissstrahl - coop
		if ((level.scene7_mgspawn4_currentalive + 1) <= level.scene7_mgspawn4_currentalivemax && level.scene7_mgspawn4_deactivator == 0 && level.scene7_mgspawn4_teamvalue < level.scene7_mgspawn4_teamlimitmax){
//			centerprint(level.scene7_mgspawn4_currentalive + "<" + level.scene7_mgspawn4_currentalivemax + "\n" + level.scene7_mgspawn4_deactivator + "=" + level.scene7_mgspawn4_deactivator+ "\n" + level.scene7_mgspawn4_teamvalue + "<" + level.scene7_mgspawn4_teamlimitmax )

			local.scene7_mgspawn4_ai_name1 = "scene7_mgspawn4_ai1_" + level.scene7_mgspawn4_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene7_mgspawndetector4_spawner1.origin						//spawn location as a script_origin

		//===Spawn 1 enemy gunner

			spawn models/human/german_panzer_grenadier "targetname" (local.scene7_mgspawn4_ai_name1) "type_attack" "cover"

			$(local.scene7_mgspawn4_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene7_mgspawn4_currentalive ++						//increment the max allowed alive at any given time
			level.scene7_mgspawn4_teamvalue ++							//track the scene's enemy population
			$(local.scene7_mgspawn4_ai_name1) thread scene7_mgspawn4_detect_death 	//call a waittill death thread
			$(local.scene7_mgspawn4_ai_name1) thread scene7_mgspawn4_ai_navigate1 	//call navigation thread
//			centerprint(level.scene7_mgspawn4_currentalive + "<" + level.scene7_mgspawn4_currentalivemax + "\n" + level.scene7_mgspawn4_deactivator + "=" + level.scene7_mgspawn4_deactivator+ "\n" + level.scene7_mgspawn4_teamvalue + "<" + level.scene7_mgspawn4_teamlimitmax )
		}
		wait local.loopwaittime	//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene7_mgspawndetector4_control
end

//============================================================//

scene7_mgspawn4_detect_death:
	self waittill death
	level.scene7_mgspawn4_currentalive --	//decrement the population count
end

//============================================================//

scene7_mgspawn4_ai_navigate1:
	self exec global/disable_ai.scr
	wait level.scene7_mgspawn4_loopwaittime

	if !(isAlive self){ end }
	
	self exec global/runto.scr $scene7_mg4_gunner_path
	self waittill movedone
	if !(isAlive self){ end }

	//===Set properties of machinegunner
	self type_idle machinegunner
	self type_attack machinegunner
	self type_disguise machinegunner
	self type_grenade machinegunner
	self holster
	self health 100
	self turret $scene7_mg4
	self.flags["coopMG42_gunner"] = 1 //chrissstrahl - fix anim/attack.scr issue with ai having no weapon after exit of turret
	self exec global/enable_ai.scr

	//===Activate targeting computer for machine gun - guy doesn't actually do anything
	thread scene7_mgspawn_targeting $scene7_mg4 5000//4280
end

//============================================================//

scene7_mgspawn4_terminate:
	level.scene7_mgspawn4_deactivator = 1
end

//===============================================================================================================================//

scene7_mgspawner5_initialize:
	level.scene7_mgspawn5_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene7_mgspawn5_teamlimitmax = 1	//initializes constant for total number allowed to spawn
	level.scene7_mgspawn5_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene7_mgspawn5_currentalivemax = 1	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene7_mgspawn5_loopwaittime = 5	//initializes constant for time between respawns
	level.scene7_mgspawn5_deactivator = 0	//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene7_mgspawndetector5_control
end

//============================================================//

scene7_mgspawndetector5_control:
	if (level.scene7_mgspawn5_deactivator == 1){ end }

	local.loopwaittime = 2	//original 0.2
	
	while (exec coop_mod/replace.scr::istouching $scene7_mgspawndetector5){ //chrissstrahl - coop
		if ((level.scene7_mgspawn5_currentalive + 1) <= level.scene7_mgspawn5_currentalivemax && level.scene7_mgspawn5_deactivator == 0 && level.scene7_mgspawn5_teamvalue < level.scene7_mgspawn5_teamlimitmax){
//			centerprint(level.scene7_mgspawn5_currentalive + "<" + level.scene7_mgspawn5_currentalivemax + "\n" + level.scene7_mgspawn5_deactivator + "=" + level.scene7_mgspawn5_deactivator+ "\n" + level.scene7_mgspawn5_teamvalue + "<" + level.scene7_mgspawn5_teamlimitmax )

			local.scene7_mgspawn5_ai_name1 = "scene7_mgspawn5_ai1_" + level.scene7_mgspawn5_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene7_mgspawndetector5_spawner1.origin						//spawn location as a script_origin

		//===Spawn 1 enemy gunner

			spawn models/human/german_panzer_grenadier "targetname" (local.scene7_mgspawn5_ai_name1) "type_attack" "cover"

			$(local.scene7_mgspawn5_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene7_mgspawn5_currentalive ++						//increment the max allowed alive at any given time
			level.scene7_mgspawn5_teamvalue ++							//track the scene's enemy population
			$(local.scene7_mgspawn5_ai_name1) thread scene7_mgspawn5_detect_death 	//call a waittill death thread
			$(local.scene7_mgspawn5_ai_name1) thread scene7_mgspawn5_ai_navigate1 	//call navigation thread

//			centerprint(level.scene7_mgspawn5_currentalive + "<" + level.scene7_mgspawn5_currentalivemax + "\n" + level.scene7_mgspawn5_deactivator + "=" + level.scene7_mgspawn5_deactivator+ "\n" + level.scene7_mgspawn5_teamvalue + "<" + level.scene7_mgspawn5_teamlimitmax )
		}
		wait local.loopwaittime	//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene7_mgspawndetector5_control
end

//============================================================//

scene7_mgspawn5_detect_death:
	self waittill death
	level.scene7_mgspawn5_currentalive --	//decrement the population count
end

//============================================================//

scene7_mgspawn5_ai_navigate1:
	self exec global/disable_ai.scr
	wait level.scene7_mgspawn5_loopwaittime

	if !(isAlive self){ end }

	self exec global/runto.scr $scene7_mg5_gunner_path
	self waittill movedone
	if !(isAlive self){ end }

	//===Set properties of machinegunner
	self type_idle machinegunner
	self type_attack machinegunner
	self type_disguise machinegunner
	self type_grenade machinegunner
	self holster
	self health 100
	self turret $scene7_mg5
	self.flags["coopMG42_gunner"] = 1 //chrissstrahl - fix anim/attack.scr issue with ai having no weapon after exit of turret
	self exec global/enable_ai.scr

	//===Activate targeting computer for machine gun - guy doesn't actually do anything
	thread scene7_mgspawn_targeting $scene7_mg5 4800//4280
end

//============================================================//

scene7_mgspawn5_terminate:
	level.scene7_mgspawn5_deactivator = 1
end

//============================================================//

scene7_mgspawn_targeting local.machinegun local.effrange:
	waitframe
	
	local.machinegun burstFireSettings 0.5 1 0.25 0.5
	local.machinegun maxyawoffset 45
	local.machinegun bulletdamage 20
	local.machinegun tracerfrequency 3
	print local.effrange

	//wait 0.5

	while (isAlive self){
		local.player = NULL //chrissstrahl - coop
		while (local.player == NULL && (isAlive self)){ //chrissstrahl - coop
			wait 0.5
			local.player = self exec coop_mod/replace.scr::canseeGetClosest 0 local.effrange //chrissstrahl - coop
		}
		
		if( level.gametype == 0 ){ //chrissstrahl - sp only
			local.machinegun setaimtarget $playertarget_front1
			local.machinegun startfiring
			wait 4.2	//original 3.2
			local.machinegun setaimtarget $playertarget_front2
			wait 3.5	//original 2.5
		}

		local.player = self exec coop_mod/replace.scr::canseeGetClosest 0 local.effrange //chrissstrahl - coop
		while(local.player == NULL){ //chrissstrahl - wait until a valid player is there
			wait 0.25
			local.player = self exec coop_mod/replace.scr::canseeGetClosest 0 local.effrange //chrissstrahl - coop
		}
		
		local.machinegun setaimtarget local.player //chrissstrahl - coop

		if(level.gametype == 0 ){ //chrissstrahl - sp
			if (level.skill == "0"){
				local.machinegun bulletdamage 15
				wait 2			
			}else if (level.skill == "1"){
				local.machinegun bulletdamage 25
				wait 3
			}else if (level.skill == "2"){
				local.machinegun bulletdamage 50
				wait 4
			}			
		}else{ //chrissstrahl - coop
			local.machinegun bulletdamage 50
			wait 2
		}
		local.machinegun stopfiring

		if (isAlive level.ramsey && self cansee level.ramsey){
			local.machinegun setaimtarget level.ramsey
			local.machinegun startfiring
			wait 1
			local.machinegun stopfiring
		}

		if (isAlive level.tomlin && self cansee level.tomlin){
			local.machinegun setaimtarget level.tomlin
			local.machinegun startfiring
			wait 3
			local.machinegun stopfiring
		}

		if (isAlive level.harrison && self cansee level.harrison){
			local.machinegun setaimtarget level.harrison
			local.machinegun startfiring
			wait 3
			local.machinegun stopfiring
		}

		wait 0.5	//gives the player a few free seconds to get to cover in case AI buddies are dead original 6
	}

end

//===============================================================================================================================//

scene7_nebelwerfer_initialize:
	level.scene7_neb1_deactivator = 0
	level.scene7_neb2_deactivator = 0
	level.scene7_neb3_deactivator = 0
	level.scene7_neb4_deactivator = 0
end

//===============================================================================================================================//

scene7_nebelwerfer1_control:
	while (!(exec coop_mod/replace.scr::istouching $scene7_neb1_detector)){ //chrissstrahl - coop
		wait 1
	}

	if (level.scene7_neb1_deactivator == 1)
			end

	for (local.rocketnum = 1; local.rocketnum <= 6; local.rocketnum ++){
		local.tubename = $("scene7_neb1_tube" + local.rocketnum)
		local.pathname = $("scene7_neb1_path" + local.rocketnum)
		local.damagename = $("scene7_neb1_damage" + local.rocketnum)
		thread scene7_nebelwerfer_launch local.rocketnum local.tubename local.pathname local.damagename
		wait 0.2
	}

	wait 20
	goto scene7_nebelwerfer1_control
end

//============================================================//

scene7_nebelwerfer2_control:
	while (!(exec coop_mod/replace.scr::istouching $scene7_neb2_detector)){ //chrissstrahl - coop
		wait 1
	}

	if (level.scene7_neb2_deactivator == 1)
			end

	for (local.rocketnum = 1; local.rocketnum <= 6; local.rocketnum ++){
		local.tubename = $("scene7_neb2_tube" + local.rocketnum)
		local.pathname = $("scene7_neb2_path" + local.rocketnum)
		local.damagename = $("scene7_neb2_damage" + local.rocketnum)
		thread scene7_nebelwerfer_launch local.rocketnum local.tubename local.pathname local.damagename
		wait 0.2
	}

	wait 20
	goto scene7_nebelwerfer2_control
end

//============================================================//

scene7_nebelwerfer3_control:

	while (!(exec coop_mod/replace.scr::istouching $scene7_neb3_detector)){ //chrissstrahl - coop
		wait 1
	}

	if (level.scene7_neb3_deactivator == 1)
			end

	for (local.rocketnum = 1; local.rocketnum <= 6; local.rocketnum ++){
		local.tubename = $("scene7_neb3_tube" + local.rocketnum)
		local.pathname = $("scene7_neb3_path" + local.rocketnum)
		local.damagename = $("scene7_neb3_damage" + local.rocketnum)
		thread scene7_nebelwerfer_launch local.rocketnum local.tubename local.pathname local.damagename
		wait 0.2
	}

	wait 20
	goto scene7_nebelwerfer3_control

end

//============================================================//

scene7_nebelwerfer4_control:

	while (!(exec coop_mod/replace.scr::istouching $scene7_neb4_detector)){ //chrissstrahl - coop
		wait 1
	}

	if (level.scene7_neb4_deactivator == 1)
			end

	for (local.rocketnum = 1; local.rocketnum <= 6; local.rocketnum ++){
		local.tubename = $("scene7_neb4_tube" + local.rocketnum)
		local.pathname = $("scene7_neb4_path" + local.rocketnum)
		local.damagename = $("scene7_neb4_damage" + local.rocketnum)
		thread scene7_nebelwerfer_launch local.rocketnum local.tubename local.pathname local.damagename
		wait 0.2
	}

	wait 20
	goto scene7_nebelwerfer4_control

end

//============================================================//

scene7_nebelwerfer_launch local.rocketnum local.tubename local.pathname local.damagename:
	local.rocket = spawn models/fx/fx_nebelwerfer.tik
	local.tubename playsound nebelwerfer_launch
	local.rocket.origin = local.tubename.origin
	local.rocket glue local.tubename
	local.tubename flypath local.pathname 4500 2000
	local.tubename waitmove
	local.rocket remove

	//===Dirt impact visual effect spawned and animated
//	local.blastname = spawn models/emitters/mortar_dirt.tik
	local.blastname = spawn models/emitters/mortar_dirt_nebelwerfer.tik
	local.blastname.origin = local.tubename.origin
	local.blastname anim start

	//===Shake the player's view hard
	exec global/earthquake.scr .03 .05 0 0	//original .13 2 0 0

	//===Radius damage projected from impact point at end of waypoint path
	if(level.gametype == 0){ //chrissstrahl - sp
		if (level.skill == "0"){
			local.damageamount = 260	
			local.damageradius = 650	
		}else if (level.skill == "1"){
			local.damageamount = 360	
			local.damageradius = 650	
		}else if (level.skill == "2"){
			local.damageamount = 460	
			local.damageradius = 650	
		}
	}else{ //chrissstrahl - coop
		local.damageamount = 460	
		local.damageradius = 650	
	}
	radiusdamage local.damagename.origin local.damageamount local.damageradius
	wait 3

	//===Remove the effect
	local.blastname remove

	//===Move effect transporter back to the beginning of the path for another run
	local.tubename.origin = local.pathname.origin
end

//============================================================//

scene7_neb1_terminate:
	level.scene7_neb1_deactivator = 1
end

//============================================================//

scene7_neb2_terminate:
	level.scene7_neb2_deactivator = 1
end

//============================================================//

scene7_neb3_terminate:
	level.scene7_neb3_deactivator = 1
end

//============================================================//

scene7_neb4_terminate:
	level.scene7_neb4_deactivator = 1
end

//============================================================//

scene7_minefields:
	thread global/minefield.scr::minefield_setup
end

//============================================================//

scene7_spawner1_initialize:
	level.scene7_spawn1_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene7_spawn1_teamlimitmax = 10	//initializes constant for total number allowed to spawn
	level.scene7_spawn1_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene7_spawn1_currentalivemax = 3	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene7_spawn1_loopwaittime = 1	//initializes constant for time between respawns
	level.scene7_spawn1_deactivator = 0		//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene7_spawndetector1_control
end

//============================================================//

scene7_spawndetector1_control:
	local.loopwaittime = 4	//original 0.2

	while (exec coop_mod/replace.scr::istouching $scene7_spawndetector1){ //chrissstrahl - coop
		//===3 at a time, use +3
		//===Crazy fire and maneuver enemy attack, use nothing

		if ((level.scene7_spawn1_currentalive + level.scene7_spawn1_currentalivemax) <= level.scene7_spawn1_currentalivemax && level.scene7_spawn1_deactivator == 0 && level.scene7_spawn1_teamvalue < level.scene7_spawn1_teamlimitmax)
//		if ((level.scene7_spawn1_currentalive) <= level.scene7_spawn1_currentalivemax && level.scene7_spawn1_deactivator == 0 && level.scene7_spawn1_teamvalue < level.scene7_spawn1_teamlimitmax)

		{
//			centerprint(level.scene7_spawn1_currentalive + "<" + level.scene7_spawn1_currentalivemax + "\n" + level.scene7_spawn1_deactivator + "=" + level.scene7_spawn1_deactivator+ "\n" + level.scene7_spawn1_teamvalue + "<" + level.scene7_spawn1_teamlimitmax )

			local.scene7_spawn1_ai_name1 = "scene7_spawn1_ai1_" + level.scene7_spawn1_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene7_spawndetector1_spawner1.origin						//spawn location as a script_origin

			local.scene7_spawn1_ai_name2 = "scene7_spawn1_ai2_" + level.scene7_spawn1_teamvalue
			local.org2 = $scene7_spawndetector1_spawner2.origin

			local.scene7_spawn1_ai_name3 = "scene7_spawn1_ai3_" + level.scene7_spawn1_teamvalue
			local.org3 = $scene7_spawndetector1_spawner3.origin

		//===Spawn 3 enemy soldiers in a wave
			spawn models/human/german_panzer_shutze "targetname" (local.scene7_spawn1_ai_name1) "type_attack" "cover"
			$(local.scene7_spawn1_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene7_spawn1_currentalive ++							//increment the max allowed alive at any given time
			level.scene7_spawn1_teamvalue ++							//track the scene's enemy population
			$(local.scene7_spawn1_ai_name1) thread scene7_spawn1_detect_death 	//call a waittill death thread
			$(local.scene7_spawn1_ai_name1) thread scene7_spawn1_ai_navigate1 	//call navigation thread
			$(local.scene7_spawn1_ai_name1).mindist = 128
			$(local.scene7_spawn1_ai_name1).maxdist = 4000
			$(local.scene7_spawn1_ai_name1).leash = 2400
			$(local.scene7_spawn1_ai_name1).fixedleash = 0
			$(local.scene7_spawn1_ai_name1).sight = 2400
			$(local.scene7_spawn1_ai_name1).noticescale = 50
			$(local.scene7_spawn1_ai_name1).hearing = 4000
			$(local.scene7_spawn1_ai_name1).interval = 128
			$(local.scene7_spawn1_ai_name1) dontdropweapons
			$(local.scene7_spawn1_ai_name1) exec maps/m3l3/coopified.scr::ai_accuracy 15 40 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_waffenss_nco "targetname" (local.scene7_spawn1_ai_name2) "type_attack" "cover"
			$(local.scene7_spawn1_ai_name2).origin = local.org2				//place the guy in the correct spot
			level.scene7_spawn1_currentalive ++							//increment the max allowed alive at any given time
			level.scene7_spawn1_teamvalue ++
			$(local.scene7_spawn1_ai_name2) thread scene7_spawn1_detect_death 	//call a waittill death thread
			$(local.scene7_spawn1_ai_name2) thread scene7_spawn1_ai_navigate2 	//call navigation thread
			$(local.scene7_spawn1_ai_name2) gun "mp40"
			$(local.scene7_spawn1_ai_name2).mindist = 128
			$(local.scene7_spawn1_ai_name2).maxdist = 2400
			$(local.scene7_spawn1_ai_name2).leash = 2400
			$(local.scene7_spawn1_ai_name2).fixedleash = 0
			$(local.scene7_spawn1_ai_name2).sight = 2000
			$(local.scene7_spawn1_ai_name2).noticescale = 50
			$(local.scene7_spawn1_ai_name2).hearing = 4000
			$(local.scene7_spawn1_ai_name2).interval = 128
			$(local.scene7_spawn1_ai_name2) dontdropweapons
			$(local.scene7_spawn1_ai_name2) exec maps/m3l3/coopified.scr::ai_accuracy 15 30 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_panzer_shutze "targetname" (local.scene7_spawn1_ai_name3) "type_attack" "cover"
			$(local.scene7_spawn1_ai_name3).origin = local.org3				//place the guy in the correct spot
			level.scene7_spawn1_currentalive ++							//increment the max allowed alive at any given time
			level.scene7_spawn1_teamvalue ++
			$(local.scene7_spawn1_ai_name3) thread scene7_spawn1_detect_death 	//call a waittill death thread
			$(local.scene7_spawn1_ai_name3) thread scene7_spawn1_ai_navigate3  	//call navigation thread
			$(local.scene7_spawn1_ai_name3).mindist = 128
			$(local.scene7_spawn1_ai_name3).maxdist = 2400
			$(local.scene7_spawn1_ai_name3).leash = 2400
			$(local.scene7_spawn1_ai_name3).fixedleash = 0
			$(local.scene7_spawn1_ai_name3).sight = 2400
			$(local.scene7_spawn1_ai_name3).noticescale = 50
			$(local.scene7_spawn1_ai_name3).hearing = 4000
			$(local.scene7_spawn1_ai_name3).interval = 128
			$(local.scene7_spawn1_ai_name3) dontdropweapons
			$(local.scene7_spawn1_ai_name3) exec maps/m3l3/coopified.scr::ai_accuracy 25 45 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
//			centerprint(level.scene7_spawn1_currentalive + "<" + level.scene7_spawn1_currentalivemax + "\n" + level.scene7_spawn1_deactivator + "=" + level.scene7_spawn1_deactivator+ "\n" + level.scene7_spawn1_teamvalue + "<" + level.scene7_spawn1_teamlimitmax )
		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene7_spawndetector1_control
end

//============================================================//

scene7_spawn1_detect_death:
	self waittill death
	level.scene7_spawn1_currentalive --	//decrement the population count
end

//============================================================//

scene7_spawn1_ai_navigate1:
	self exec global/runto.scr $scene7_spawn1_rallypoint1
end

//============================================================//

scene7_spawn1_ai_navigate2:
	self exec global/runto.scr $scene7_spawn1_rallypoint2
end

//============================================================//

scene7_spawn1_ai_navigate3:
	self exec global/runto.scr $scene7_spawn1_rallypoint3
end

//============================================================//

scene7_spawn1_terminate:
	level.scene7_spawn1_deactivator = 1
end

//============================================================//

scene7_spawner2_initialize:
	level.scene7_spawn2_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene7_spawn2_teamlimitmax = 6	//initializes constant for total number allowed to spawn
	level.scene7_spawn2_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene7_spawn2_currentalivemax = 3	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene7_spawn2_loopwaittime = 1	//initializes constant for time between respawns
	level.scene7_spawn2_deactivator = 0		//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene7_spawndetector2_control
end

//============================================================//

scene7_spawndetector2_control:

	local.loopwaittime = 4	//original 0.2

	while (exec coop_mod/replace.scr::istouching $scene7_spawndetector2){ //chrissstrahl - coop
		//===3 at a time, use +3
		//===Crazy fire and maneuver enemy attack, use nothing

		if ((level.scene7_spawn2_currentalive + level.scene7_spawn2_currentalivemax) <= level.scene7_spawn2_currentalivemax && level.scene7_spawn2_deactivator == 0 && level.scene7_spawn2_teamvalue < level.scene7_spawn2_teamlimitmax)
//		if ((level.scene7_spawn2_currentalive) <= level.scene7_spawn2_currentalivemax && level.scene7_spawn2_deactivator == 0 && level.scene7_spawn2_teamvalue < level.scene7_spawn2_teamlimitmax)

		{
//			centerprint(level.scene7_spawn2_currentalive + "<" + level.scene7_spawn2_currentalivemax + "\n" + level.scene7_spawn2_deactivator + "=" + level.scene7_spawn2_deactivator+ "\n" + level.scene7_spawn2_teamvalue + "<" + level.scene7_spawn2_teamlimitmax )

			local.scene7_spawn2_ai_name1 = "scene7_spawn2_ai1_" + level.scene7_spawn2_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene7_spawndetector2_spawner1.origin						//spawn location as a script_origin

			local.scene7_spawn2_ai_name2 = "scene7_spawn2_ai2_" + level.scene7_spawn2_teamvalue
			local.org2 = $scene7_spawndetector2_spawner2.origin

			local.scene7_spawn2_ai_name3 = "scene7_spawn2_ai3_" + level.scene7_spawn2_teamvalue
			local.org3 = $scene7_spawndetector2_spawner3.origin

		//===Spawn 3 enemy soldiers in a wave

			spawn models/human/german_panzer_shutze "targetname" (local.scene7_spawn2_ai_name1) "type_attack" "cover"
			$(local.scene7_spawn2_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene7_spawn2_currentalive ++							//increment the max allowed alive at any given time
			level.scene7_spawn2_teamvalue ++							//track the scene's enemy population
			$(local.scene7_spawn2_ai_name1) thread scene7_spawn2_detect_death 	//call a waittill death thread
			$(local.scene7_spawn2_ai_name1) thread scene7_spawn2_ai_navigate1 	//call navigation thread
			$(local.scene7_spawn2_ai_name1).mindist = 128
			$(local.scene7_spawn2_ai_name1).maxdist = 4000
			$(local.scene7_spawn2_ai_name1).leash = 2400
			$(local.scene7_spawn2_ai_name1).fixedleash = 0
			$(local.scene7_spawn2_ai_name1).sight = 2400
			$(local.scene7_spawn2_ai_name1).noticescale = 50
			$(local.scene7_spawn2_ai_name1).hearing = 4000
			$(local.scene7_spawn2_ai_name1).interval = 128
			$(local.scene7_spawn2_ai_name1) dontdropweapons
			$(local.scene7_spawn2_ai_name1) exec maps/m3l3/coopified.scr::ai_accuracy 25 40 60 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_waffenss_nco "targetname" (local.scene7_spawn2_ai_name2) "type_attack" "cover"
			$(local.scene7_spawn2_ai_name2).origin = local.org2				//place the guy in the correct spot
			level.scene7_spawn2_currentalive ++							//increment the max allowed alive at any given time
			level.scene7_spawn2_teamvalue ++
			$(local.scene7_spawn2_ai_name2) thread scene7_spawn2_detect_death 	//call a waittill death thread
			$(local.scene7_spawn2_ai_name2) thread scene7_spawn2_ai_navigate2 	//call navigation thread
			$(local.scene7_spawn2_ai_name2) gun "mp40"
			$(local.scene7_spawn2_ai_name2).mindist = 128
			$(local.scene7_spawn2_ai_name2).maxdist = 2400
			$(local.scene7_spawn2_ai_name2).leash = 2400
			$(local.scene7_spawn2_ai_name2).fixedleash = 0
			$(local.scene7_spawn2_ai_name2).sight = 2000
			$(local.scene7_spawn2_ai_name2).noticescale = 50
			$(local.scene7_spawn2_ai_name2).hearing = 4000
			$(local.scene7_spawn2_ai_name2).interval = 128
			$(local.scene7_spawn2_ai_name2) dontdropweapons
			$(local.scene7_spawn2_ai_name2) exec maps/m3l3/coopified.scr::ai_accuracy 25 40 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_panzer_shutze "targetname" (local.scene7_spawn2_ai_name3) "type_attack" "cover"
			$(local.scene7_spawn2_ai_name3).origin = local.org3				//place the guy in the correct spot
			level.scene7_spawn2_currentalive ++							//increment the max allowed alive at any given time
			level.scene7_spawn2_teamvalue ++
			$(local.scene7_spawn2_ai_name3) thread scene7_spawn2_detect_death 	//call a waittill death thread
			$(local.scene7_spawn2_ai_name3) thread scene7_spawn2_ai_navigate3  	//call navigation thread
			$(local.scene7_spawn2_ai_name3).mindist = 128
			$(local.scene7_spawn2_ai_name3).maxdist = 2400
			$(local.scene7_spawn2_ai_name3).leash = 2400
			$(local.scene7_spawn2_ai_name3).fixedleash = 0
			$(local.scene7_spawn2_ai_name3).sight = 2400
			$(local.scene7_spawn2_ai_name3).noticescale = 50
			$(local.scene7_spawn2_ai_name3).hearing = 4000
			$(local.scene7_spawn2_ai_name3).interval = 128
			$(local.scene7_spawn2_ai_name3) dontdropweapons
			$(local.scene7_spawn2_ai_name3) exec maps/m3l3/coopified.scr::ai_accuracy 25 40 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

//			centerprint(level.scene7_spawn2_currentalive + "<" + level.scene7_spawn2_currentalivemax + "\n" + level.scene7_spawn2_deactivator + "=" + level.scene7_spawn2_deactivator+ "\n" + level.scene7_spawn2_teamvalue + "<" + level.scene7_spawn2_teamlimitmax )

		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene7_spawndetector2_control
end

//============================================================//

scene7_spawn2_detect_death:
	self waittill death
	level.scene7_spawn2_currentalive --	//decrement the population count
end

//============================================================//

scene7_spawn2_ai_navigate1:
	self exec global/runto.scr $scene7_spawn2_rallypoint1
end

//============================================================//

scene7_spawn2_ai_navigate2:
	self exec global/runto.scr $scene7_spawn2_rallypoint2
end

//============================================================//

scene7_spawn2_ai_navigate3:
	self exec global/runto.scr $scene7_spawn2_rallypoint3
end

//============================================================//

scene7_spawn2_terminate:
	level.scene7_spawn2_deactivator = 1
end

//============================================================//

scene7_spawner3_initialize:
	level.scene7_spawn3_teamvalue = 0		//initializes variable for total number spawned to date
	level.scene7_spawn3_teamlimitmax = 6	//initializes constant for total number allowed to spawn
	level.scene7_spawn3_currentalive = 0	//initializes variable for number of enemies currently alive from this spawner
	level.scene7_spawn3_currentalivemax = 3	//initializes constant for maximum number allowed to be alive at any given time from this spawner
	level.scene7_spawn3_loopwaittime = 1	//initializes constant for time between respawns
	level.scene7_spawn3_deactivator = 0		//initializes variable for shutting down this loop's ability to spawn when the player is past this area

	thread scene7_spawndetector3_control
end

//============================================================//

scene7_spawndetector3_control:

	local.loopwaittime = 4	//original 0.2

	while (exec coop_mod/replace.scr::istouching $scene7_spawndetector3){ //chrissstrahl - coop 
		//===3 at a time, use +3
		//===Crazy fire and maneuver enemy attack, use nothing

		if ((level.scene7_spawn3_currentalive + level.scene7_spawn3_currentalivemax) <= level.scene7_spawn3_currentalivemax && level.scene7_spawn3_deactivator == 0 && level.scene7_spawn3_teamvalue < level.scene7_spawn3_teamlimitmax)
//		if ((level.scene7_spawn3_currentalive) <= level.scene7_spawn3_currentalivemax && level.scene7_spawn3_deactivator == 0 && level.scene7_spawn3_teamvalue < level.scene7_spawn3_teamlimitmax)

		{
//			centerprint(level.scene7_spawn3_currentalive + "<" + level.scene7_spawn3_currentalivemax + "\n" + level.scene7_spawn3_deactivator + "=" + level.scene7_spawn3_deactivator+ "\n" + level.scene7_spawn3_teamvalue + "<" + level.scene7_spawn3_teamlimitmax )

			local.scene7_spawn3_ai_name1 = "scene7_spawn3_ai1_" + level.scene7_spawn3_teamvalue	//assign a name to the spawned enemy
			local.org1 = $scene7_spawndetector3_spawner1.origin						//spawn location as a script_origin

			local.scene7_spawn3_ai_name2 = "scene7_spawn3_ai2_" + level.scene7_spawn3_teamvalue
			local.org2 = $scene7_spawndetector3_spawner2.origin

			local.scene7_spawn3_ai_name3 = "scene7_spawn3_ai3_" + level.scene7_spawn3_teamvalue
			local.org3 = $scene7_spawndetector3_spawner3.origin

		//===Spawn 3 enemy soldiers in a wave

			spawn models/human/german_panzer_shutze "targetname" (local.scene7_spawn3_ai_name1) "type_attack" "cover"
			$(local.scene7_spawn3_ai_name1).origin = local.org1				//place the guy in the correct spot
			level.scene7_spawn3_currentalive ++							//increment the max allowed alive at any given time
			level.scene7_spawn3_teamvalue ++							//track the scene's enemy population
			$(local.scene7_spawn3_ai_name1) thread scene7_spawn3_detect_death 	//call a waittill death thread
			$(local.scene7_spawn3_ai_name1) thread scene7_spawn3_ai_navigate1 	//call navigation thread
			$(local.scene7_spawn3_ai_name1).mindist = 128
			$(local.scene7_spawn3_ai_name1).maxdist = 4000
			$(local.scene7_spawn3_ai_name1).leash = 2400
			$(local.scene7_spawn3_ai_name1).fixedleash = 0
			$(local.scene7_spawn3_ai_name1).sight = 2400
			$(local.scene7_spawn3_ai_name1).noticescale = 50
			$(local.scene7_spawn3_ai_name1).hearing = 4000
			$(local.scene7_spawn3_ai_name1).interval = 128
			$(local.scene7_spawn3_ai_name1) dontdropweapons
			$(local.scene7_spawn3_ai_name1) exec maps/m3l3/coopified.scr::ai_accuracy 25 30 60 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_waffenss_nco "targetname" (local.scene7_spawn3_ai_name2) "type_attack" "cover"
			$(local.scene7_spawn3_ai_name2).origin = local.org2				//place the guy in the correct spot
			level.scene7_spawn3_currentalive ++							//increment the max allowed alive at any given time
			level.scene7_spawn3_teamvalue ++
			$(local.scene7_spawn3_ai_name2) thread scene7_spawn3_detect_death 	//call a waittill death thread
			$(local.scene7_spawn3_ai_name2) thread scene7_spawn3_ai_navigate2 	//call navigation thread
			$(local.scene7_spawn3_ai_name2) gun "mp40"
			$(local.scene7_spawn3_ai_name2).mindist = 128
			$(local.scene7_spawn3_ai_name2).maxdist = 2400
			$(local.scene7_spawn3_ai_name2).leash = 2400
			$(local.scene7_spawn3_ai_name2).fixedleash = 0
			$(local.scene7_spawn3_ai_name2).sight = 2000
			$(local.scene7_spawn3_ai_name2).noticescale = 50
			$(local.scene7_spawn3_ai_name2).hearing = 4000
			$(local.scene7_spawn3_ai_name2).interval = 128
			$(local.scene7_spawn3_ai_name2) dontdropweapons
			$(local.scene7_spawn3_ai_name2) exec maps/m3l3/coopified.scr::ai_accuracy 25 40 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			spawn models/human/german_panzer_shutze "targetname" (local.scene7_spawn3_ai_name3) "type_attack" "cover"
			$(local.scene7_spawn3_ai_name3).origin = local.org3				//place the guy in the correct spot
			level.scene7_spawn3_currentalive ++							//increment the max allowed alive at any given time
			level.scene7_spawn3_teamvalue ++
			$(local.scene7_spawn3_ai_name3) thread scene7_spawn3_detect_death 	//call a waittill death thread
			$(local.scene7_spawn3_ai_name3) thread scene7_spawn3_ai_navigate3  	//call navigation thread
			$(local.scene7_spawn3_ai_name3).mindist = 128
			$(local.scene7_spawn3_ai_name3).maxdist = 2400
			$(local.scene7_spawn3_ai_name3).leash = 2400
			$(local.scene7_spawn3_ai_name3).fixedleash = 0
			$(local.scene7_spawn3_ai_name3).sight = 2400
			$(local.scene7_spawn3_ai_name3).noticescale = 50
			$(local.scene7_spawn3_ai_name3).hearing = 4000
			$(local.scene7_spawn3_ai_name3).interval = 128
			$(local.scene7_spawn3_ai_name3) dontdropweapons
			$(local.scene7_spawn3_ai_name3) exec maps/m3l3/coopified.scr::ai_accuracy 25 40 70 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
//			centerprint(level.scene7_spawn3_currentalive + "<" + level.scene7_spawn3_currentalivemax + "\n" + level.scene7_spawn3_deactivator + "=" + level.scene7_spawn3_deactivator+ "\n" + level.scene7_spawn3_teamvalue + "<" + level.scene7_spawn3_teamlimitmax )
		}
		wait local.loopwaittime			//every local.loopwaittime seconds, resume the while loop
	}
	wait local.loopwaittime				//prevent infinite loop warning
	goto scene7_spawndetector3_control
end

//============================================================//

scene7_spawn3_detect_death:
	self waittill death
	level.scene7_spawn3_currentalive --	//decrement the population count
end

//============================================================//

scene7_spawn3_ai_navigate1:
	self exec global/runto.scr $scene7_spawn3_rallypoint1
end

//============================================================//

scene7_spawn3_ai_navigate2:
	self exec global/runto.scr $scene7_spawn3_rallypoint2
end

//============================================================//

scene7_spawn3_ai_navigate3:
	self exec global/runto.scr $scene7_spawn3_rallypoint3
end

//============================================================//

scene7_spawn3_terminate:
	level.scene7_spawn3_deactivator = 1
end

//============================================================//

//===Some final defenders to harass the player as he nears the nebelwerfers

scene7_defender_spawn1:
	//chrissstrahl - okayyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy
	//chrissstrahl - who the fuck would do make a function like this ?
	//chrissstrahl - It is literally begging on its knees to be made with a foor loop
	//chrissstrahl - that entity m3l3 script is horrible like this
	
	local.scene7_finaldefender1 = "scene7_finaldefender1"
	local.scene7_finaldefender2 = "scene7_finaldefender2"
	local.scene7_finaldefender3 = "scene7_finaldefender3"
	local.scene7_finaldefender4 = "scene7_finaldefender4"
	local.scene7_finaldefender5 = "scene7_finaldefender5"
	local.scene7_finaldefender6 = "scene7_finaldefender6"

	spawn models/human/german_waffenss_nco "targetname" (local.scene7_finaldefender1) "type_attack" "cover"
	spawn models/human/german_waffenss_shutze "targetname" (local.scene7_finaldefender2) "type_attack" "cover"
	spawn models/human/german_waffenss_shutze "targetname" (local.scene7_finaldefender3) "type_attack" "cover"
	spawn models/human/german_waffenss_shutze "targetname" (local.scene7_finaldefender4) "type_attack" "cover"
	spawn models/human/german_waffenss_shutze "targetname" (local.scene7_finaldefender5) "type_attack" "cover"
	spawn models/human/german_waffenss_shutze "targetname" (local.scene7_finaldefender6) "type_attack" "cover"	
	$(local.scene7_finaldefender1) gun "MP40"
	$(local.scene7_finaldefender2) gun "Mauser KAR 98K"
	$(local.scene7_finaldefender3) gun "MP40"
	$(local.scene7_finaldefender4) gun "Mauser KAR 98K"
	$(local.scene7_finaldefender5) gun "MP40"
	$(local.scene7_finaldefender6) gun "Mauser KAR 98K"	
	
	for(local.i=1;local.i<=6;local.i++){ //chrissstrahl - compact
		local.ai = $("scene7_finaldefender"+local.i)
		local.ai.noticescale = 1
		local.ai.maxdist = 5000
		local.ai.sight = 5000
		local.ai.hearing = 5000
		local.ai.origin = $("scene7_finaldefender"+local.i+"_spawn").origin
		local.ai forceactivate
		local.ai.ammo_grenade = 2
		local.ai exec maps/m3l3/coopified.scr::ai_accuracy 30 65 95 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
	}
end

//============================================================//

scene7_initialize_bombsites:

	//===Nebelwerfers can't be destroyed through any means other than putting the explosive on
	
	//===Put the weaponclip collision stuff on the nebelwerfers

	$scene7_nebelwerfer1_weaponmask.origin = $scene7_nebelwerfer1.origin
	$scene7_nebelwerfer2_weaponmask.origin = $scene7_nebelwerfer2.origin
	$scene7_nebelwerfer3_weaponmask.origin = $scene7_nebelwerfer3.origin
	$scene7_nebelwerfer4_weaponmask.origin = $scene7_nebelwerfer4.origin

	$scene7_nebelwerfer1_weaponmask.angles = $scene7_nebelwerfer1.angles
	$scene7_nebelwerfer2_weaponmask.angles = $scene7_nebelwerfer2.angles
	$scene7_nebelwerfer3_weaponmask.angles = $scene7_nebelwerfer3.angles
	$scene7_nebelwerfer4_weaponmask.angles = $scene7_nebelwerfer4.angles

	$scene7_nebelwerfer1 nodamage	
	$scene7_nebelwerfer2 nodamage
	$scene7_nebelwerfer3 nodamage
	$scene7_nebelwerfer4 nodamage

	$scene7_solid_bombpoint1 hide
	$scene7_nebelwerfer1_destroyed hide
	level.scene7_bombpoint1_status = 0

	$scene7_solid_bombpoint2 hide
	$scene7_nebelwerfer2_destroyed hide
	level.scene7_bombpoint2_status = 0

	$scene7_solid_bombpoint3 hide
	$scene7_nebelwerfer3_destroyed hide
	level.scene7_bombpoint3_status = 0

	$scene7_solid_bombpoint4 hide
	$scene7_nebelwerfer4_destroyed hide
	level.scene7_bombpoint4_status = 0
end

//chrissstrahl - let us put all this in a single func
//=========================================================================
scene7_bombplant local.number:{
//=========================================================================
	if (level.coop_threadCalled["scene7_bombplant"][local.number]){
		//[202] chrissstrahl - have some debug here, just to be sure
		println("COOP DEV: WARNING scene7_bombplant "+local.number+" denied (m3l3.scr 5260+)")
		end
	} //[201] Smithy - only allow this to be called once per bomb
	level.coop_threadCalled["scene7_bombplant"][local.number] = game.true


	//iprintlnbold_noloc("scene7_bombplant"+local.number)
	thread ( "scene7_bombplant"+local.number+"_runaway") //chrissstrahl //[200] Smithy - why did this use 'testthread' ? :X
	
	$("scene7_glowing_bombpoint"+local.number) remove
	$("scene7_solid_bombpoint"+local.number) show
	//$("scene7_solid_bombpoint"+local.number) playsound plantbomb wait //[200] Smithy
	
	//[202] chrissstrahl - test if that fixes the issue that it gets stuck and does not finish the mission
	//$("scene7_solid_bombpoint"+local.number) waitthread coop_mod/replace.scr::playsound_wait "plantbomb" //[201] Smithy - use waitthread instead, just in case this is causing the bomb to fail //[200] Smithy - coop compatible
	//$("scene7_solid_bombpoint"+local.number) waittill sounddone //[200] Smithy - reinstated sounddone as works fine with replace func
	$("scene7_solid_bombpoint"+local.number) playsound "plantbomb"
	wait 1

	$("scene7_solid_bombpoint"+local.number) exec global/loopsound.scr bombtick
	
	exec coop_mod/replace.scr::stopwatch 4 //chrissstrahl - coop replacment
	wait 4	//tick tock
	
	$("scene7_solid_bombpoint"+local.number) stoploopsound
	$("scene7_nebelwerfer"+local.number+"_exploder") anim start
	
	//===Execute massive radius damage
	if(level.gametype == 0){
		radiusdamage ( ($("scene7_nebelwerfer"+local.number+"_destroyed").origin) + (0 0 128) ) 512 640 0
	}else{
		radiusdamage ( ($("scene7_nebelwerfer"+local.number+"_destroyed").origin) + (0 0 128) ) 1024 640 0
	}		
	wait 0.3
	
	$("scene7_nebelwerfer"+local.number) remove
	$("scene7_nebelwerfer"+local.number+"_destroyed") show
	$("scene7_nebelwerfer"+local.number+"_weaponmask_destroyed").origin = $("scene7_nebelwerfer"+local.number).origin
	$("scene7_nebelwerfer"+local.number+"_weaponmask_destroyed").angles = $("scene7_nebelwerfer"+local.number).angles
	$("scene7_nebelwerfer"+local.number+"_weaponmask") remove
	$("scene7_solid_bombpoint"+local.number) remove

	level.scene7_bombcount --
	
	if(local.number == 1)		{ level.scene7_bombpoint1_status = 1 }
	else if(local.number == 2)	{ level.scene7_bombpoint2_status = 1 }
	else if(local.number == 3)	{ level.scene7_bombpoint3_status = 1 }
	else if(local.number == 4)	{ level.scene7_bombpoint4_status = 1 }

	thread scene7_bombtracker
	thread scene7_objective_assignment

	if (isAlive level.ramsey)		{ level.ramsey.friendtype = 1	}
	if (isAlive level.harrison)	{ level.harrison.friendtype = 1 }
	if (isAlive level.tomlin)		{ level.tomlin.friendtype = 1 }
}end

//=========================================================================
scene7_bombplant1:{
//=========================================================================
	//chrissstrahl - manage that shit in one function
	thread scene7_bombplant 1
}end

//=========================================================================
scene7_bombplant2:{
//=========================================================================
	//chrissstrahl - manage that shit in one function
	thread scene7_bombplant 2
}end

//=========================================================================
scene7_bombplant3:{
//=========================================================================
	//chrissstrahl - manage that shit in one function
	thread scene7_bombplant 3
}end

//=========================================================================
scene7_bombplant4:{
//=========================================================================
	//chrissstrahl - manage that shit in one function
	thread scene7_bombplant 4
}end

//============================================================//

scene7_bombtracker:
	//===Setup objective text string update
	level.locationchecktext = ("Locate and destroy the Nebelwerfers.    [" + level.scene7_bombcount + " remaining]")

	//===When all the nebelwerfers are destroyed, update the objective to successful, and call the changelevel thread to conclude the mission.
	if (level.scene7_bombcount == 0){
		waitthread global/objectives.scr::add_objectives 1 3 "Locate and destroy the Nebelwerfers."
		wait 1
		thread m3l3_changelevel
	}
end

//============================================================//

scene7_objective_assignment:
	//===Moves the compass waypoint indicator to the next intact nebelwerfer location

	if (level.scene7_bombpoint1_status == 0){
		waitthread global/objectives.scr::add_objectives 1 2 level.locationchecktext $scene7_nebelwerfer1.origin
		thread global/objectives.scr::current_objectives 1
	}else if (level.scene7_bombpoint2_status == 0){
		waitthread global/objectives.scr::add_objectives 1 2 level.locationchecktext $scene7_nebelwerfer2.origin
		thread global/objectives.scr::current_objectives 1
	}else if (level.scene7_bombpoint3_status == 0){
		waitthread global/objectives.scr::add_objectives 1 2 level.locationchecktext $scene7_nebelwerfer3.origin
		thread global/objectives.scr::current_objectives 1
	}
	else if (level.scene7_bombpoint4_status == 0){
		waitthread global/objectives.scr::add_objectives 1 2 level.locationchecktext $scene7_nebelwerfer4.origin
		thread global/objectives.scr::current_objectives 1
	}
end

//============================================================//

//[203] chrissstrahl - fix the crap
//this level was now fixed several time sand yet overand over again it gets stuck
//so to end this I use this function that has a timeout
//============================================================
coop_timeoutHelperFunction:{
//============================================================
	wait 30;
	goto m3l3_changelevelEnd
}end

//[203] chrissstrahl - changed stuff so this will no longer get stuck
m3l3_changelevel:
	if (isAlive level.ramsey){
		local.player = exec coop_mod/replace.scr::player_closestTo level.ramsey //chrissstrahl - coop
		level.ramsey runto local.player //chrissstrahl -coop
		
		if (!(vector_within level.ramsey local.player 1024) || local.player == NULL){ //chrissstrahl - coop
			setcvar "g_medal5" "1"
			setcvar "g_m4l1" "1"
			exec global/missioncomplete.scr briefing/briefing4  
			end
		}
		
		thread coop_timeoutHelperFunction
		
		while ((!vector_within level.ramsey local.player 256) && local.player != NULL){ //chrissstrahl - coop
			waitframe
			local.player = exec coop_mod/replace.scr::player_closestTo level.ramsey //chrissstrahl - coop
		}
		
		if (isAlive level.ramsey){		
			level.ramsey exec global/stand.scr
			level.ramsey lookAt local.player //chrissstrahl - coop
			level.ramsey turnto local.player //chrissstrahl - coop

			//level.ramsey say dfr_impressed_17j_1	//"Nice work!" //[200] Smithy
			level.ramsey thread coop_mod/replace.scr::say_wait "dfr_impressed_17j_1" //[200] Smithy - coop compatible - fixes transition bug when thread halts here
			wait 5
		}
	}
	else{
		wait 5
	}
	
	//[203] chrissstrahl - I suspect the above can get the mission stuck, so here is a label to which the 
	m3l3_changelevelEnd:
	
	if(level.theEndIsNear){ end }
	level.theEndIsNear = 1

	setcvar "g_medal5" "1"
	setcvar "g_m4l1" "1"
	exec global/missioncomplete.scr briefing/briefing4
end

//================================================================//
//											//
//					UTILITIES					//
//											//
//================================================================//

//============================================================//

//===This is a global thread name that's called when the clickitem is fired and misses

clickitem_fail:
	//===The halftrack is the only airstrikeable object in M3L3. 
	//===If the halftrack is alive, and the binoculars are clicked in an invalid spot, play the invalid target speech
	//===If the halftrack is dead, and the binoculars are clicked at all, play the static burst sound

	level.clickitem_time = 0

	if (level.halftrack_alive == 1){
		if (level.time <= level.clickitem_time + 4 ){ end }

		level.clickitem_time = level.time
		parm.other playsound airstrike_invalid_target //chrissstrahl - coop
	}
	else if (level.halftrack_alive == 0){	
		if (level.time <= level.clickitem_time + 4 ){
			end
		}

		level.clickitem_time = level.time

		parm.other playsound snd_binoculars //chrissstrahl - coop
		end
	}
end

//============================================================//

squad_reset:
	//===Reset the friendly NPCs to regroup! Health for everyone! Yay!
	if (isAlive level.ramsey){
		//===Reset turnto and lookat targets

			level.ramsey turnto NULL
			level.ramsey lookAt NULL

		//===Reengage friendlythink routine
			//level.ramsey tether $player //chrissstrahl
			//level.ramsey.destination = $player //chrissstrahl
			level.ramsey exec coop_mod/main.scr::tether		//chrissstrahl - make coop compatible
			level.ramsey exec coop_mod/main.scr::destination	//chrissstrahl - make coop compatible
			level.ramsey.friendtype = 1
			level.ramsey thread global/friendly.scr::friendlythink
			level.ramsey.distance = 140

		//===No more invulnerability after Ramsey serves his purpose, don't encourage the player to 'use' his squadmates as meat shields
									
		//===Reset individual properties

			level.ramsey exec global/enable_ai.scr
			level.ramsey exec maps/m3l3/coopified.scr::ai_accuracy 15 15 35 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			level.ramsey.mindist		= 256		//range to stop closing in
			level.ramsey.maxdist		= 4000	//range to close to on enemy for longest range shot
			level.ramsey.leash		= 1200		//original 800, then 600
			level.ramsey exec coop_mod/main.scr::tether		//chrissstrahl - make coop compatible
			level.ramsey.sight		= 4000
			level.ramsey.noticescale	= 1
			level.ramsey.waittime		= 0.1
			level.ramsey.distance		= 256
			level.ramsey.interval		= 256
			level.ramsey type_attack cover
	}

	if (isAlive level.harrison){
		//===Reset turnto and lookat targets

			level.harrison turnto NULL
			level.harrison lookAt NULL

		//===Reengage friendlythink routine
			//level.harrison tether $player //chrissstrahl
			//level.harrison.destination = $player //chrissstrahl
			level.harrison exec coop_mod/main.scr::tether		//chrissstrahl - make coop compatible
			level.harrison exec coop_mod/main.scr::destination	//chrissstrahl - make coop compatible
			level.harrison.friendtype = 1
			level.harrison thread global/friendly.scr::friendlythink
			level.harrison.distance = 160

		//===Toggle invulnerability here for testing if needed

			level.harrison takedamage 			//vulnerability

		//===Reset individual properties

			level.harrison exec global/enable_ai.scr
			level.harrison exec maps/m3l3/coopified.scr::ai_accuracy 15 15 25 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill

			level.harrison.mindist		= 256		//range to stop closing in
			level.harrison.maxdist		= 4000	//range to close to on enemy for longest range shot
			level.harrison.leash		= 1200	//original 800, then 600
			//level.harrison tether $player //chrissstrahl redundancy
			level.harrison.sight		= 4000
			level.harrison.noticescale	= 1
			level.harrison.waittime		= 0.1
			level.harrison.distance		= 256
			level.harrison.interval		= 256
			level.harrison type_attack cover
	}

	if (isAlive level.tomlin){
		//===Reset turnto and lookat targets
			level.tomlin turnto NULL
			level.tomlin lookAt NULL

		//===Reengage friendlythink routine
			//level.tomlin tether $player //chrissstrahl
			//level.tomlin.destination = $player //chrissstrahl
			level.tomlin exec coop_mod/main.scr::tether		//chrissstrahl - make coop compatible
			level.tomlin exec coop_mod/main.scr::destination	//chrissstrahl - make coop compatible
			level.tomlin.friendtype = 1
			level.tomlin thread global/friendly.scr::friendlythink
			level.tomlin.distance = 160

		//===Toggle invulnerability here for testing if needed
			level.tomlin takedamage				//vulnerability
			level.tomlin exec maps/m3l3/coopified.scr::ai_accuracy 15 15 25 NIL //chrissstrahl - e,m,h,c - manage for coop and sp skill
	
		//===Reset individual properties
			level.tomlin exec global/enable_ai.scr

			level.tomlin.mindist		= 256		//range to stop closing in
			level.tomlin.maxdist		= 4000	//range to close to on enemy for longest range shot
			level.tomlin.leash		= 1200	//original 800, then 600
			//level.tomlin tether $player //chrissstrahl - redundancy
			level.tomlin.sight		= 4000
			level.tomlin.noticescale	= 1
			level.tomlin.waittime		= 0.1
			level.tomlin.distance		= 256
			level.tomlin.interval		= 256
			level.tomlin type_attack cover
	}
end

//============================================================//

scene7_bombplant1_runaway:
	if (isAlive level.ramsey){
		level.ramsey.friendtype = -1

		if (vector_length (level.ramsey.origin - $scene7_ramsey_safenode1a.origin) < vector_length (level.ramsey.origin - $scene7_ramsey_safenode1b.origin)){
			level.ramsey runto $scene7_ramsey_safenode1a
		}else{
			level.ramsey runto $scene7_ramsey_safenode1b
		}
	}

	if (isAlive level.harrison){
		level.harrison.friendtype = -1

		if (vector_length (level.harrison.origin - $scene7_harrison_safenode1a.origin) < vector_length (level.harrison.origin - $scene7_harrison_safenode1b.origin)){
			level.harrison runto $scene7_harrison_safenode1a
		}else{
			level.harrison runto $scene7_harrison_safenode1b
		}
	}
		
	if (isAlive level.tomlin){
		level.tomlin.friendtype = -1

		if (vector_length (level.tomlin.origin - $scene7_tomlin_safenode1a.origin) < vector_length (level.tomlin.origin - $scene7_tomlin_safenode1b.origin)){
			level.tomlin runto $scene7_tomlin_safenode1a
		}else{
			level.tomlin runto $scene7_tomlin_safenode1b
		}
	}
end

//============================================================//

scene7_bombplant2_runaway:
	if (isAlive level.ramsey){
		level.ramsey.friendtype = -1

		if (vector_length (level.ramsey.origin - $scene7_ramsey_safenode2a.origin) < vector_length (level.ramsey.origin - $scene7_ramsey_safenode2b.origin)){
			level.ramsey runto $scene7_ramsey_safenode2a
		}
		else{
			level.ramsey runto $scene7_ramsey_safenode2b
		}	
	}

	if (isAlive level.harrison){
		level.harrison.friendtype = -1

		if (vector_length (level.harrison.origin - $scene7_harrison_safenode2a.origin) < vector_length (level.harrison.origin - $scene7_harrison_safenode2b.origin)){
			level.harrison runto $scene7_harrison_safenode2a
		}
		else{
			level.harrison runto $scene7_harrison_safenode2b
		}	
	}
		
	if (isAlive level.tomlin){
		level.tomlin.friendtype = -1

		if (vector_length (level.tomlin.origin - $scene7_tomlin_safenode2a.origin) < vector_length (level.tomlin.origin - $scene7_tomlin_safenode2b.origin)){
			level.tomlin runto $scene7_tomlin_safenode2a
		}
		else{
			level.tomlin runto $scene7_tomlin_safenode2b
		}	
	}
end

//============================================================//

scene7_bombplant3_runaway:

	if (isAlive level.ramsey){
		level.ramsey.friendtype = -1

		if (vector_length (level.ramsey.origin - $scene7_ramsey_safenode3a.origin) < vector_length (level.ramsey.origin - $scene7_ramsey_safenode3b.origin)){
			level.ramsey runto $scene7_ramsey_safenode3a
		}else{
			level.ramsey runto $scene7_ramsey_safenode3b
		}
	}

	if (isAlive level.harrison){
		level.harrison.friendtype = -1

		if (vector_length (level.harrison.origin - $scene7_harrison_safenode3a.origin) < vector_length (level.harrison.origin - $scene7_harrison_safenode3b.origin)){
			level.harrison runto $scene7_harrison_safenode3a
		}else{
			level.harrison runto $scene7_harrison_safenode3b
		}	
	}
		
	if (isAlive level.tomlin){
		level.tomlin.friendtype = -1

		if (vector_length (level.tomlin.origin - $scene7_tomlin_safenode3a.origin) < vector_length (level.tomlin.origin - $scene7_tomlin_safenode3b.origin)){
			level.tomlin runto $scene7_tomlin_safenode3a
		}else{
			level.tomlin runto $scene7_tomlin_safenode3b
		}	
	}
end

//============================================================//

scene7_bombplant4_runaway:

	if (isAlive level.ramsey){
		level.ramsey.friendtype = -1

		local.range = 20000

		local.newrange1 = vector_length (level.ramsey.origin - $scene7_ramsey_safenode4a.origin)
		local.newrange2 = vector_length (level.ramsey.origin - $scene7_ramsey_safenode4b.origin)
		local.newrange3 = vector_length (level.ramsey.origin - $scene7_ramsey_safenode4c.origin)	
		local.newrange4 = vector_length (level.ramsey.origin - $scene7_ramsey_safenode4d.origin)

		if (local.newrange1 < local.range){
			local.range = local.newrange1
			local.nodechoice = 1
		}			
		if (local.newrange2 < local.range){
			local.range = local.newrange2
			local.nodechoice = 2
		}
		if (local.newrange3 < local.range){
			local.range = local.newrange3
			local.nodechoice = 3
		}
		if (local.newrange4 < local.range){
			local.range = local.newrange4
			local.nodechoice = 4
		}

		if (local.nodechoice == 1){
			level.ramsey runto $scene7_ramsey_safenode4a
		}
		else if (local.nodechoice == 2){
			level.ramsey runto $scene7_ramsey_safenode4b
		}else if (local.nodechoice == 3){
			level.ramsey runto $scene7_ramsey_safenode4c
		}else if (local.nodechoice == 4){
			level.ramsey runto $scene7_ramsey_safenode4d
		}
	}

	if (isAlive level.harrison){
		level.harrison.friendtype = -1
		local.range = 20000
		local.newrange1 = vector_length (level.harrison.origin - $scene7_harrison_safenode4a.origin)
		local.newrange2 = vector_length (level.harrison.origin - $scene7_harrison_safenode4b.origin)
		local.newrange3 = vector_length (level.harrison.origin - $scene7_harrison_safenode4c.origin)	
		local.newrange4 = vector_length (level.harrison.origin - $scene7_harrison_safenode4d.origin)

		if (local.newrange1 < local.range){
			local.range = local.newrange1
			local.nodechoice = 1
		}			
		if (local.newrange2 < local.range){
			local.range = local.newrange2
			local.nodechoice = 2
		}
		if (local.newrange3 < local.range){
			local.range = local.newrange3
			local.nodechoice = 3
		}
		if (local.newrange4 < local.range){
			local.range = local.newrange4
			local.nodechoice = 4
		}

		if (local.nodechoice == 1){
			level.harrison runto $scene7_harrison_safenode4a
		}else if (local.nodechoice == 2){
			level.harrison runto $scene7_harrison_safenode4b
		}else if (local.nodechoice == 3){
			level.harrison runto $scene7_harrison_safenode4c
		}
		else if (local.nodechoice == 4){
			level.harrison runto $scene7_harrison_safenode4d
		}
	}
		
	if (isAlive level.tomlin){
		level.tomlin.friendtype = -1

		local.range = 20000

		local.newrange1 = vector_length (level.tomlin.origin - $scene7_tomlin_safenode4a.origin)
		local.newrange2 = vector_length (level.tomlin.origin - $scene7_tomlin_safenode4b.origin)
		local.newrange3 = vector_length (level.tomlin.origin - $scene7_tomlin_safenode4c.origin)	
		local.newrange4 = vector_length (level.tomlin.origin - $scene7_tomlin_safenode4d.origin)

		if (local.newrange1 < local.range){
			local.range = local.newrange1
			local.nodechoice = 1
		}			
		if (local.newrange2 < local.range){
			local.range = local.newrange2
			local.nodechoice = 2
		}
		if (local.newrange3 < local.range){
			local.range = local.newrange3
			local.nodechoice = 3
		}
		if (local.newrange4 < local.range){
			local.range = local.newrange4
			local.nodechoice = 4
		}

		if (local.nodechoice == 1){
			level.tomlin runto $scene7_tomlin_safenode4a
		}else if (local.nodechoice == 2){
			level.tomlin runto $scene7_tomlin_safenode4b
		}else if (local.nodechoice == 3){
			level.tomlin runto $scene7_tomlin_safenode4c
		}else if (local.nodechoice == 4){
			level.tomlin runto $scene7_tomlin_safenode4d
		}
	}
end

//============================================================

health_placement:
//println "TADA HEALTH"
//println level.skill

	if (level.skill == "0"){
		local.healthitem1 = spawn models/items/item_50_healthbox.tik
		local.healthitem1.origin = ( -3293.93 2733.32 -95.0 )
		local.healthitem1.angles = (0 90 0)

		local.healthitem2 = spawn models/items/item_50_healthbox.tik
		local.healthitem2.origin = ( -1085.93 4821.32 -144.0 )
		local.healthitem2.angles = (0 90 0)
	}
	else if (level.skill == "1"){
		local.healthitem1 = spawn models/items/item_25_healthbox.tik
		local.healthitem1.origin = ( -3293.93 2733.32 -95.0 )
		local.healthitem1.angles = (0 90 0)

		local.healthitem2 = spawn models/items/item_25_healthbox.tik
		local.healthitem2.origin = ( -1085.93 4821.32 -144.0 )
		local.healthitem2.angles = (0 90 0)
	}
	wait 5
	
	//println "HEALTH 1 LOCATION:" local.healthitem1.origin
	//println "HEALTH 2 LOCATION:" local.healthitem2.origin
end

//==============================================================================================================================================//
//																								//
//									MISCELLANEOUS ESSENTIAL SUPPORT THREADS									//
//																								//
//==============================================================================================================================================//


//===These threads are called by trigger_multiples in the bsp, one trigger per thread

farplane_near:
	level.farplaneswitching = 1	

	level.farplanelimit = 3200	//Set some default

	if (level.sysconfig == "0"){
		level.farplanelimit = 3200
	}
	if (level.sysconfig == "1"){
		level.farplanelimit = 3800
	}
	if (level.sysconfig == 2){
		level.farplanelimit = 4200
	}
	
	while (level.farplane > level.farplanelimit && level.farplaneswitching == 1){
		level.farplane = level.farplane - 10
		//println level.farplane //[200] Smithy - removed annoying spam
		$world farplane level.farplane
		wait .1
	}
end

//============================================//

farplane_far:
	level.farplaneswitching = 2
	level.farplanelimit = 6600	//Set some default

	if (level.sysconfig == "0"){
		level.farplanelimit = 6600
	}
	
	if (level.sysconfig == "1"){
		level.farplanelimit = 6800
	}
	
	if (level.sysconfig == "2"){
		level.farplanelimit = 7500
	}

	while (level.farplane < level.farplanelimit && level.farplaneswitching == 2){
		level.farplane = level.farplane + 10
		//println level.farplane //[200] Smithy - removed annoying spam
		$world farplane level.farplane
		wait .1
	}
end

//============================================//

//===These are threads for custom tweaking the farplane to help reduce polycounts at various locations
//First entering town fog changes
quick_farplane_near:
	level.farplaneswitching = 1	
	level.farplanelimit = 2200	//Set some default

	if (level.sysconfig == "0"){
		level.farplanelimit = 2200
	}

	if (level.sysconfig == "1"){
		level.farplanelimit = 3600	//2300
	}
	
	if (level.sysconfig == "2"){
		level.farplanelimit = 4200
	}

	while (level.farplane > level.farplanelimit && level.farplaneswitching == 1){
		level.farplane = level.farplane - 10
		//println level.farplane //[200] Smithy - removed annoying spam
		$world farplane level.farplane
		wait .1
	}
end

//============================================//

quick_farplane_far:
//Entering the church area fog changes
	level.farplaneswitching = 2
	level.farplanelimit = 2700	//Set some default
	if (level.sysconfig == "0"){
		level.farplanelimit = 2700
	}

	if (level.sysconfig == "1"){
		level.farplanelimit = 3800	//3400
	}
	
	if (level.sysconfig == "2"){
		level.farplanelimit = 4200
	}

	while (level.farplane < level.farplanelimit && level.farplaneswitching == 2){
		level.farplane = level.farplane + 10
		//println level.farplane //[200] Smithy - removed annoying spam
		$world farplane level.farplane
		wait .1
	}
end

//============================================//
quick_farplane_near_extra:
//Entering second street fog changes
	level.farplaneswitching = 1	
	level.farplanelimit = 2000	//Set some default

	if (level.sysconfig == "0"){
		level.farplanelimit = 2000
	}

	if (level.sysconfig == "1"){
		level.farplanelimit = 3200	//2200
	}
	
	if (level.sysconfig == "2"){
		level.farplanelimit = 4200
	}

	while (level.farplane > level.farplanelimit && level.farplaneswitching == 1){
		level.farplane = level.farplane - 10
		//println level.farplane //[200] Smithy - removed annoying spam
		$world farplane level.farplane
		wait .1
	}
end
